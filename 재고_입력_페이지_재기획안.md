# 재고 입력 페이지 재기획안

**작업 일자**: 2026-01-24  
**목적**: 재고 입력 페이지를 더 효율적이고 사용자 친화적으로 업그레이드

---

## 🎯 개선 목표

1. **입력 효율성 향상**: 단일/일괄 입력, 빠른 수정으로 재고 관리 체계화
2. **시각적 피드백 강화**: 진행률, 상태 표시, 대시보드로 한눈에 파악
3. **작업 흐름 최적화**: 빠른 액션, 일괄 작업으로 생산성 향상
4. **연계성 강화**: 발주 관리, 재료 사용량과의 연결 강화, 발주 필요 여부 표시

---

## 📋 현재 상태 분석

### 현재 기능
- ✅ 단일 재고 입력 (재료 선택, 현재고, 안전재고)
- ✅ 재고 현황 요약 표시
- ✅ 발주 단위 변환 지원
- ✅ 재고 상태 표시 (부족/주의/정상)
- ✅ 발주 관리로 이동

### 개선 필요 사항
- ❌ 일괄 입력 기능 없음
- ❌ 재고 수정 기능 없음 (목록에서 직접 수정 불가)
- ❌ 필터링 기능 없음 (재료 분류, 상태별 필터)
- ❌ 검색 기능 없음
- ❌ 대시보드가 단순함 (핵심 지표 부족)
- ❌ 발주 필요 여부 정보 부족
- ❌ 사용량 정보 표시 없음

---

## 🚀 재기획안: 5-Zone 구조

### **ZONE A: 대시보드 & 현황 요약**
**목적**: 전체 재고 현황을 한눈에 파악

#### 구성 요소
1. **핵심 지표 카드 (4열)**
   - 전체 재고 등록 수 (재고 정보가 있는 재료 수)
   - 정상 재고 수 (현재고 ≥ 안전재고)
   - 발주 필요 재료 수 (현재고 < 안전재고)
   - 주의 재고 수 (현재고 ≤ 안전재고 × 1.2)

2. **진행률 바**
   - 재고 등록률: `재고 정보 있는 재료 / 전체 재료 × 100%`
   - 재고 정상률: `정상 재고 / 전체 재고 × 100%`

3. **스마트 알림**
   - 발주 필요 재고가 있으면 경고 표시 (개수와 재료명)
   - 재고 정보가 없는 재료가 있으면 안내 표시
   - 주의 재고가 있으면 정보 표시

---

### **ZONE B: 재고 입력 (단일/일괄)**
**목적**: 효율적인 재고 등록

#### B-1: 단일 입력
**입력 필드**:
- 재료 선택 (필수, 드롭다운)
  - 재료명과 단위 표시 (예: "버터 (g / 발주: 개)")
- 현재고 (필수, 숫자, 발주 단위로 입력)
  - 발주 단위 표시 (예: "현재고 (개)")
  - 기본 단위로 자동 변환하여 저장
- 안전재고 (필수, 숫자, 발주 단위로 입력)
  - 발주 단위 표시 (예: "안전재고 (개)")
  - 기본 단위로 자동 변환하여 저장

**정보 표시**:
- 선택한 재료의 기본 단위 표시
- 선택한 재료의 발주 단위 표시
- 변환 비율 표시 (예: "1개 = 500g")
- 기존 재고 정보가 있으면 자동으로 불러오기

**액션 버튼**:
- 💾 저장 (Primary)
- 🔄 초기화

#### B-2: 일괄 입력
**입력 방식**:
- 입력할 재료 개수 선택 (1-20개)
- 각 재료별 입력 필드:
  - 재료 선택 (드롭다운)
  - 현재고 (발주 단위)
  - 안전재고 (발주 단위)

**액션 버튼**:
- 💾 일괄 저장 (Primary)
- 📋 템플릿 다운로드 (CSV) - 향후 추가
- 📤 템플릿 업로드 (CSV) - 향후 추가

**개선점**:
- 일괄 입력 시 재료 목록을 체크박스로 선택 가능 (향후 추가)
- 현재고/안전재고 일괄 설정 옵션 (향후 추가)

---

### **ZONE C: 필터 & 검색**
**목적**: 원하는 재고 정보를 빠르게 찾기

#### 필터 옵션
1. **재료 분류 필터** (멀티 선택)
   - 옵션: 전체, 채소, 육류, 해산물, 조미료, 기타, 미지정
   - 기본값: 전체

2. **재고 상태 필터** (단일 선택)
   - 옵션: 전체, 정상, 주의, 부족
   - 기본값: 전체

3. **재고 등록 상태 필터** (단일 선택)
   - 옵션: 전체, 등록됨, 미등록
   - 기본값: 전체

4. **레시피 사용 상태 필터** (단일 선택)
   - 옵션: 전체, 레시피에서 사용, 레시피에서 미사용
   - 기본값: 전체

#### 검색
- 재료명 검색 (텍스트 입력)

---

### **ZONE D: 재고 목록 & 관리**
**목적**: 재고 정보를 한눈에 보고 빠르게 수정

#### 목록 표시 형식
**테이블 형태** (컬럼 헤더 포함):
- 재료명
- 재료 분류 (뱃지, 색상 구분)
- 단위 (기본 단위 / 발주 단위)
- 현재고 (발주 단위로 표시)
- 안전재고 (발주 단위로 표시)
- 상태 (정상/주의/부족, 색상 구분)
- 발주 필요 여부 (⚠️/✓)
- 최근 사용량 (최근 7일 평균, 선택적)
- 관리 (수정/삭제 버튼)

#### 기능
1. **인라인 수정**
   - 각 재고 항목에 수정 버튼
   - 수정 모달에서 현재고/안전재고 수정
   - 발주 단위로 입력받고 기본 단위로 저장

2. **삭제 기능**
   - 재고 정보 삭제 (확인 다이얼로그)
   - 발주 이력이 있으면 경고 표시

3. **빠른 액션**
   - 발주 필요 재고에서 발주 관리로 바로 이동
   - 재료 입력 페이지로 이동 (재료 정보 수정)

---

### **ZONE E: 통계 & 연계 관리**
**목적**: 재고 통계와 관련 페이지로의 이동

#### 구성 요소
1. **재고 통계**
   - 재고 등록률: 재고 정보 있는 재료 / 전체 재료
   - 재고 정상률: 정상 재고 / 전체 재고
   - 발주 필요 재료 TOP 5 (발주 필요량 기준)
   - 최근 사용량 TOP 5 (최근 7일 평균 사용량 기준)

2. **연계 페이지**
   - 🛒 발주 관리로 이동
   - 🧺 사용 재료 입력으로 이동
   - 📊 재료 사용량 집계로 이동

---

## 📊 데이터 구조

### 재고 정보 (inventory 테이블)
- `store_id`: 매장 ID
- `ingredient_id`: 재료 ID (FK)
- `on_hand`: 현재고 (기본 단위)
- `safety_stock`: 안전재고 (기본 단위)
- `created_at`: 생성일시
- `updated_at`: 수정일시

### 계산 로직
1. **재고 상태 판단**:
   - 부족: `현재고 < 안전재고`
   - 주의: `안전재고 ≤ 현재고 ≤ 안전재고 × 1.2`
   - 정상: `현재고 > 안전재고 × 1.2`

2. **발주 필요량 계산**:
   - `발주 필요량 = max(0, 안전재고 + 예상소요량 - 현재고)`
   - 예상소요량은 재료 사용량 집계에서 계산

3. **단위 변환**:
   - 입력: 발주 단위
   - 저장: 기본 단위 (발주 단위 × 변환비율)
   - 표시: 발주 단위 (기본 단위 ÷ 변환비율)

---

## 🎨 UI/UX 디자인 가이드

### 색상 체계
- **정상**: 초록색 (#22C55E)
- **주의**: 노란색 (#F59E0B)
- **부족**: 빨간색 (#EF4444)
- **미등록**: 회색 (#9CA3AF)

### 아이콘
- ✅ 정상
- ⚠️ 주의/부족
- 📦 재고
- 🛒 발주 필요
- ✏️ 수정
- 🗑️ 삭제

### 레이아웃
- ZONE A: 전체 너비 (대시보드)
- ZONE B: 전체 너비 (입력 폼)
- ZONE C: 전체 너비 (필터)
- ZONE D: 전체 너비 (목록)
- ZONE E: 2열 (통계, 연계)

---

## 🔄 데이터 흐름

### 재고 저장
1. 사용자가 발주 단위로 입력
2. 기본 단위로 변환 (발주 단위 × 변환비율)
3. `save_inventory()` 함수로 DB 저장
4. 캐시 무효화
5. 화면 새로고침

### 재고 수정
1. 목록에서 수정 버튼 클릭
2. 수정 모달 열기
3. 발주 단위로 입력받기
4. 기본 단위로 변환하여 저장
5. 캐시 무효화
6. 화면 새로고침

### 재고 삭제
1. 목록에서 삭제 버튼 클릭
2. 확인 다이얼로그 표시
3. 발주 이력 확인 (있으면 경고)
4. 삭제 실행
5. 캐시 무효화
6. 화면 새로고침

---

## 📝 주요 기능 상세

### 1. 재고 상태 표시
- **부족** (빨간색): 현재고 < 안전재고
- **주의** (노란색): 안전재고 ≤ 현재고 ≤ 안전재고 × 1.2
- **정상** (초록색): 현재고 > 안전재고 × 1.2

### 2. 발주 필요 여부
- 발주 필요량 계산: `max(0, 안전재고 + 예상소요량 - 현재고)`
- 예상소요량이 없으면: `max(0, 안전재고 - 현재고)`
- 발주 필요량 > 0이면 ⚠️ 표시

### 3. 단위 변환
- 입력: 발주 단위 (예: 개, 박스)
- 저장: 기본 단위 (예: g, ml)
- 표시: 발주 단위 (사용자 친화적)
- 변환비율: 1 발주단위 = N 기본단위

### 4. 사용량 정보
- 최근 7일 평균 사용량 계산
- `calculate_ingredient_usage()` 함수 사용
- 일일 판매량 × 레시피 사용량으로 계산

---

## 🚀 향후 개선 사항

### Phase 2 (권장)
- [ ] 일괄 작업 (안전재고 일괄 변경)
- [ ] CSV 템플릿 업로드/다운로드
- [ ] 정렬 기능 (재료명, 현재고, 안전재고, 상태 등)
- [ ] 재고 이력 추적 (변경 이력)
- [ ] 재고 알림 설정 (부족 시 알림)

### Phase 3 (선택)
- [ ] 재고 입출고 기록
- [ ] 재고 회전율 표시
- [ ] 최적 안전재고 추천
- [ ] 페이지네이션 (재고가 많을 경우)

---

## ✅ 구현 체크리스트

### ZONE A: 대시보드
- [ ] 핵심 지표 카드 (4개)
- [ ] 진행률 바 (2개)
- [ ] 스마트 알림

### ZONE B: 입력
- [ ] 단일 입력 폼
- [ ] 일괄 입력 폼
- [ ] 발주 단위 변환
- [ ] 기존 재고 정보 불러오기

### ZONE C: 필터
- [ ] 재료 분류 필터
- [ ] 재고 상태 필터
- [ ] 재고 등록 상태 필터
- [ ] 레시피 사용 상태 필터
- [ ] 재료명 검색

### ZONE D: 목록 & 관리
- [ ] 재고 목록 표시 (테이블)
- [ ] 컬럼 헤더
- [ ] 재고 상태 뱃지
- [ ] 발주 필요 여부 표시
- [ ] 인라인 수정 기능
- [ ] 삭제 기능

### ZONE E: 통계 & 연계
- [ ] 재고 통계 표시
- [ ] 발주 필요 TOP 5
- [ ] 최근 사용량 TOP 5
- [ ] 연계 페이지 링크

---

**작성일**: 2026-01-24  
**담당**: 재고 입력 페이지 재기획
