# PHASE 9 / STEP 9-4B — Revenue Structure Design Lab 완료

## 📋 작업 목표

"수익 구조 설계실(가게 전체 돈 구조)"을 임시 연결(target_cost_structure)에서 분리하여 독립 페이지로 생성했습니다.
공통 프레임(Design Lab 4층 구조)을 사용합니다.

---

## ✅ 완료된 작업

### 1. 새 페이지 생성
- **파일**: `ui_pages/revenue_structure_design_lab.py` (신규 생성)
- **기능**: 수익 구조 설계실 전용 페이지
- **구조**: Design Lab 공통 프레임 4층 구조 사용

### 2. 사이드바 라우팅 변경
- **파일**: `app.py`
- **변경**: "수익 구조 설계실" → 새 페이지로 연결
- **기존**: target_cost_structure는 "목표 비용 구조(입력)"으로 유지

### 3. target_cost_structure.py 복원
- **파일**: `ui_pages/target_cost_structure.py`
- **변경**: 공통 프레임 제거, 목표 비용 구조 입력 기능만 유지
- **제목**: "목표 비용 구조(입력)"으로 명확히 표시

---

## 📝 페이지 구조 (4층)

### ZONE A: 코치 요약 (Coach Board)
- 고정비 합계
- 변동비율
- 손익분기점 매출
- 이번 달 예상 매출 (best_available 기반)
- 판결문: "생존선 대비 위험" 또는 "안정"
- 추천 액션: "고정비 조정" / "변동비율 개선" / "목표 매출 재설정" 등

### ZONE B: 구조 맵 (Structure Map)
1. **매출 구간별 예상 이익 테이블**
   - 손익분기점 기준 ±500만 단위 구간
   - 매출, 변동비, 고정비, 총비용, 추정이익, 이익률

2. **손익분기점 vs 예상매출 비교 시각화**
   - bar chart
   - 차이 표시 (delta)

### ZONE C: 사장 학교 (Owner School)
- "손익분기점은 생존선"
- "고정비는 시간을 먹고, 변동비는 매출을 먹는다"
- "목표 매출은 '희망'이 아니라 '구조'에서 나온다"

### ZONE D: 설계 도구 (Design Tools)
1. **구조 파라미터 편집** (읽기+이동 중심)
   - 현재 목표 비용 구조 요약 표시
   - 버튼: [목표 비용 구조(입력)로 이동]
   - 버튼: [목표 매출 구조로 이동]

2. **시나리오 시뮬레이터**
   - "가정 매출" 입력
   - 즉시 계산: 변동비, 총비용, 추정이익, 이익률
   - 손익분기점과 비교

---

## 📝 수정된 파일 목록

### 1. `ui_pages/revenue_structure_design_lab.py` (신규 생성)
- 수익 구조 설계실 전용 페이지
- Design Lab 공통 프레임 사용
- 매출 구간별 예상 이익 테이블, 시나리오 시뮬레이터 포함

### 2. `app.py` (수정)
- "수익 구조 설계실" 메뉴를 새 페이지로 연결
- 라우팅 추가: `elif page == "수익 구조 설계실"`

### 3. `ui_pages/target_cost_structure.py` (수정)
- 공통 프레임 제거
- 목표 비용 구조 입력 기능만 유지
- 제목: "목표 비용 구조(입력)"으로 명확히 표시

### 4. `ui_pages/design_lab/design_lab_coach_data.py` (수정)
- `get_revenue_structure_design_coach_data()` 함수 수정
- 추천 액션 페이지를 "수익 구조 설계실"로 변경
- 변동비율 위험 시 "메뉴 수익 구조 설계실"로 연결

---

## ✅ 앱 실행 시 확인 체크리스트

### 라우팅 확인
- [ ] 사이드바 "🔥 가게 설계" → "수익 구조 설계실" 클릭 → 새 페이지 진입 OK
- [ ] 사이드바 "🔥 가게 설계" → "목표 비용 구조 (입력)" 클릭 → target_cost_structure 페이지 진입 OK

### 수익 구조 설계실 페이지
- [ ] ZONE A (코치 요약) 정상 표시 (고정비, 변동비율, 손익분기점, 예상 매출)
- [ ] ZONE B (구조 맵) 정상 표시 (매출 구간별 예상 이익 테이블, 손익분기점 vs 예상매출 비교)
- [ ] ZONE C (사장 학교) 정상 표시
- [ ] ZONE D (설계 도구) 정상 표시
  - [ ] 구조 파라미터 편집 정상 표시 및 이동 버튼 동작
  - [ ] 시나리오 시뮬레이터 정상 동작

### 목표 비용 구조(입력) 페이지
- [ ] 기존 비용 구조 입력 기능 정상 동작
- [ ] 공통 프레임 없이 입력 기능만 표시
- [ ] 제목이 "목표 비용 구조(입력)"으로 명확히 표시

---

## 🎯 기대 동작

### 사용자 경험
1. **수익 구조 설계실**: 가게 전체 돈 구조 중심의 설계 도구 제공
2. **목표 비용 구조(입력)**: 비용 구조 입력 전용 페이지
3. **명확한 분리**: 두 페이지가 서로 다른 목적으로 사용됨

### 코드 안정성
- 기존 함수 재사용 (`get_fixed_costs`, `get_variable_cost_ratio`, `calculate_break_even_sales`)
- 공통 프레임 재사용
- DB 스키마 변경 없음
- SSOT 정책 준수 (best_available 기반)

---

## 📌 참고사항

### 예상 매출 계산
- **방법**: (월 누적 / 경과일수) * 월 총일수
- **데이터 소스**: `load_monthly_sales_total` (best_available 기반)
- **단순 추정**: 복잡한 예측 모델 없이 경과일수 기반 단순 계산

### 매출 구간별 예상 이익 테이블
- **구간**: 손익분기점 기준 ±500만 단위
- **항목**: 매출, 변동비, 고정비, 총비용, 추정이익, 이익률

### 시나리오 시뮬레이터
- **실시간 계산**: 가정 매출 입력 시 즉시 계산
- **비교 표시**: 손익분기점과 비교하여 위험/안정 표시

### 구조 파라미터 편집
- **읽기 전용**: 이 페이지에서 직접 입력 불가
- **이동 중심**: 목표 비용 구조(입력) 또는 목표 매출 구조로 이동

---

## 🚀 배포 준비

모든 수정이 완료되었습니다. 다음 단계:
1. ✅ 앱 재시작
2. ✅ "수익 구조 설계실" 메뉴 클릭 → 새 페이지 진입 확인
3. ✅ "목표 비용 구조 (입력)" 메뉴 클릭 → 기존 페이지 진입 확인
4. ✅ 수익 구조 설계실의 모든 기능 정상 동작 확인

---

## 📊 작업 요약

| 항목 | 상태 | 비고 |
|------|------|------|
| 새 페이지 생성 | ✅ 완료 | revenue_structure_design_lab.py |
| 사이드바 라우팅 변경 | ✅ 완료 | app.py |
| target_cost_structure 복원 | ✅ 완료 | 목표 비용 구조 입력 전용 |
| 공통 프레임 적용 | ✅ 완료 | 4층 구조 |
| 매출 구간별 예상 이익 테이블 | ✅ 완료 | ±500만 단위 |
| 시나리오 시뮬레이터 | ✅ 완료 | 실시간 계산 |
| 구조 파라미터 편집 | ✅ 완료 | 읽기+이동 중심 |

---

## ✅ 최종 확인

- [x] 새 페이지 생성 완료
- [x] 사이드바 라우팅 변경 완료
- [x] target_cost_structure 복원 완료
- [x] 공통 프레임 적용 완료
- [x] 설계 도구 구현 완료
- [ ] 앱 실행 및 동작 확인 (사용자 확인 필요)

**참고**: 
- 수익 구조 설계실은 가게 전체 돈 구조 중심의 설계 도구입니다.
- 목표 비용 구조(입력)는 비용 구조 입력 전용 페이지입니다.
- 두 페이지는 서로 다른 목적으로 사용됩니다.
