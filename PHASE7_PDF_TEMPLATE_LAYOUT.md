# PHASE 7-3 — PDF 템플릿 구조도
## 실제 출력 레이아웃 설계

---

## 📋 설계 개요

### 목표
각 페이지의 실제 레이아웃, 요소 배치, 시각적 구조를 구체적으로 설계합니다.

### 기본 규격
- **용지**: A4 세로 (210mm × 297mm)
- **여백**: 상하좌우 20mm
- **실제 콘텐츠 영역**: 170mm × 257mm
- **폰트**: 본문 10pt, 제목 14pt, 큰 숫자 18pt
- **색상**: 메인 #667eea, 성공 #28a745, 경고 #ffc107, 위험 #dc3545

---

## 1P. 표지

### 레이아웃 구조

```
┌─────────────────────────────────────┐
│  [상단 여백 20mm]                    │
│                                      │
│  [로고/브랜드] (선택적)              │
│                                      │
│                                      │
│  [가게 이름]                         │
│  [매장명]                            │
│  (폰트 24pt, 볼드)                   │
│                                      │
│                                      │
│  [기간]                              │
│  YYYY년 MM월 성적표                  │
│  (폰트 16pt)                         │
│                                      │
│                                      │
│  [핵심 숫자 1줄]                     │
│  이번 달은 X만원 매출, Y만원 이익    │
│  (폰트 18pt, 볼드, 메인 색상)        │
│                                      │
│                                      │
│                                      │
│                                      │
│  [하단 문구]                         │
│  "선택받는 가게는, 숫자가 다릅니다"  │
│  (폰트 12pt, 회색)                   │
│                                      │
│  [하단 여백 20mm]                    │
└─────────────────────────────────────┘
```

### 요소 상세

#### [가게 이름]
- **위치**: 상단에서 60mm
- **스타일**: 24pt, 볼드, 중앙 정렬
- **데이터**: `stores.name`

#### [기간]
- **위치**: 가게 이름 아래 20mm
- **스타일**: 16pt, 중앙 정렬
- **데이터**: 선택된 year, month

#### [핵심 숫자 1줄]
- **위치**: 중앙
- **스타일**: 18pt, 볼드, 메인 색상 (#667eea)
- **데이터**: 
  - 매출: `load_monthly_sales_total()`
  - 이익: `actual_settlement.operating_profit`
- **형식**: "이번 달은 **X,XXX만원** 매출, **Y,YYY만원** 이익"

#### [하단 문구]
- **위치**: 하단에서 40mm
- **스타일**: 12pt, 회색, 중앙 정렬
- **텍스트**: "선택받는 가게는, 숫자가 다릅니다"

---

## 2P. 매장 요약

### 레이아웃 구조

```
┌─────────────────────────────────────┐
│  [페이지 제목]                       │
│  매장 요약                          │
│  (14pt, 볼드)                       │
│  ─────────────────────              │
│                                      │
│  [핵심 지표 카드 4개 - 2×2]         │
│  ┌──────────┐ ┌──────────┐        │
│  │ 이번 달   │ │ 영업이익  │        │
│  │ 매출      │ │          │        │
│  │ X만원     │ │ Y만원     │        │
│  └──────────┘ └──────────┘        │
│  ┌──────────┐ ┌──────────┐        │
│  │ 손익분기점│ │ 목표달성률│        │
│  │ Z만원     │ │ W%        │        │
│  └──────────┘ └──────────┘        │
│                                      │
│  [마감률]                            │
│  마감률: XX% (XX/XX일)              │
│  [진행률 바]                         │
│                                      │
│  [이번 달 상태 한 줄]                │
│  "이번 달은 '구조 안정 + 운영 리듬   │
│   양호' 상태입니다."                 │
│  (배경색 박스, 12pt)                 │
│                                      │
└─────────────────────────────────────┘
```

### 요소 상세

#### [페이지 제목]
- **위치**: 상단
- **스타일**: 14pt, 볼드, 왼쪽 정렬

#### [핵심 지표 카드 4개]
- **레이아웃**: 2열 × 2행
- **카드 크기**: 각 80mm × 40mm
- **스타일**: 
  - 배경: 그라데이션 (메인 색상)
  - 텍스트: 흰색
  - 숫자: 18pt, 볼드
  - 라벨: 10pt

**카드 1: 이번 달 매출**
- **데이터**: `load_monthly_sales_total()`
- **형식**: "X,XXX만원"

**카드 2: 영업이익**
- **데이터**: `actual_settlement.operating_profit`
- **형식**: "Y,YYY만원"
- **색상**: 이익 > 0이면 초록, 아니면 빨강

**카드 3: 손익분기점**
- **데이터**: `calculate_break_even_sales()`
- **형식**: "Z,ZZZ만원"

**카드 4: 목표 달성률**
- **데이터**: (실제 매출 / 목표 매출) × 100
- **형식**: "W%"
- **색상**: 100% 이상이면 초록, 아니면 노랑

#### [마감률]
- **위치**: 카드 아래 15mm
- **스타일**: 12pt
- **데이터**: `get_monthly_close_stats()`
- **진행률 바**: 수평 진행률 바 (100mm 너비)

#### [이번 달 상태 한 줄]
- **위치**: 하단
- **스타일**: 배경색 박스 (#e7f3ff), 12pt, 패딩 10mm
- **데이터**: `get_month_status_summary()`

---

## 3P. 매출 흐름

### 레이아웃 구조

```
┌─────────────────────────────────────┐
│  [페이지 제목]                       │
│  매출 흐름                          │
│  ─────────────────────              │
│                                      │
│  [일별 매출 그래프]                  │
│  ┌────────────────────────────┐    │
│  │     [라인 차트]              │    │
│  │     일별 매출 추이            │    │
│  │     (높이 80mm)              │    │
│  └────────────────────────────┘    │
│                                      │
│  [요일별 평균 매출]                  │
│  ┌────────────────────────────┐    │
│  │  [바 차트]                   │    │
│  │  월 화 수 목 금 토 일         │    │
│  │  (높이 60mm)                 │    │
│  └────────────────────────────┘    │
│                                      │
│  [핵심 지표 3개 - 1행]               │
│  전월 대비: +X%                      │
│  최근 3일 평균: Y만원                │
│  객단가: Z,ZZZ원                     │
│                                      │
│  [매출 흐름 문장]                    │
│  "최근 3일 평균이 직전 기간 대비     │
│   X% 증가했습니다."                  │
│  (배경색 박스)                       │
│                                      │
└─────────────────────────────────────┘
```

### 요소 상세

#### [일별 매출 그래프]
- **타입**: 라인 차트
- **크기**: 150mm × 80mm
- **데이터**: `sales` 테이블 일별 집계
- **X축**: 날짜 (1일~말일)
- **Y축**: 매출 (만원 단위)
- **스타일**: 메인 색상 라인, 두께 2pt

#### [요일별 평균 매출]
- **타입**: 바 차트
- **크기**: 150mm × 60mm
- **데이터**: 요일별 그룹핑 후 평균
- **X축**: 월 화 수 목 금 토 일
- **Y축**: 평균 매출
- **스타일**: 각 요일별 다른 색상

#### [핵심 지표 3개]
- **레이아웃**: 1행 3열
- **스타일**: 12pt, 볼드
- **데이터**:
  1. 전월 대비: ((이번 달 - 전월) / 전월) × 100
  2. 최근 3일 평균: 최근 3일 매출 평균
  3. 객단가: 총 매출 / 총 방문자

#### [매출 흐름 문장]
- **위치**: 하단
- **스타일**: 배경색 박스, 12pt
- **데이터**: `get_coach_summary()` 로직 활용

---

## 4P. 손익 구조

### 레이아웃 구조

```
┌─────────────────────────────────────┐
│  [페이지 제목]                       │
│  손익 구조                          │
│  ─────────────────────              │
│                                      │
│  [구조 요약 카드 3개 - 1행]         │
│  ┌──────┐ ┌──────┐ ┌──────┐        │
│  │고정비 │ │변동비│ │손익분│        │
│  │X만원 │ │Y%    │ │Z만원 │        │
│  └──────┘ └──────┘ └──────┘        │
│                                      │
│  [구조 문장]                         │
│  "이 가게는 매출 X만원부터 흑자가    │
│   시작되고, 매출이 10만원 늘면      │
│   약 Y만원이 남는 구조입니다."      │
│  (배경색 박스, 12pt)                 │
│                                      │
│  [매출 구간별 예상 이익 테이블]     │
│  ┌────────────────────────────┐    │
│  │ 매출      │ 이익    │ 이익률 │    │
│  │ X만원     │ Y만원   │ Z%     │    │
│  │ ...       │ ...     │ ...    │    │
│  └────────────────────────────┘    │
│                                      │
│  [실제 매출 vs 손익분기점]           │
│  [진행률 바]                         │
│  손익분기점: X만원                   │
│  실제 매출: Y만원                    │
│  차이: Z만원 (W%)                    │
│                                      │
└─────────────────────────────────────┘
```

### 요소 상세

#### [구조 요약 카드 3개]
- **레이아웃**: 1행 3열
- **카드 크기**: 각 50mm × 50mm
- **스타일**: 그라데이션 배경, 흰색 텍스트

**카드 1: 고정비**
- **데이터**: `get_fixed_costs()`
- **형식**: "X,XXX만원"

**카드 2: 변동비율**
- **데이터**: `get_variable_cost_ratio()` × 100
- **형식**: "Y%"

**카드 3: 손익분기점**
- **데이터**: `calculate_break_even_sales()`
- **형식**: "Z,ZZZ만원"

#### [구조 문장]
- **위치**: 카드 아래 15mm
- **스타일**: 배경색 박스 (#d1ecf1), 12pt, 패딩 10mm
- **데이터**: `get_store_financial_structure()` 로직

#### [매출 구간별 예상 이익 테이블]
- **크기**: 전체 너비, 높이 자동
- **스타일**: 
  - 헤더: 배경색 (#f8f9fa), 볼드
  - 행: 교차 배경색
  - 숫자: 오른쪽 정렬
- **데이터**: `get_store_financial_structure().example_table`
- **컬럼**: 매출, 이익, 이익률

#### [실제 매출 vs 손익분기점]
- **위치**: 하단
- **스타일**: 12pt
- **진행률 바**: 
  - 손익분기점 기준 100%
  - 실제 매출 위치 표시
  - 색상: 초과 시 초록, 미만 시 빨강

---

## 5P. 원가 구조

### 레이아웃 구조

```
┌─────────────────────────────────────┐
│  [페이지 제목]                       │
│  원가 구조                          │
│  ─────────────────────              │
│                                      │
│  [핵심 지표 2개 - 1행]               │
│  총 원가: X만원                      │
│  원가율: Y%                          │
│                                      │
│  [재료별 사용 단가 TOP 10]           │
│  ┌────────────────────────────┐    │
│  │ 순위 │ 재료명 │ 사용단가 │ 비율 ││
│  │  1   │ ...    │ X만원    │ Y%  ││
│  │ ...  │ ...    │ ...      │ ... ││
│  └────────────────────────────┘    │
│                                      │
│  [ABC 분석 결과]                     │
│  A등급: X개 (Y%)                    │
│  B등급: X개 (Y%)                    │
│  C등급: X개 (Y%)                    │
│                                      │
│  [원가 구조 문장]                    │
│  "이번 달 원가율은 X%, 목표 대비     │
│   Y%p 차이입니다."                   │
│  (배경색 박스)                       │
│                                      │
└─────────────────────────────────────┘
```

### 요소 상세

#### [핵심 지표 2개]
- **레이아웃**: 1행 2열
- **스타일**: 14pt, 볼드
- **데이터**:
  1. 총 원가: `calculate_ingredient_usage()` → 총사용단가 합계
  2. 원가율: (총 원가 / 총 매출) × 100

#### [재료별 사용 단가 TOP 10]
- **크기**: 전체 너비
- **스타일**: 
  - 헤더: 배경색, 볼드
  - 행: 교차 배경색
  - 숫자: 오른쪽 정렬, 천단위 구분
- **데이터**: `calculate_ingredient_usage()` → 총사용단가 정렬
- **컬럼**: 순위, 재료명, 사용단가, 비율(%)

#### [ABC 분석 결과]
- **위치**: 테이블 아래
- **스타일**: 12pt
- **데이터**: `abc_analysis()` 결과
- **형식**: "A등급: X개 (누적 Y%), B등급: X개 (누적 Y%), C등급: X개 (누적 Y%)"

#### [원가 구조 문장]
- **위치**: 하단
- **스타일**: 배경색 박스, 12pt
- **데이터**: 실제 원가율 vs 목표 원가율 비교

---

## 6P. 문제 & 잘한 점

### 레이아웃 구조

```
┌─────────────────────────────────────┐
│  [페이지 제목]                       │
│  문제 & 잘한 점                     │
│  ─────────────────────              │
│                                      │
│  [2열 레이아웃]                     │
│  ┌──────────────┬──────────────┐   │
│  │ 문제 TOP 3   │ 잘한 점 TOP 3 │   │
│  │              │              │   │
│  │ 1. [문제 카드]│ 1. [좋은점 카드]││
│  │    배경: 빨강│    배경: 초록│   │
│  │              │              │   │
│  │ 2. [문제 카드]│ 2. [좋은점 카드]││
│  │              │              │   │
│  │ 3. [문제 카드]│ 3. [좋은점 카드]││
│  │              │              │   │
│  └──────────────┴──────────────┘   │
│                                      │
│  [이상 징후]                         │
│  ⚠️ [징후 카드 1]                    │
│  ⚠️ [징후 카드 2]                    │
│  (최대 3개)                          │
│                                      │
└─────────────────────────────────────┘
```

### 요소 상세

#### [2열 레이아웃]
- **비율**: 50% : 50%
- **간격**: 10mm

#### [문제 TOP 3]
- **카드 스타일**: 
  - 배경: #f8d7da (연한 빨강)
  - 테두리: #dc3545 (빨강), 왼쪽 4pt
  - 텍스트: #721c24
- **데이터**: `get_problems_top3()`
- **형식**: 
  - 번호. 문제 텍스트
  - 행동 연결 문장 (작은 글씨)

#### [잘한 점 TOP 3]
- **카드 스타일**: 
  - 배경: #d4edda (연한 초록)
  - 테두리: #28a745 (초록), 왼쪽 4pt
  - 텍스트: #155724
- **데이터**: `get_good_points_top3()`
- **형식**: 번호. 잘한 점 텍스트

#### [이상 징후]
- **카드 스타일**: 
  - 배경: #fff3cd (연한 노랑)
  - 테두리: #ffc107 (노랑), 왼쪽 4pt
  - 텍스트: #856404
- **데이터**: `get_anomaly_signals()`
- **형식**: 아이콘 + 징후 텍스트

---

## 7P. 메뉴 구조

### 레이아웃 구조

```
┌─────────────────────────────────────┐
│  [페이지 제목]                       │
│  메뉴 구조                          │
│  ─────────────────────              │
│                                      │
│  [메뉴별 판매량 TOP 10]              │
│  ┌────────────────────────────┐    │
│  │ 순위 │ 메뉴명 │ 판매량 │ 비율 ││
│  │  1   │ ...   │ X개    │ Y%  ││
│  │ ...  │ ...   │ ...    │ ... ││
│  └────────────────────────────┘    │
│                                      │
│  [메뉴별 이익 TOP 10]                │
│  ┌────────────────────────────┐    │
│  │ 순위 │ 메뉴명 │ 이익   │ 이익률││
│  │  1   │ ...   │ X만원  │ Y%   ││
│  │ ...  │ ...   │ ...    │ ...  ││
│  └────────────────────────────┘    │
│                                      │
│  [메뉴 쏠림도]                       │
│  상위 1개 메뉴 비율: X%              │
│  [파이 차트] (선택적)                │
│                                      │
│  [메뉴 구조 문장]                    │
│  "메뉴 A가 전체의 X% 차지, 하지만    │
│   이익률은 Y%입니다."                │
│  (배경색 박스)                       │
│                                      │
└─────────────────────────────────────┘
```

### 요소 상세

#### [메뉴별 판매량 TOP 10]
- **크기**: 전체 너비
- **스타일**: 표준 테이블
- **데이터**: `v_daily_sales_items_effective` → 메뉴별 합계
- **컬럼**: 순위, 메뉴명, 판매량, 비율(%)

#### [메뉴별 이익 TOP 10]
- **크기**: 전체 너비
- **스타일**: 표준 테이블
- **데이터**: 메뉴별 매출 - 메뉴별 원가
- **컬럼**: 순위, 메뉴명, 이익, 이익률(%)

#### [메뉴 쏠림도]
- **위치**: 테이블 아래
- **스타일**: 12pt, 볼드
- **데이터**: (최대 판매량 / 전체 판매량) × 100
- **파이 차트**: 선택적 (공간 여유 시)

#### [메뉴 구조 문장]
- **위치**: 하단
- **스타일**: 배경색 박스, 12pt
- **데이터**: 메뉴별 판매량/이익 분석 결과

---

## 8P. 코치 총평

### 레이아웃 구조

```
┌─────────────────────────────────────┐
│  [페이지 제목]                       │
│  코치 총평                          │
│  ─────────────────────              │
│                                      │
│  [이번 달 코치 요약]                 │
│  "이번 달은 구조가 안정적이고,       │
│   운영 리듬도 잘 유지되고 있습니다." │
│  (큰 박스, 14pt, 배경색)             │
│                                      │
│  [핵심 개선 포인트 3개]              │
│  1. [개선 포인트 카드]               │
│     - 문제: ...                     │
│     - 해결: ...                     │
│                                      │
│  2. [개선 포인트 카드]               │
│                                      │
│  3. [개선 포인트 카드]               │
│                                      │
│  [다음 달 목표 제안]                 │
│  목표 매출: X만원                    │
│  예상 이익: Y만원                    │
│  [진행률 바] (목표 달성 시뮬레이션)   │
│                                      │
│  [성장 시뮬레이션]                   │
│  "매출이 10% 오르면 이익은 X% 오릅니다"│
│                                      │
│  [코치 총평 문장]                    │
│  "이 가게는 구조적으로 건강하고,      │
│   다음 달은 X에 집중하면 Y가         │
│   개선됩니다."                       │
│  (배경색 박스, 12pt)                 │
│                                      │
└─────────────────────────────────────┘
```

### 요소 상세

#### [이번 달 코치 요약]
- **위치**: 상단
- **스타일**: 큰 박스, 배경색 (#e7f3ff), 14pt, 패딩 15mm
- **데이터**: `get_coach_summary()`

#### [핵심 개선 포인트 3개]
- **카드 스타일**: 
  - 배경: #fff3cd (연한 노랑)
  - 테두리: #ffc107 (노랑), 왼쪽 4pt
  - 패딩: 10mm
- **데이터**: `get_problems_top3()` + 구조 분석 조합
- **형식**: 
  - 문제: 문제 텍스트
  - 해결: 행동 제안

#### [다음 달 목표 제안]
- **스타일**: 12pt, 볼드
- **데이터**: 
  - 목표 매출: 이번 달 실제 × 1.1 (10% 성장 가정)
  - 예상 이익: (목표 매출 × (1 - 변동비율)) - 고정비
- **진행률 바**: 목표 달성 시뮬레이션

#### [성장 시뮬레이션]
- **위치**: 목표 제안 아래
- **스타일**: 12pt
- **데이터**: 
  - 현재 매출 × 1.1 (10% 증가)
  - 예상 이익 계산
  - 이익 증가율 계산

#### [코치 총평 문장]
- **위치**: 하단
- **스타일**: 배경색 박스, 12pt, 패딩 10mm
- **데이터**: 전체 분석 종합 (룰 기반)

---

## 공통 디자인 요소

### 색상 팔레트
- **메인**: #667eea (보라)
- **성공**: #28a745 (초록)
- **경고**: #ffc107 (노랑)
- **위험**: #dc3545 (빨강)
- **중립**: #6c757d (회색)
- **배경**: #f8f9fa (연한 회색)
- **텍스트**: #333333 (진한 회색)

### 타이포그래피
- **페이지 제목**: 14pt, 볼드, 왼쪽 정렬
- **섹션 제목**: 12pt, 볼드
- **본문**: 10pt, 일반
- **큰 숫자**: 18pt, 볼드
- **작은 텍스트**: 8pt, 일반

### 간격 규칙
- **페이지 여백**: 20mm
- **섹션 간격**: 15mm
- **요소 간격**: 10mm
- **카드 내부 패딩**: 10mm

### 테이블 스타일
- **헤더**: 배경색 #f8f9fa, 볼드, 중앙 정렬
- **행**: 교차 배경색 (#ffffff, #f8f9fa)
- **숫자**: 오른쪽 정렬, 천단위 구분
- **텍스트**: 왼쪽 정렬

### 카드 스타일
- **기본**: 둥근 모서리 (8px), 그림자 효과
- **그라데이션**: 메인 색상 그라데이션
- **텍스트**: 흰색 (그라데이션 배경 시)

### 차트 스타일
- **라인 차트**: 메인 색상, 두께 2pt
- **바 차트**: 각 항목별 다른 색상
- **파이 차트**: 색상 팔레트 사용

---

## 페이지 순서 최적화

### 권장 순서
1. **1P. 표지** - 첫인상
2. **2P. 매장 요약** - 핵심 현황
3. **4P. 손익 구조** - 구조 이해 (가장 중요)
4. **6P. 문제 & 잘한 점** - 행동 유도
5. **3P. 매출 흐름** - 흐름 분석
6. **5P. 원가 구조** - 원가 분석
7. **7P. 메뉴 구조** - 메뉴 분석
8. **8P. 코치 총평** - 전략 제안

### 읽기 흐름
1. 표지 → 요약 (전체 파악)
2. 구조 → 문제 (핵심 이해)
3. 흐름 → 원가 → 메뉴 (상세 분석)
4. 총평 (종합 및 전략)

---

## 반응형 고려사항

### 데이터 부족 시 처리

#### 매출 데이터 없음
- 3P: "아직 매출 데이터가 없습니다" 메시지
- 그래프 대신 텍스트 안내

#### 정산 데이터 없음
- 2P, 4P: "목표 구조 기준" 표시
- 이익 관련 지표는 "계산 예정" 표시

#### 원가 데이터 없음
- 5P: "원가 데이터가 없습니다" 메시지
- 테이블 대신 안내 문구

#### 메뉴 데이터 없음
- 7P: "메뉴 데이터가 없습니다" 메시지
- 테이블 대신 안내 문구

### 페이지 수 조정
- 데이터 부족 시 해당 페이지 생략 가능
- 최소 4페이지 (표지, 요약, 구조, 총평)는 항상 포함

---

## 구현 우선순위

### Phase 1 (MVP): 핵심 4페이지
1. 1P. 표지
2. 2P. 매장 요약
3. 4P. 손익 구조
4. 8P. 코치 총평

### Phase 2: 분석 강화
5. 6P. 문제 & 잘한 점
6. 3P. 매출 흐름

### Phase 3: 완성도 향상
7. 5P. 원가 구조
8. 7P. 메뉴 구조

---

## 결론

이 구조도는 PDF 렌더링 코드 구현의 기준이 됩니다.

**핵심 원칙**:
- 숫자보다 의미 문장 우선
- 구조 이해가 판단보다 먼저
- 사장의 질문에 답하는 레이아웃
- 데이터 부족 시에도 안정적 표시

**다음 단계**: PHASE 7-4 PDF 렌더링 코드 구현
