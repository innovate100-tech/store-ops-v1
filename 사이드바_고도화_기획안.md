# 사이드바 고도화 기획안

## 1. 개요
현재 사이드바를 고도화하여 접기/펼치기 기능을 추가하고, 사이드바 폭을 줄여 메인 콘텐츠 영역을 확대합니다. 버튼 순서와 구조는 그대로 유지합니다.

## 2. 주요 개선 사항

### 2.1 사이드바 접기/펼치기 기능
- **토글 버튼 추가**: 사이드바 상단에 접기/펼치기 토글 버튼 추가
- **접힌 상태**: 아이콘만 표시 (폭 최소화)
- **펼친 상태**: 전체 메뉴 표시 (기존과 동일)

### 2.2 사이드바 폭 축소
- **현재 폭**: 21rem (약 336px)
- **변경 후 폭**: 15rem (약 240px) 또는 18rem (약 288px)
- **접힌 상태 폭**: 4rem (약 64px) - 아이콘만 표시

### 2.3 버튼 순서 및 구조 유지
- 기존 메뉴 구조 그대로 유지
- 버튼 순서 변경 없음
- 카테고리 구분 유지

## 3. 상세 설계

### 3.1 사이드바 상태 관리

#### 상태 정의
```python
# session_state에 사이드바 상태 저장
if "sidebar_collapsed" not in st.session_state:
    st.session_state.sidebar_collapsed = False
```

#### 토글 버튼
- 위치: 사이드바 최상단
- 아이콘: 접힌 상태 → `▶`, 펼친 상태 → `◀`
- 클릭 시: `st.session_state.sidebar_collapsed` 토글

### 3.2 사이드바 폭 설정

#### CSS 변경
```css
/* 펼친 상태 */
[data-testid="stSidebar"]:not(.collapsed) {
    width: 15rem !important;  /* 기존 21rem에서 축소 */
    min-width: 15rem !important;
    max-width: 15rem !important;
}

/* 접힌 상태 */
[data-testid="stSidebar"].collapsed {
    width: 4rem !important;
    min-width: 4rem !important;
    max-width: 4rem !important;
}
```

### 3.3 접힌 상태 UI

#### 표시 내용
- **카테고리 아이콘만 표시**: 🏠, 🧠, 📊, ✍, 🛠
- **버튼 텍스트 숨김**: 아이콘만 보이도록
- **툴팁 추가**: 마우스 오버 시 카테고리명 표시

#### 레이아웃
```
접힌 상태:
┌────┐
│ 🏠 │
│ 🧠 │
│ 📊 │
│ ✍ │
│ 🛠 │
│ 🚪 │
│ 🔄 │
└────┘

펼친 상태 (기존과 동일):
┌──────────────────┐
│ ◀ 접기           │
│ 🏠 홈            │
│                  │
│ 🧠 설계          │
│   가게 전략 센터  │
│   [상세 선택 ▼]   │
│                  │
│ ...              │
└──────────────────┘
```

## 4. 구현 상세

### 4.1 토글 버튼 추가

#### 위치 및 스타일
```python
# 사이드바 최상단에 토글 버튼 추가
with st.sidebar:
    # 토글 버튼
    toggle_icon = "◀" if st.session_state.sidebar_collapsed else "▶"
    if st.button(toggle_icon, key="sidebar_toggle", use_container_width=True):
        st.session_state.sidebar_collapsed = not st.session_state.sidebar_collapsed
        st.rerun()
    
    # 접힌 상태면 여기서 return (아이콘만 표시)
    if st.session_state.sidebar_collapsed:
        # 아이콘만 표시하는 간단한 메뉴
        _render_collapsed_sidebar(menu)
        return
```

### 4.2 접힌 상태 렌더링 함수

```python
def _render_collapsed_sidebar(menu):
    """접힌 사이드바 렌더링 (아이콘만 표시)"""
    # 카테고리별 아이콘 매핑
    category_icons = {
        "🏠 홈": "🏠",
        "🧠 설계": "🧠",
        "📊 분석": "📊",
        "✍ 입력": "✍",
        "🛠 운영": "🛠"
    }
    
    for cat, data in menu.items():
        icon = category_icons.get(cat, "📋")
        if st.button(icon, key=f"collapsed_{cat}", use_container_width=True):
            # 펼치고 해당 카테고리로 이동
            st.session_state.sidebar_collapsed = False
            # 첫 번째 메뉴 항목으로 이동
            if isinstance(data, list):
                st.session_state.current_page = data[0][1]
            else:
                st.session_state.current_page = data["main"][0][1]
            st.rerun()
    
    # 로그아웃, 캐시 클리어 버튼
    st.markdown("<br>", unsafe_allow_html=True)
    if st.button("🚪", key="collapsed_logout", use_container_width=True):
        logout()
        st.rerun()
    if st.button("🔄", key="collapsed_clear", use_container_width=True):
        load_csv.clear()
        st.rerun()
```

### 4.3 CSS 스타일 추가

#### 사이드바 폭 조정
```css
/* 사이드바 기본 폭 축소 */
[data-testid="stSidebar"] {
    width: 15rem !important;  /* 기존 21rem → 15rem */
    min-width: 15rem !important;
    max-width: 15rem !important;
    transition: width 0.3s ease !important;
}

/* 접힌 상태 */
[data-testid="stSidebar"].collapsed {
    width: 4rem !important;
    min-width: 4rem !important;
    max-width: 4rem !important;
}

/* 접힌 상태에서 텍스트 숨김 */
[data-testid="stSidebar"].collapsed .stMarkdown:not(.icon-only),
[data-testid="stSidebar"].collapsed .stButton > button span:not(.icon-only) {
    display: none !important;
}

/* 접힌 상태에서 버튼 중앙 정렬 */
[data-testid="stSidebar"].collapsed .stButton > button {
    justify-content: center !important;
    padding: 0.5rem !important;
}
```

### 4.4 JavaScript 추가 (선택사항)

접힌 상태에서 마우스 오버 시 툴팁 표시:
```javascript
// 접힌 사이드바 버튼에 툴팁 추가
document.querySelectorAll('[data-testid="stSidebar"].collapsed button').forEach(btn => {
    btn.addEventListener('mouseenter', function(e) {
        // 툴팁 표시 로직
    });
});
```

## 5. 변경 사항 요약

### 5.1 파일 수정 목록

#### `app.py`
- 사이드바 섹션에 토글 버튼 추가
- 접힌 상태 렌더링 함수 추가
- 조건부 렌더링 로직 추가

#### CSS 파일 (또는 `app.py` 내부 스타일)
- 사이드바 폭 축소 (21rem → 15rem)
- 접힌 상태 스타일 추가
- 트랜지션 효과 추가

### 5.2 기능 추가

1. **토글 버튼**
   - 위치: 사이드바 최상단
   - 기능: 사이드바 접기/펼치기
   - 상태: session_state에 저장

2. **접힌 상태 UI**
   - 아이콘만 표시
   - 버튼 클릭 시 펼치고 해당 페이지로 이동
   - 툴팁 표시 (선택사항)

3. **폭 축소**
   - 펼친 상태: 15rem (기존 21rem에서 약 29% 축소)
   - 접힌 상태: 4rem

## 6. UI/UX 개선 효과

### 6.1 공간 활용도 향상
- 메인 콘텐츠 영역 확대 (약 6rem = 96px 추가 공간)
- 접힌 상태에서 최대 공간 확보

### 6.2 사용성 향상
- 필요 시에만 사이드바 표시
- 빠른 접근을 위한 접힌 상태 아이콘 메뉴
- 부드러운 트랜지션 효과

### 6.3 일관성 유지
- 기존 버튼 순서 및 구조 유지
- 기존 기능 모두 유지
- 사용자 학습 부담 최소화

## 7. 구현 체크리스트

### 7.1 기본 기능
- [ ] session_state에 `sidebar_collapsed` 상태 추가
- [ ] 토글 버튼 추가 (사이드바 최상단)
- [ ] 접힌 상태 렌더링 함수 구현
- [ ] 조건부 렌더링 로직 추가

### 7.2 스타일링
- [ ] 사이드바 폭 축소 (21rem → 15rem)
- [ ] 접힌 상태 폭 설정 (4rem)
- [ ] 트랜지션 효과 추가
- [ ] 접힌 상태 텍스트 숨김 처리

### 7.3 기능 테스트
- [ ] 토글 버튼 클릭 시 접기/펼치기 동작 확인
- [ ] 접힌 상태에서 아이콘 클릭 시 페이지 이동 확인
- [ ] 버튼 순서 및 구조 유지 확인
- [ ] 반응형 동작 확인

## 8. 기술적 고려사항

### 8.1 Streamlit 제한사항
- Streamlit은 기본적으로 사이드바 접기/펼치기를 지원하지 않음
- CSS와 JavaScript를 활용한 커스텀 구현 필요
- `st.rerun()`을 통한 상태 업데이트 필요

### 8.2 상태 관리
- `st.session_state`를 사용하여 접힌 상태 저장
- 페이지 이동 시에도 상태 유지
- 브라우저 새로고침 시 기본값(펼친 상태)으로 리셋

### 8.3 호환성
- 기존 사이드바 구조와 완전 호환
- 기존 버튼 키 유지
- 기존 라우팅 로직 유지

## 9. 예상 결과

### 9.1 펼친 상태
- 사이드바 폭: 15rem (기존 21rem에서 약 29% 축소)
- 전체 메뉴 표시
- 토글 버튼: `◀` (접기)

### 9.2 접힌 상태
- 사이드바 폭: 4rem (최소화)
- 아이콘만 표시
- 토글 버튼: `▶` (펼치기)
- 메인 콘텐츠 영역 최대 확보

### 9.3 사용자 경험
- 필요 시에만 사이드바 표시 가능
- 빠른 페이지 이동을 위한 아이콘 메뉴
- 부드러운 애니메이션 효과
- 기존 기능 모두 유지

## 10. 추가 개선 아이디어 (선택사항)

### 10.1 키보드 단축키
- `Ctrl + B`: 사이드바 토글
- 접근성 향상

### 10.2 자동 접기
- 모바일 화면에서 자동으로 접힌 상태
- 반응형 디자인

### 10.3 애니메이션
- 부드러운 슬라이드 애니메이션
- 페이드 인/아웃 효과

### 10.4 사용자 설정
- 사용자별 기본 상태 저장 (DB 또는 localStorage)
- 개인화 옵션
