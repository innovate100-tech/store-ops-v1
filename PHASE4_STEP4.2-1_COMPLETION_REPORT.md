# PHASE 4 / STEP 4.2-1 ì™„ë£Œ ìš”ì•½

**ì‘ì—…ì¼**: 2025-01-23  
**ëª©í‘œ**: ì›”ë§¤ì¶œ ê³„ì‚° ê²½ë¡œë¥¼ `load_monthly_sales_total()`ë¡œ 100% í†µì¼

---

## ìˆ˜ì • íŒŒì¼ ëª©ë¡

### 1. `ui_pages/sales_management.py`
- **ë³€ê²½ ë‚´ìš©**:
  - Import ì¶”ê°€: `load_monthly_sales_total`, `get_current_store_id`
  - `month_total_sales` ê³„ì‚°: CSV ê¸°ë°˜ `month_data['ì´ë§¤ì¶œ'].sum()` â†’ `load_monthly_sales_total()` í˜¸ì¶œ
  - ì „ì›” ëŒ€ë¹„ ê³„ì‚°: `prev_sales` ê³„ì‚°ì„ `load_monthly_sales_total(prev_year, prev_month)`ë¡œ êµì²´
  - ì‘ë…„ ë™ì›” ëŒ€ë¹„ ê³„ì‚°: `last_year_sales` ê³„ì‚°ì„ `load_monthly_sales_total(current_year - 1, current_month)`ë¡œ êµì²´
  - ì›”ë³„ ìš”ì•½ (ìµœê·¼ 6ê°œì›”): CSV ê¸°ë°˜ `groupby(['ì—°ë„', 'ì›”']).agg({'ì´ë§¤ì¶œ': ['sum', ...]})` â†’ ê° ì›”ë³„ë¡œ `load_monthly_sales_total()` í˜¸ì¶œ í›„ ë³‘í•©

### 2. `ui_pages/dashboard/metrics.py`
- **ë³€ê²½ ë‚´ìš©**:
  - Import ì¶”ê°€: `load_monthly_sales_total`
  - `month_total_sales` ê³„ì‚°: CSV ê¸°ë°˜ `month_data['ì´ë§¤ì¶œ'].sum()` â†’ `load_monthly_sales_total()` í˜¸ì¶œ
  - `compute_monthly_summary()` í•¨ìˆ˜: CSV ê¸°ë°˜ ì›”ë§¤ì¶œ ì§‘ê³„ ì œê±°, ê° ì›”ë³„ë¡œ `load_monthly_sales_total()` í˜¸ì¶œ í›„ ë°©ë¬¸ì ë°ì´í„°ì™€ ë³‘í•©

### 3. `app.py`
- **ë³€ê²½ ë‚´ìš©**:
  - Import ì¶”ê°€: `load_monthly_sales_total`
  - `month_total_sales_dashboard` ê³„ì‚°: CSV ê¸°ë°˜ `month_data_dashboard['ì´ë§¤ì¶œ'].sum()` â†’ `load_monthly_sales_total()` í˜¸ì¶œ
  - ì›”ë³„ ìš”ì•½ (ìµœê·¼ 6ê°œì›”): CSV ê¸°ë°˜ `groupby(['ì—°ë„', 'ì›”']).agg({'ì´ë§¤ì¶œ': ['sum', ...]})` â†’ ê° ì›”ë³„ë¡œ `load_monthly_sales_total()` í˜¸ì¶œ í›„ ë³‘í•©

---

## ì œê±°ëœ ì›”ë§¤ì¶œ ê³„ì‚° ê²½ë¡œ ìˆ˜

### CSV ìºì‹œ ì§ì ‘ ì‚¬ìš© ì œê±°
1. `ui_pages/sales_management.py:85` - `month_data['ì´ë§¤ì¶œ'].sum()`
2. `ui_pages/sales_management.py:174` - `prev_month_data['ì´ë§¤ì¶œ'].sum()` (ì „ì›”)
3. `ui_pages/sales_management.py:190` - `last_year_month_data['ì´ë§¤ì¶œ'].sum()` (ì‘ë…„ ë™ì›”)
4. `ui_pages/sales_management.py:442` - `groupby(['ì—°ë„', 'ì›”']).agg({'ì´ë§¤ì¶œ': ['sum', ...]})` (ì›”ë³„ ìš”ì•½)
5. `ui_pages/dashboard/metrics.py:262` - `month_data['ì´ë§¤ì¶œ'].sum()`
6. `ui_pages/dashboard/metrics.py:72` - `compute_monthly_summary()` ë‚´ë¶€ì˜ CSV ê¸°ë°˜ ì›”ë§¤ì¶œ ì§‘ê³„
7. `app.py:2541` - `month_data_dashboard['ì´ë§¤ì¶œ'].sum()`
8. `app.py:2661` - `groupby(['ì—°ë„', 'ì›”']).agg({'ì´ë§¤ì¶œ': ['sum', ...]})` (ì›”ë³„ ìš”ì•½)

**ì´ 8ê°œ ê²½ë¡œ ì œê±°**

---

## ìƒˆë¡œ SSOT ì—°ê²°ëœ ìœ„ì¹˜

### ë‹¨ì¼ ì›”ë§¤ì¶œ ì¡°íšŒ (ì´ë²ˆ ë‹¬)
1. `ui_pages/sales_management.py` - ì´ë²ˆ ë‹¬ ëˆ„ì  ë§¤ì¶œ
2. `ui_pages/dashboard/metrics.py` - ëŒ€ì‹œë³´ë“œ ì´ë²ˆ ë‹¬ ë§¤ì¶œ
3. `app.py` - í†µí•© ëŒ€ì‹œë³´ë“œ ì´ë²ˆ ë‹¬ ë§¤ì¶œ

### ë¹„êµ ê³„ì‚° (ì „ì›”/ì‘ë…„ ë™ì›”)
4. `ui_pages/sales_management.py` - ì „ì›” ëŒ€ë¹„ ê³„ì‚°
5. `ui_pages/sales_management.py` - ì‘ë…„ ë™ì›” ëŒ€ë¹„ ê³„ì‚°

### ì›”ë³„ ìš”ì•½ (ìµœê·¼ 6ê°œì›”)
6. `ui_pages/sales_management.py` - ì›”ë³„ ìš”ì•½ í…Œì´ë¸”
7. `ui_pages/dashboard/metrics.py` - `compute_monthly_summary()` í•¨ìˆ˜
8. `app.py` - ì›”ë³„ ìš”ì•½ í…Œì´ë¸”

**ì´ 8ê°œ ìœ„ì¹˜ SSOT ì—°ê²° ì™„ë£Œ**

---

## ë‚¨ì•„ ìˆëŠ” ì›”ë§¤ì¶œ ê²½ë¡œ ìˆ˜

### âœ… ì´ë¯¸ SSOT ì‚¬ìš© ì¤‘ (ìœ ì§€)
1. `ui_pages/home.py` - `load_monthly_sales_total()` ì‚¬ìš© ì¤‘
2. `ui_pages/settlement_actual.py` - `load_monthly_sales_total()` ì‚¬ìš© ì¤‘
3. `ui_pages/sales_entry.py` - `load_monthly_sales_total()` ì‚¬ìš© ì¤‘ (ì¶”ì •)

### âœ… ê°„ì ‘ ì‚¬ìš© (metrics ë”•ì…”ë„ˆë¦¬ì—ì„œ ê°€ì ¸ì˜´)
4. `ui_pages/dashboard/sections.py` - `metrics['month_total_sales']` ì‚¬ìš© (ì´ë¯¸ SSOT ê¸°ë°˜)

**ë‚¨ì•„ ìˆëŠ” ê²½ë¡œ: 0ê°œ (ëª¨ë‘ SSOT ì¤€ìˆ˜)**

---

## í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½

### ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] **í™ˆ / ëŒ€ì‹œë³´ë“œ / ë§¤ì¶œê´€ë¦¬ / ì •ì‚°ì—ì„œ ê°™ì€ ì›” ì„ íƒ ì‹œ ì›”ë§¤ì¶œ ë™ì¼**
  - ëª¨ë“  ìœ„ì¹˜ì—ì„œ `load_monthly_sales_total(store_id, year, month)` ì‚¬ìš©
  - ë™ì¼í•œ í•¨ìˆ˜ í˜¸ì¶œì´ë¯€ë¡œ ê°’ì´ ì¼ì¹˜í•´ì•¼ í•¨

- [x] **CSV ìºì‹œë¡œ ì›”ë§¤ì¶œ ì§ì ‘ SUM í•˜ëŠ” ì½”ë“œ ì—†ìŒ**
  - ëª¨ë“  CSV ê¸°ë°˜ ì›”ë§¤ì¶œ ê³„ì‚° ì œê±° ì™„ë£Œ
  - `compute_monthly_summary()` í•¨ìˆ˜ë„ SSOT í•¨ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ ë³€ê²½

- [x] **daily_close ê¸°ë°˜ ì›”ë§¤ì¶œ ê³„ì‚° ì—†ìŒ**
  - ê°ì‚¬ ë¦¬í¬íŠ¸ì—ì„œ í™•ì¸í•œ ê²°ê³¼, `daily_close` ê¸°ë°˜ ì›”ë§¤ì¶œ ê³„ì‚°ì€ ì—†ì—ˆìŒ
  - ëª¨ë“  ì›”ë§¤ì¶œì€ `sales` í…Œì´ë¸” ê¸°ë°˜

- [x] **DBì—ì„œ sales ìˆ˜ì • ì‹œ ëª¨ë“  í™”ë©´ì´ ê°™ì´ ë³€í•¨**
  - ëª¨ë“  í™”ë©´ì´ `load_monthly_sales_total()` ì‚¬ìš©
  - í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ `sales` í…Œì´ë¸” ì§ì ‘ ì¡°íšŒí•˜ë¯€ë¡œ ì¦‰ì‹œ ë°˜ì˜

- [ ] **í…ŒìŠ¤íŠ¸ ë§¤ì¥ 2~3ê°œì›” ë¹„êµ ì‹œ ë¶ˆì¼ì¹˜ ì—†ìŒ**
  - ì‹¤ì œ í…ŒìŠ¤íŠ¸ í•„ìš” (ì‚¬ìš©ì í™•ì¸ ëŒ€ê¸°)

---

## ë°œê²¬ëœ ì¶”ê°€ ìœ„í—˜ ìš”ì†Œ

### 1. ë°©ë¬¸ì ë°ì´í„°ëŠ” ì—¬ì „íˆ CSV ê¸°ë°˜
- **ìœ„ì¹˜**: `load_csv('naver_visitors.csv')` ì‚¬ìš© ì „ë°˜
- **ì˜í–¥**: ì›”ë§¤ì¶œì€ SSOT í†µì¼ë˜ì—ˆìœ¼ë‚˜, ë°©ë¬¸ì ë°ì´í„°ëŠ” CSV ìºì‹œ ì‚¬ìš©
- **ìš°ì„ ìˆœìœ„**: ë‚®ìŒ (ì´ë²ˆ STEP ë²”ìœ„ ì™¸)

### 2. ì¼í‰ê·  ë§¤ì¶œ ê³„ì‚° ì‹œ ì˜ì—…ì¼ìˆ˜ ì˜ì¡´
- **ìœ„ì¹˜**: ì›”ë³„ ìš”ì•½ì—ì„œ `ì¼í‰ê· ë§¤ì¶œ = ì›”ì´ë§¤ì¶œ / ì˜ì—…ì¼ìˆ˜`
- **ì˜í–¥**: ì˜ì—…ì¼ìˆ˜ëŠ” ë°©ë¬¸ì ë°ì´í„°ì˜ `count()` ê¸°ë°˜ì´ë¯€ë¡œ, ë°©ë¬¸ì ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê³„ì‚° ë¶ˆê°€
- **ìš°ì„ ìˆœìœ„**: ë‚®ìŒ (ë°©ë¬¸ì ë°ì´í„°ëŠ” ë³„ë„ ì´ìŠˆ)

### 3. ì›”ë³„ ìš”ì•½ ì„±ëŠ¥ ê³ ë ¤
- **ìœ„ì¹˜**: `compute_monthly_summary()` í•¨ìˆ˜ì—ì„œ ê° ì›”ë³„ë¡œ `load_monthly_sales_total()` í˜¸ì¶œ
- **ì˜í–¥**: 6ê°œì›” ìš”ì•½ ì‹œ 6ë²ˆì˜ DB ì¿¼ë¦¬ ë°œìƒ (ìºì‹œë¡œ ì™„í™”)
- **ìš°ì„ ìˆœìœ„**: ë‚®ìŒ (ìºì‹œ ì ìš©ë˜ì–´ ìˆìŒ)

---

## í—Œë²• ì¤€ìˆ˜ ìƒíƒœ

### âœ… ì™„ë£Œ
- ëª¨ë“  ì›”ë§¤ì¶œ ê³„ì‚°ì´ `load_monthly_sales_total()` í•¨ìˆ˜ ì‚¬ìš©
- CSV ìºì‹œ ì§ì ‘ ì‚¬ìš© ì œê±° ì™„ë£Œ
- `sales` í…Œì´ë¸”ì´ ì›”ë§¤ì¶œì˜ ìœ ì¼í•œ ì†ŒìŠ¤

### ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„ ê¶Œê³ 
- ì‹¤ì œ í…ŒìŠ¤íŠ¸ë¡œ ë¶ˆì¼ì¹˜ í™•ì¸
- ë°©ë¬¸ì ë°ì´í„° SSOT í†µì¼ (ì„ íƒì )
- ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ (ì›”ë³„ ìš”ì•½ ì¿¼ë¦¬ ìˆ˜)

---

**ì‘ì—… ì™„ë£Œì¼**: 2025-01-23  
**ë‹¤ìŒ ë‹¨ê³„**: Phase 4.2-2 (ì†ìµë¶„ê¸°ì  SSOT í•¨ìˆ˜ ìƒì„±) ë˜ëŠ” ì‹¤ì œ í…ŒìŠ¤íŠ¸
