# 🔧 RLS 정책 8개 문제 해결 가이드

## 문제 상황

정책이 8개가 보이는 이유:
- 기존에 정책이 4개 있었고
- 새로 생성하면서 또 4개가 추가되어서
- 총 8개가 되었습니다

---

## ✅ 해결 방법 (2가지)

### 방법 1: 중복 정책 정리 스크립트 사용 (권장)

#### 1단계: 기존 정책 모두 삭제

1. Supabase → **SQL Editor** 클릭
2. `sql/cleanup_duplicate_policies.sql` 파일 내용 복사
3. 붙여넣기
4. **"Run"** 버튼 클릭

#### 2단계: 정책 재생성

1. 입력창 내용 모두 삭제 (`Ctrl + A` → `Delete`)
2. 아래 코드 붙여넣기:
   ```sql
   SELECT create_all_rls_policies();
   ```
3. **"Run"** 버튼 클릭
4. ✅ 완료! 이제 4개만 보일 것입니다.

---

### 방법 2: 수동으로 정책 확인 및 삭제

#### 1단계: 어떤 정책이 있는지 확인

1. Supabase → **Table Editor** 클릭
2. 아무 테이블 선택 (예: `sales`)
3. 상단 **"Policies"** 탭 클릭
4. 정책 목록 확인

#### 2단계: 중복 정책 삭제

1. **"Policies"** 탭에서 중복된 정책 확인
2. 각 정책 옆에 **"삭제"** 또는 **"Delete"** 버튼 클릭
3. 중복된 정책만 삭제 (4개만 남기기)

---

## 🎯 정상 상태

각 테이블당 **4개의 정책**이 있어야 합니다:

1. ✅ **"Users can view [테이블명] from their store"** (SELECT)
2. ✅ **"Users can insert [테이블명] to their store"** (INSERT)
3. ✅ **"Users can update [테이블명] in their store"** (UPDATE)
4. ✅ **"Users can delete [테이블명] from their store"** (DELETE)

---

## 💡 왜 8개가 되었나요?

- 기존에 `schema.sql`에서 정책이 4개 생성되어 있었습니다
- 그 후 `create_all_rls_policies()` 함수를 실행하면서 또 4개가 추가되었습니다
- 정책 이름이 같아도 PostgreSQL은 중복 생성이 가능합니다

---

## 🚀 빠른 해결 (복사해서 사용)

### Supabase SQL Editor에서 실행:

```sql
-- 1단계: 모든 정책 삭제 (sales 테이블 예시)
DROP POLICY IF EXISTS "Users can view sales from their store" ON sales;
DROP POLICY IF EXISTS "Users can insert sales to their store" ON sales;
DROP POLICY IF EXISTS "Users can update sales in their store" ON sales;
DROP POLICY IF EXISTS "Users can delete sales from their store" ON sales;

-- 2단계: 정책 재생성
SELECT create_all_rls_policies();
```

**주의**: 모든 테이블에 대해 위 작업을 반복하거나, `cleanup_duplicate_policies.sql` 파일을 사용하세요.

---

## ✅ 확인 방법

1. **Table Editor** → 테이블 선택 → **"Policies"** 탭
2. 정책이 **정확히 4개**인지 확인
3. 정책 이름이 위의 4개와 일치하는지 확인

---

## 🆘 문제가 계속되나요?

1. 정책 이름을 확인해주세요 (복사해서 알려주시면 도와드립니다)
2. 어떤 테이블에서 8개가 보이는지 알려주세요
3. 에러 메시지가 있다면 복사해서 알려주세요
