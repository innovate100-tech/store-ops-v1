# PHASE 9 / STEP 9-5A β€” Menu Portfolio Design Lab μ™„λ£

## π“‹ μ‘μ—… λ©ν‘

κΈ°μ΅΄ "λ©”λ‰΄ μ„¤κ³„μ‹¤(menu_management)"μ„ "λ©”λ‰΄ ν¬νΈν΄λ¦¬μ¤ μ„¤κ³„μ‹¤"λ΅ μ—…κ·Έλ μ΄λ“ν–μµλ‹λ‹¤.
κ³µν†µ ν”„λ μ„(Design Lab 4μΈµ κµ¬μ΅°)μ€ μ μ§€ν•κ³ , ZONE A/B/Cμ λ‚΄μ©κ³Ό ZONE Dμ μ„¤κ³„ λ„κµ¬λ¥Ό ν¬νΈν΄λ¦¬μ¤ κ΄€μ μΌλ΅ κ°•ν™”ν–μµλ‹λ‹¤.

---

## β… μ™„λ£λ μ‘μ—…

### 1. ν¬νΈν΄λ¦¬μ¤ ν—¬νΌ ν•¨μ μƒμ„±
- **νμΌ**: `ui_pages/design_lab/menu_portfolio_helpers.py` (μ‹ κ· μƒμ„±)
- **κΈ°λ¥**: ν¬νΈν΄λ¦¬μ¤ κ΄€λ ¨ ν—¬νΌ ν•¨μ
  - `get_menu_portfolio_tags()`: μ—­ν•  νƒκ·Έ μ΅°ν (session_state)
  - `set_menu_portfolio_tag()`: μ—­ν•  νƒκ·Έ μ €μ¥ (session_state)
  - `get_menu_portfolio_categories()`: μΉ΄ν…κ³ λ¦¬ μ΅°ν (DB + session_state)
  - `set_menu_portfolio_category()`: μΉ΄ν…κ³ λ¦¬ μ €μ¥ (DB + session_state)
  - `calculate_portfolio_balance_score()`: ν¬νΈν΄λ¦¬μ¤ κ· ν• μ μ κ³„μ‚°
  - `get_portfolio_verdict()`: ν¬νΈν΄λ¦¬μ¤ νκ²°λ¬Έ μƒμ„±

### 2. λ©”λ‰΄ μ„¤κ³„μ‹¤ μ—…κ·Έλ μ΄λ“
- **νμΌ**: `ui_pages/menu_management.py` (μμ •)
- **λ³€κ²½**: ν¬νΈν΄λ¦¬μ¤ κ΄€μ μΌλ΅ μ „λ©΄ μ—…κ·Έλ μ΄λ“
- **μ λ©**: "λ©”λ‰΄ ν¬νΈν΄λ¦¬μ¤ μ„¤κ³„μ‹¤"λ΅ λ³€κ²½

### 3. μ‚¬μ΄λ“λ°” λΌλ²¨ λ³€κ²½
- **νμΌ**: `app.py` (μμ •)
- **λ³€κ²½**: "λ©”λ‰΄ μ„¤κ³„μ‹¤" β†’ "λ©”λ‰΄ ν¬νΈν΄λ¦¬μ¤ μ„¤κ³„μ‹¤"

---

## π“ νμ΄μ§€ κµ¬μ΅° (4μΈµ)

### ZONE A: μ½”μΉ μ”μ•½ (Portfolio Verdict)
- **μΉ΄λ“ 4κ°**:
  1. μ΄ λ©”λ‰΄ μ
  2. ν‰κ·  κ°€κ²©
  3. ν¬νΈν΄λ¦¬μ¤ κ· ν• μ μ (0~100μ , μƒνƒ: κ· ν•/μ£Όμ/μ„ν—)
  4. μ—­ν•  λ¶„ν¬ μ”μ•½ (λ―ΈλΌ X / λ³Όλ¥¨ Y / λ§μ§„ Z)
- **νκ²°λ¬Έ**: ν¬νΈν΄λ¦¬μ¤ κ· ν• μ§„λ‹¨ κ²°κ³Ό
- **μ¶”μ² μ•΅μ…**: λ©”λ‰΄ μμµ κµ¬μ΅° μ„¤κ³„μ‹¤ / λ©”λ‰΄ λ“±λ΅ / νλ§¤λ‰ λ³΄μ •

### ZONE B: κµ¬μ΅° λ§µ (Portfolio Map)
1. **κ°€κ²©λ€ λ¶„ν¬** (1λ§μ› λ‹¨μ„ bins)
2. **μ—­ν•  x μΉ΄ν…κ³ λ¦¬ λ§¤νΈλ¦­μ¤** (ν‘ ν•νƒ)

### ZONE C: μ‚¬μ¥ ν•™κµ (Portfolio Theory)
- "λ€ν‘/μ£Όλ ¥/μ μΈ/λ³΄μ΅°λ” μ—­ν• μ΄ λ‹¤λ¥΄λ‹¤"
- "λ©”λ‰΄λ” κ°λ³„ μµμ ν™”κ°€ μ•„λ‹λΌ μ΅°ν•© μµμ ν™”"
- "λ³Όλ¥¨μ€ νμ „μ„ λ§λ“¤κ³ , λ§μ§„μ€ μƒμ΅΄μ„ λ§λ“ λ‹¤"

### ZONE D: μ„¤κ³„ λ„κµ¬ (Portfolio Tools)
1. **λ©”λ‰΄ ν¬νΈν΄λ¦¬μ¤ λ¶„λ¥ ν…μ΄λΈ”** (ν•µμ‹¬)
   - μ»¬λΌ: λ©”λ‰΄λ…, νλ§¤κ°€, μΉ΄ν…κ³ λ¦¬(λ€ν‘/μ£Όλ ¥/μ μΈ/λ³΄μ΅°), μ—­ν• (λ―ΈλΌ/λ³Όλ¥¨/λ§μ§„)
   - κ° rowμ—μ„ μΉ΄ν…κ³ λ¦¬/μ—­ν• μ„ selectboxλ΅ μ„ νƒ
   - μ €μ¥: session_state (store_id κΈ°μ¤€ keyλ΅ λ¶„λ¦¬)
   - ν•„ν„°: μ „μ²΄ / λ―Έλ¶„λ¥λ§ / μΉ΄ν…κ³ λ¦¬λ³„ / μ—­ν• λ³„

2. **ν¬νΈν΄λ¦¬μ¤ κ¶μ¥ μ΅°ν•© κ°€μ΄λ“** (κ³ μ • λ¬Έκµ¬)
   - λ€ν‘ 1~2, μ£Όλ ¥ 3~6, μ μΈ 1~3, λ³΄μ΅° 4~8
   - λ―ΈλΌ 1~2, λ³Όλ¥¨ 3~5, λ§μ§„ 2~4

3. **κΈ°μ΅΄ λ“±λ΅/μμ •/μ‚­μ  κΈ°λ¥** (ν•λ‹¨ μ μ§€)
   - λ©”λ‰΄ λ“±λ΅ (λ‹¨μΌ/μΌκ΄„)
   - λ©”λ‰΄ μμ •
   - λ©”λ‰΄ μ‚­μ 
   - μΉ΄ν…κ³ λ¦¬ λ³€κ²½ (DB + session_state λ™κΈ°ν™”)

---

## π“ μμ •λ νμΌ λ©λ΅

### 1. `ui_pages/design_lab/menu_portfolio_helpers.py` (μ‹ κ· μƒμ„±)
- ν¬νΈν΄λ¦¬μ¤ κ΄€λ ¨ ν—¬νΌ ν•¨μλ“¤
- μ—­ν•  νƒκ·Έ/μΉ΄ν…κ³ λ¦¬ session_state κ΄€λ¦¬
- ν¬νΈν΄λ¦¬μ¤ κ· ν• μ μ κ³„μ‚°
- ν¬νΈν΄λ¦¬μ¤ νκ²°λ¬Έ μƒμ„±

### 2. `ui_pages/menu_management.py` (μμ •)
- ν¬νΈν΄λ¦¬μ¤ κ΄€μ μΌλ΅ μ „λ©΄ μ—…κ·Έλ μ΄λ“
- ZONE A: ν¬νΈν΄λ¦¬μ¤ μ½”μΉ μ”μ•½
- ZONE B: ν¬νΈν΄λ¦¬μ¤ λ§µ (κ°€κ²©λ€ λ¶„ν¬, μ—­ν•  x μΉ΄ν…κ³ λ¦¬ λ§¤νΈλ¦­μ¤)
- ZONE C: ν¬νΈν΄λ¦¬μ¤ μ΄λ΅  μΉ΄λ“
- ZONE D: ν¬νΈν΄λ¦¬μ¤ λ¶„λ¥ ν…μ΄λΈ” + κΈ°μ΅΄ λ“±λ΅/μμ •/μ‚­μ  κΈ°λ¥

### 3. `app.py` (μμ •)
- μ‚¬μ΄λ“λ°” λΌλ²¨ λ³€κ²½: "λ©”λ‰΄ μ„¤κ³„μ‹¤" β†’ "λ©”λ‰΄ ν¬νΈν΄λ¦¬μ¤ μ„¤κ³„μ‹¤"

---

## β… μ•± μ‹¤ν–‰ μ‹ ν™•μΈ μ²΄ν¬λ¦¬μ¤νΈ

### λΌμ°ν… ν™•μΈ
- [ ] μ‚¬μ΄λ“λ°” "π”¥ κ°€κ² μ„¤κ³„" β†’ "λ©”λ‰΄ ν¬νΈν΄λ¦¬μ¤ μ„¤κ³„μ‹¤" ν΄λ¦­ β†’ μƒ νμ΄μ§€ μ§„μ… OK

### λ©”λ‰΄ ν¬νΈν΄λ¦¬μ¤ μ„¤κ³„μ‹¤ νμ΄μ§€
- [ ] ZONE A (μ½”μΉ μ”μ•½) μ •μƒ ν‘μ‹
  - [ ] μ΄ λ©”λ‰΄ μ μΉ΄λ“
  - [ ] ν‰κ·  κ°€κ²© μΉ΄λ“
  - [ ] ν¬νΈν΄λ¦¬μ¤ κ· ν• μ μ μΉ΄λ“
  - [ ] μ—­ν•  λ¶„ν¬ μ”μ•½ μΉ΄λ“
  - [ ] νκ²°λ¬Έ μ •μƒ ν‘μ‹
  - [ ] μ¶”μ² μ•΅μ… λ²„νΌ μ •μƒ λ™μ‘
- [ ] ZONE B (κµ¬μ΅° λ§µ) μ •μƒ ν‘μ‹
  - [ ] κ°€κ²©λ€ λ¶„ν¬ μ°¨νΈ
  - [ ] μ—­ν•  x μΉ΄ν…κ³ λ¦¬ λ§¤νΈλ¦­μ¤ ν‘
- [ ] ZONE C (μ‚¬μ¥ ν•™κµ) μ •μƒ ν‘μ‹
- [ ] ZONE D (μ„¤κ³„ λ„κµ¬) μ •μƒ ν‘μ‹
  - [ ] λ©”λ‰΄ ν¬νΈν΄λ¦¬μ¤ λ¶„λ¥ ν…μ΄λΈ” μ •μƒ ν‘μ‹
  - [ ] ν•„ν„° λ™μ‘ (μ „μ²΄/λ―Έλ¶„λ¥λ§/μΉ΄ν…κ³ λ¦¬λ³„/μ—­ν• λ³„)
  - [ ] μΉ΄ν…κ³ λ¦¬/μ—­ν•  selectbox λ³€κ²½ μ‹ session_state μ €μ¥
  - [ ] ν¬νΈν΄λ¦¬μ¤ κ¶μ¥ μ΅°ν•© κ°€μ΄λ“ μ •μƒ ν‘μ‹
  - [ ] κΈ°μ΅΄ λ“±λ΅/μμ •/μ‚­μ  κΈ°λ¥ μ •μƒ λ™μ‘

### ν¬νΈν΄λ¦¬μ¤ λ¶„λ¥ κΈ°λ¥
- [ ] μΉ΄ν…κ³ λ¦¬ λ³€κ²½ μ‹ DB + session_state λ™κΈ°ν™”
- [ ] μ—­ν•  νƒκ·Έ λ³€κ²½ μ‹ session_state μ €μ¥
- [ ] ν•„ν„°λ³„λ΅ λ©”λ‰΄ λ©λ΅ μ •μƒ ν•„ν„°λ§

---

## π― κΈ°λ€ λ™μ‘

### μ‚¬μ©μ κ²½ν—
1. **ν¬νΈν΄λ¦¬μ¤ κ΄€μ **: κ°λ³„ λ©”λ‰΄κ°€ μ•„λ‹ μ΅°ν•© μµμ ν™” μ¤‘μ‹¬
2. **κ· ν• μ§„λ‹¨**: ν¬νΈν΄λ¦¬μ¤ κ· ν• μ μλ΅ ν•λμ— νμ•…
3. **λ¶„λ¥ λ„κµ¬**: μΉ΄ν…κ³ λ¦¬μ™€ μ—­ν• μ„ μ‰½κ² λ¶„λ¥
4. **CTA μ—°κ²°**: λ¬Έμ  λ°κ²¬ μ‹ λ°”λ΅ ν•΄λ‹Ή μ„¤κ³„μ‹¤λ΅ μ΄λ™

### μ½”λ“ μ•μ •μ„±
- κΈ°μ΅΄ λ“±λ΅/μμ •/μ‚­μ  κΈ°λ¥ κ·Έλ€λ΅ μ μ§€
- session_state κΈ°λ° μ €μ¥ (DB μ¤ν‚¤λ§ λ³€κ²½ μ—†μ)
- store_id κΈ°μ¤€ key λ¶„λ¦¬λ΅ μ¶©λ λ°©μ§€

---

## π“ μ°Έκ³ μ‚¬ν•­

### ν¬νΈν΄λ¦¬μ¤ κ· ν• μ μ κ³„μ‚°
- **μ μ λ²”μ„**: 0~100μ 
- **μƒνƒ**: κ· ν• (70μ  μ΄μƒ) / μ£Όμ (40~69μ ) / μ„ν— (40μ  λ―Έλ§)
- **μ²΄ν¬ ν•­λ©**:
  - μ—­ν•  λ―Έλ¶„λ¥ κ³Όλ‹¤ (50% λ―Έλ§ λ¶„λ¥ μ‹ -30μ )
  - μ—­ν•  νΈμ¤‘ (λ―ΈλΌ 50% μ΄κ³Ό -20μ , λ³Όλ¥¨ 60% μ΄κ³Ό -15μ )
  - λ§μ§„ λ©”λ‰΄ λ¶€μ΅± (-20μ )
  - μΉ΄ν…κ³ λ¦¬ λ¶€μ΅±/νΈμ¤‘ (-10~15μ )

### μ—­ν•  νƒκ·Έ μ €μ¥
- **μ €μ¥ μ„μΉ**: session_state (`menu_portfolio_tags::{store_id}`)
- **DB μ €μ¥**: λ‹¤μ λ‹¨κ³„μ—μ„ μ¶”κ°€ μμ •
- **ν„μ¬**: νμ΄μ§€ μƒλ΅κ³ μΉ¨ μ‹ μ μ§€

### μΉ΄ν…κ³ λ¦¬ μ €μ¥
- **μ €μ¥ μ„μΉ**: DB (κΈ°μ΅΄ `update_menu_category` ν•¨μ μ‚¬μ©) + session_state
- **λ™κΈ°ν™”**: DB μ—…λ°μ΄νΈ μ‹ session_stateλ„ μλ™ μ—…λ°μ΄νΈ

### ν¬νΈν΄λ¦¬μ¤ νκ²° λ΅μ§
- **μ°μ„ μμ„**:
  1. μ μΈλ©”λ‰΄ λ¶€μ΅± (5κ° μ΄μƒ λ©”λ‰΄μΈλ° μ μΈλ©”λ‰΄ μ—†μ)
  2. λ§μ§„ λ©”λ‰΄ λ¶€μ΅± (3κ° μ΄μƒ λ©”λ‰΄μΈλ° λ§μ§„ λ©”λ‰΄ μ—†μ)
  3. λ―ΈλΌ λ©”λ‰΄ κ³Όλ‹¤ (50% μ΄κ³Ό)
  4. μ—­ν•  λ―Έλ¶„λ¥ κ³Όλ‹¤ (30% μ΄κ³Ό)
  5. ν‰κ·  κ°€κ²© λ‚®μ (1λ§μ› λ―Έλ§, 5κ° μ΄μƒ λ©”λ‰΄)

---

## π€ λ°°ν¬ μ¤€λΉ„

λ¨λ“  μμ •μ΄ μ™„λ£λμ—μµλ‹λ‹¤. λ‹¤μ λ‹¨κ³„:
1. β… μ•± μ¬μ‹μ‘
2. β… "λ©”λ‰΄ ν¬νΈν΄λ¦¬μ¤ μ„¤κ³„μ‹¤" λ©”λ‰΄ ν΄λ¦­ β†’ μƒ νμ΄μ§€ μ§„μ… ν™•μΈ
3. β… ν¬νΈν΄λ¦¬μ¤ λ¶„λ¥ ν…μ΄λΈ”μ—μ„ μΉ΄ν…κ³ λ¦¬/μ—­ν•  λ³€κ²½ λ™μ‘ ν™•μΈ
4. β… ν¬νΈν΄λ¦¬μ¤ κ· ν• μ μ μ •μƒ κ³„μ‚° ν™•μΈ
5. β… CTA λ²„νΌ ν΄λ¦­ μ‹ νμ΄μ§€ μ΄λ™ ν™•μΈ

---

## π“ μ‘μ—… μ”μ•½

| ν•­λ© | μƒνƒ | λΉ„κ³  |
|------|------|------|
| ν¬νΈν΄λ¦¬μ¤ ν—¬νΌ ν•¨μ μƒμ„± | β… μ™„λ£ | menu_portfolio_helpers.py |
| ZONE A ν¬νΈν΄λ¦¬μ¤ μ½”μΉ μ”μ•½ | β… μ™„λ£ | 4κ° μΉ΄λ“ + νκ²°λ¬Έ |
| ZONE B ν¬νΈν΄λ¦¬μ¤ λ§µ | β… μ™„λ£ | κ°€κ²©λ€ λ¶„ν¬ + λ§¤νΈλ¦­μ¤ |
| ZONE C ν¬νΈν΄λ¦¬μ¤ μ΄λ΅  | β… μ™„λ£ | 3κ° μΉ΄λ“ |
| ZONE D ν¬νΈν΄λ¦¬μ¤ λ¶„λ¥ ν…μ΄λΈ” | β… μ™„λ£ | ν•„ν„° 4κ°€μ§€ |
| κΈ°μ΅΄ λ“±λ΅/μμ •/μ‚­μ  κΈ°λ¥ μ μ§€ | β… μ™„λ£ | ν•λ‹¨ μ μ§€ |
| μ‚¬μ΄λ“λ°” λΌλ²¨ λ³€κ²½ | β… μ™„λ£ | app.py |

---

## β… μµμΆ… ν™•μΈ

- [x] ν¬νΈν΄λ¦¬μ¤ ν—¬νΌ ν•¨μ μƒμ„± μ™„λ£
- [x] ZONE A/B/C ν¬νΈν΄λ¦¬μ¤ κ΄€μ μΌλ΅ μ—…κ·Έλ μ΄λ“ μ™„λ£
- [x] ZONE D ν¬νΈν΄λ¦¬μ¤ λ¶„λ¥ ν…μ΄λΈ” μ¶”κ°€ μ™„λ£
- [x] κΈ°μ΅΄ λ“±λ΅/μμ •/μ‚­μ  κΈ°λ¥ μ μ§€ μ™„λ£
- [x] μ‚¬μ΄λ“λ°” λΌλ²¨ λ³€κ²½ μ™„λ£
- [ ] μ•± μ‹¤ν–‰ λ° λ™μ‘ ν™•μΈ (μ‚¬μ©μ ν™•μΈ ν•„μ”)

**μ°Έκ³ **: 
- ν¬νΈν΄λ¦¬μ¤ λ¶„λ¥λ” session_stateλ΅ μ €μ¥λ©λ‹λ‹¤ (DB μ €μ¥μ€ λ‹¤μ λ‹¨κ³„).
- ν¬νΈν΄λ¦¬μ¤ κ· ν• μ μλ” κ°„λ‹¨ν• λ£° κΈ°λ°μΌλ΅ κ³„μ‚°λ©λ‹λ‹¤.
- μΉ΄ν…κ³ λ¦¬λ” DBμ™€ session_state λ¨λ‘μ— μ €μ¥λ©λ‹λ‹¤.
