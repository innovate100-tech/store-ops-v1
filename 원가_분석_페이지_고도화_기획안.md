# 원가 분석 페이지 고도화 기획안

**작성 일자**: 2026-01-24  
**목적**: 메뉴별 원가 분석 강화 및 원가 최적화를 위한 실용적 인사이트 제공

---

## 📋 개요

현재 원가 분석 페이지는 **메뉴별 원가/원가율 계산 및 표시**, **원가율 35% 이상 경고**, **평균/최고/최저 원가율 통계** 수준입니다.

이 기획안은  
1) **메뉴별 원가 상세 분석**(재료별 구성, 원가 변화 추이)을 제공하고,  
2) **판매 데이터와 연계**하여 실제 원가 기여도·수익성을 분석하며,  
3) **원가 최적화 시뮬레이션** 및 **ABC 분석**을 통해 **실행 가능한 인사이트**를 제공하도록  
**원가 분석** 페이지를 고도화하는 내용을 담습니다.

---

## 1. 현재 이슈 정리

### 1.1 기능적 한계

- **메뉴별 원가 상세**: 재료별 구성, 원가 변화 추이 없음.
- **판매 데이터 연계**: 판매량 × 원가 = 총 원가 기여도, 원가율별 매출 기여도 분석 없음.
- **원가 최적화**: 재료 단가/사용량 변경 시나리오 시뮬레이션 없음.
- **ABC 분석**: 원가율 기준, 공헌이익 기준 ABC 분석 없음.
- **원가 트렌드**: 재료 단가 상승 감지, 원가율 변화 추이 없음.
- **목표 vs 실제**: 목표 원가율 vs 실제 원가율 비교 없음.
- **액션 제안**: 원가 최적화를 위한 구체적 액션 아이템 없음.

---

## 2. 핵심 개선 사항

### 2.1 메뉴별 원가 상세 분석 (신규)

**목적**: 각 메뉴의 원가 구성과 변화를 상세히 파악.

#### A. 메뉴별 재료 구성 분석

- **재료별 원가 기여도**: 메뉴별로 사용되는 재료의 원가 금액·비율
- **TOP 재료**: 원가 기여도가 높은 재료 TOP 3
- **재료 단가 변화 영향**: 각 재료 단가 ±10% 변화 시 원가 변화

**UI 형태**:
- 메뉴 선택 드롭다운 또는 테이블 클릭
- 선택된 메뉴의 재료별 원가 구성 (바 차트, 테이블)
- 재료 단가 시뮬레이션 (슬라이더 또는 입력)

#### B. 원가 변화 추이 (월별)

- **월별 원가율 추이**: 최근 6개월 메뉴별 원가율 변화
- **재료 단가 상승 감지**: 특정 재료 단가 상승으로 인한 원가율 증가 자동 감지
- **원가율 급등 메뉴**: 전월 대비 원가율 +5%p 이상 증가한 메뉴

**인사이트**:
- "김치찌개 원가율이 전월 대비 +3%p 증가했습니다. 배추 단가 상승이 원인입니다."
- "최근 3개월간 평균 원가율이 +2%p 상승했습니다. 재료 단가를 재점검하세요."

### 2.2 판매 데이터와 연계 분석 (신규)

**목적**: 실제 판매량을 반영한 원가 기여도 및 수익성 분석.

#### A. 원가 기여도 분석

- **총 원가**: 판매량 × 원가 = 메뉴별 총 원가 기여도
- **원가 기여도 순위**: 총 원가 기여도가 높은 메뉴 TOP 10
- **원가율별 매출 기여도**: 원가율 구간별(30% 미만, 30-35%, 35% 이상) 매출 합계

**UI 형태**:
- 기간 선택 (최근 1개월, 3개월, 6개월)
- 원가 기여도 TOP 10 테이블 + 바 차트
- 원가율 구간별 매출 파이 차트

#### B. 공헌이익 분석

- **공헌이익**: (판매가 - 원가) × 판매량 = 메뉴별 공헌이익
- **공헌이익률**: 공헌이익 / 매출 × 100
- **공헌이익 순위**: 공헌이익이 높은 메뉴 TOP 10
- **원가율 vs 공헌이익 상관**: 원가율이 낮아도 공헌이익이 높은 메뉴 식별

**인사이트**:
- "김치찌개는 원가율이 40%로 높지만, 판매량이 많아 공헌이익 1위입니다."
- "원가율 30% 미만 메뉴가 전체 매출의 60%를 차지합니다."

### 2.3 ABC 분석 (원가율·공헌이익 기준) (신규)

**목적**: 원가율과 공헌이익 기준으로 메뉴를 분류하여 우선순위 파악.

#### A. 원가율 기준 ABC 분석

- **A등급**: 원가율 35% 이상 (위험 메뉴)
- **B등급**: 원가율 30-35% (주의 메뉴)
- **C등급**: 원가율 30% 미만 (양호 메뉴)

**인사이트**:
- "A등급 메뉴 5개가 전체 원가의 40%를 차지합니다. 원가 최적화 우선순위입니다."

#### B. 공헌이익 기준 ABC 분석

- **A등급**: 공헌이익 상위 70%
- **B등급**: 공헌이익 중위 20%
- **C등급**: 공헌이익 하위 10%

**인사이트**:
- "A등급 메뉴 3개가 전체 공헌이익의 70%를 차지합니다. 이 메뉴들의 원가 관리가 중요합니다."

#### C. 원가율 vs 공헌이익 매트릭스

- **4분면 분석**:
  - **좌상 (원가율 높음, 공헌이익 높음)**: 판매량이 많아 공헌이익이 높지만 원가율도 높음 → 원가 최적화 필요
  - **좌하 (원가율 높음, 공헌이익 낮음)**: 원가 최적화 최우선
  - **우상 (원가율 낮음, 공헌이익 높음)**: 이상적 메뉴
  - **우하 (원가율 낮음, 공헌이익 낮음)**: 판매량 부족 또는 판매가 낮음

**UI 형태**:
- 산점도 (원가율 X축, 공헌이익 Y축)
- 4분면 색상 구분
- 메뉴명 표시

### 2.4 원가 최적화 시뮬레이션 (신규)

**목적**: 재료 단가/사용량 변경 시나리오별 원가·원가율 변화 예측.

#### A. 재료 단가 변경 시뮬레이션

- **재료 선택**: 메뉴별 사용 재료 목록
- **단가 변경**: ±10%, ±20% 또는 직접 입력
- **원가 변화**: 변경 후 원가·원가율 계산
- **영향 범위**: 해당 재료를 사용하는 모든 메뉴의 원가 변화

**예시**:
- "배추 단가를 10% 낮추면 → 김치찌개 원가율 38% → 35% (3%p 감소)"
- "배추 단가를 10% 낮추면 → 총 5개 메뉴 원가율 평균 2%p 감소"

#### B. 재료 사용량 변경 시뮬레이션

- **레시피 수정 시뮬레이션**: 특정 재료 사용량 ±10%, ±20% 또는 직접 입력
- **원가 변화**: 변경 후 원가·원가율 계산
- **품질 영향 고려**: 사용량 감소 시 품질 저하 가능성 안내

**예시**:
- "김치찌개 배추 사용량을 10% 감소 → 원가율 38% → 35% (3%p 감소)"
- "⚠️ 사용량 감소 시 품질 저하 가능성이 있습니다."

#### C. 목표 원가율 달성 시뮬레이션

- **목표 원가율 입력**: 예) 30%
- **필요 조정량 계산**: 현재 원가율에서 목표 원가율까지 필요한 재료 단가/사용량 조정
- **우선순위 제안**: 조정 효과가 큰 재료 우선 제안

**예시**:
- "김치찌개 원가율을 38% → 30%로 낮추려면 → 배추 단가 20% 감소 또는 배추 사용량 20% 감소 필요"

### 2.5 원가 트렌드 분석 (신규)

**목적**: 재료 단가 상승 및 원가율 변화 추이를 파악하여 대응 전략 수립.

#### A. 재료 단가 상승 감지

- **재료별 단가 변화**: 최근 3개월, 6개월 재료 단가 변화율
- **단가 상승 TOP 10**: 단가 상승률이 높은 재료
- **영향 메뉴**: 단가 상승 재료를 사용하는 메뉴 목록

**인사이트**:
- "배추 단가가 최근 3개월간 +15% 상승했습니다. 김치찌개 등 5개 메뉴 원가율에 영향."
- "총 10개 재료 단가가 상승하여 평균 원가율이 +2%p 증가했습니다."

#### B. 원가율 변화 추이

- **월별 평균 원가율**: 최근 6개월 전체 메뉴 평균 원가율 추이
- **메뉴별 원가율 변화**: 원가율이 증가/감소한 메뉴 목록
- **원가율 급등 메뉴**: 전월 대비 +5%p 이상 증가한 메뉴

**차트**:
- 라인 차트: 월별 평균 원가율 추이
- 바 차트: 원가율 변화 TOP 10 메뉴 (증가/감소)

### 2.6 목표 원가율 vs 실제 원가율 비교 (신규)

**목적**: 목표 원가율 대비 실제 원가율을 비교하여 개선 필요 메뉴 식별.

#### A. 목표 원가율 설정

- **메뉴별 목표 원가율 입력**: 기본값 30% 또는 메뉴별 개별 설정
- **카테고리별 목표 원가율**: 카테고리별 기본 목표 원가율 설정

#### B. 목표 vs 실제 비교

- **메뉴별 비교**: 목표 원가율 vs 실제 원가율, 차이(%p)
- **목표 미달 메뉴**: 실제 원가율이 목표보다 높은 메뉴 목록
- **목표 달성률**: 목표 원가율 달성 메뉴 수 / 전체 메뉴 수

**인사이트**:
- "전체 메뉴 중 60%가 목표 원가율을 달성했습니다."
- "김치찌개 원가율이 목표 30% 대비 +8%p 초과했습니다."

### 2.7 원가 최적화 액션 제안 (신규)

**목적**: 원가 최적화를 위한 구체적이고 실행 가능한 액션 아이템 제안.

#### A. 자동 진단

- **고원가율 메뉴**: 원가율 35% 이상 메뉴 자동 식별
- **원가 기여도 높은 메뉴**: 총 원가 기여도가 높은 메뉴 중 원가율이 높은 메뉴
- **단가 상승 영향 큰 메뉴**: 재료 단가 상승으로 원가율이 크게 증가한 메뉴

#### B. 우선순위별 액션 제안

1. **재료 단가 재협상**: 단가 상승 재료의 공급업체 재협상 또는 대체 재료 검토
2. **레시피 최적화**: 고원가율 메뉴의 재료 사용량 조정 (품질 고려)
3. **판매가 조정**: 원가율이 높고 조정이 어려운 메뉴의 판매가 인상 검토
4. **메뉴 교체**: 원가율이 지속적으로 높은 메뉴의 대체 메뉴 검토

**인사이트**:
- "김치찌개 원가율 38% → 배추 단가 재협상 또는 배추 사용량 10% 감소 → 목표 30% 달성 가능"
- "고원가율 메뉴 5개가 전체 원가의 40%를 차지합니다. 이 메뉴들의 원가 최적화가 우선순위입니다."

---

## 3. 새로운 페이지 구조 (ZONE 구분)

### 3.1 ZONE A: 핵심 지표

- **평균 원가율**, **최고 원가율**, **최저 원가율**
- **고원가율 메뉴 수** (35% 이상)
- **목표 원가율 달성률** (목표 설정 시)
- **총 원가 기여도** (판매량 × 원가 합계, 판매 데이터 연계 시)

### 3.2 ZONE B: 메뉴별 원가 분석 (기존 강화)

- **메뉴별 원가/원가율 테이블** (기존 유지)
- **원가율 경고** (35% 이상, 기존 유지)
- **메뉴 선택 시 재료별 원가 구성** (신규)
- **재료 단가 시뮬레이션** (신규)

### 3.3 ZONE C: 판매 데이터 연계 분석 (신규)

- **원가 기여도 TOP 10** (판매량 × 원가)
- **공헌이익 TOP 10** ((판매가 - 원가) × 판매량)
- **원가율 구간별 매출 분포** (30% 미만, 30-35%, 35% 이상)
- **기간 선택**: 최근 1개월, 3개월, 6개월

### 3.4 ZONE D: ABC 분석 (신규)

- **원가율 기준 ABC**: A(35% 이상), B(30-35%), C(30% 미만)
- **공헌이익 기준 ABC**: A(상위 70%), B(중위 20%), C(하위 10%)
- **원가율 vs 공헌이익 매트릭스**: 4분면 산점도

### 3.5 ZONE E: 원가 최적화 시뮬레이션 (신규)

- **재료 단가 변경 시뮬레이션**: 재료 선택, 단가 변경, 원가 변화 예측
- **재료 사용량 변경 시뮬레이션**: 레시피 수정 시뮬레이션
- **목표 원가율 달성 시뮬레이션**: 목표 원가율 입력, 필요 조정량 계산

### 3.6 ZONE F: 원가 트렌드 (신규)

- **재료 단가 상승 감지**: 최근 3개월, 6개월 재료 단가 변화
- **원가율 변화 추이**: 월별 평균 원가율, 메뉴별 원가율 변화
- **원가율 급등 메뉴**: 전월 대비 +5%p 이상 증가한 메뉴

### 3.7 ZONE G: 목표 vs 실제 (신규)

- **목표 원가율 설정**: 메뉴별 또는 카테고리별 목표 원가율 입력
- **목표 vs 실제 비교**: 메뉴별 목표 원가율 vs 실제 원가율, 차이(%p)
- **목표 미달 메뉴**: 목표 원가율을 초과한 메뉴 목록

### 3.8 ZONE H: 원가 최적화 액션 (신규)

- **자동 진단**: 고원가율 메뉴, 원가 기여도 높은 메뉴, 단가 상승 영향 큰 메뉴
- **우선순위별 액션 제안**: 재료 단가 재협상, 레시피 최적화, 판매가 조정, 메뉴 교체

### 3.9 ZONE I: 원가 구조 입력 현황 (기존 유지)

- **메뉴 수**, **레시피 수**, **재료 수**
- **데이터 입력 안내**: 메뉴/레시피/재료 미입력 시 안내

---

## 4. 데이터 함수 정리 및 증명

### 4.1 메뉴별 원가 계산 (기존 유지)

```text
calculate_menu_cost(menu_df, recipe_df, ingredient_df) → DataFrame
```

- **입력**: 메뉴 마스터, 레시피, 재료 마스터
- **로직**: 레시피 사용량 × 재료 단가 = 재료비, 메뉴별 재료비 합 = 원가, 원가 / 판매가 × 100 = 원가율
- **출력**: 메뉴명, 판매가, 원가, 원가율

### 4.2 재료별 원가 구성 계산 (신규)

```text
_get_menu_ingredient_cost(menu_name, recipe_df, ingredient_df) → DataFrame
```

- **입력**: 메뉴명, 레시피, 재료 마스터
- **로직**: 해당 메뉴의 재료별 사용량 × 단가 = 재료별 원가, 비율 계산
- **출력**: 재료명, 사용량, 단가, 원가, 원가 비중(%)

### 4.3 원가 기여도 계산 (신규)

```text
_calculate_cost_contribution(cost_df, daily_sales_df, period_days=30) → DataFrame
```

- **입력**: 원가 분석 DataFrame, 일일 판매 DataFrame, 기간(일)
- **로직**: 기간 내 판매량 × 원가 = 총 원가 기여도, 순위 계산
- **출력**: 메뉴명, 판매량, 원가, 총 원가 기여도, 순위

### 4.4 공헌이익 계산 (신규)

```text
_calculate_contribution_margin(cost_df, daily_sales_df, period_days=30) → DataFrame
```

- **입력**: 원가 분석 DataFrame, 일일 판매 DataFrame, 기간(일)
- **로직**: (판매가 - 원가) × 판매량 = 공헌이익, 공헌이익 / 매출 × 100 = 공헌이익률
- **출력**: 메뉴명, 판매량, 매출, 원가, 공헌이익, 공헌이익률

### 4.5 ABC 분석 (신규)

```text
_abc_analysis_by_cost_rate(cost_df) → DataFrame
_abc_analysis_by_contribution(cost_df, daily_sales_df, period_days=30) → DataFrame
```

- **입력**: 원가 분석 DataFrame, (선택) 일일 판매 DataFrame
- **로직**: 원가율 기준 또는 공헌이익 기준으로 A/B/C 등급 분류
- **출력**: 메뉴명, 원가율/공헌이익, 등급

### 4.6 원가 시뮬레이션 (신규)

```text
_simulate_cost_change(menu_name, ingredient_name, price_change_pct, recipe_df, ingredient_df) → dict
_simulate_usage_change(menu_name, ingredient_name, usage_change_pct, recipe_df, ingredient_df) → dict
```

- **입력**: 메뉴명, 재료명, 변경율(%), 레시피, 재료 마스터
- **로직**: 변경 후 재료 단가/사용량으로 원가 재계산, 원가율 계산
- **출력**: 변경 전 원가/원가율, 변경 후 원가/원가율, 변화량

### 4.7 재료 단가 상승 감지 (신규)

```text
_detect_ingredient_price_increase(ingredient_df, months=3) → DataFrame
```

- **입력**: 재료 마스터 DataFrame (단가 이력 또는 현재 단가), 기간(월)
- **로직**: 기간 내 재료 단가 변화율 계산, 상승률 높은 순 정렬
- **출력**: 재료명, 현재 단가, 변화율(%), 영향 메뉴 수

**증명**:
- 재료 단가 이력이 없으면 현재 단가만 사용 (트렌드 분석 불가)
- 재료 단가 이력이 있으면 월별 단가 평균으로 변화율 계산

---

## 5. UI/UX 요약

- **메뉴 선택**: 드롭다운 또는 테이블 클릭으로 메뉴별 상세 분석
- **기간 선택**: 판매 데이터 연계 분석 시 최근 1/3/6개월 선택
- **시뮬레이션**: 재료 단가/사용량 변경 슬라이더 또는 입력 필드, 실시간 계산
- **차트**: 바 차트(원가 기여도, 공헌이익), 파이 차트(원가율 구간별 매출), 라인 차트(원가율 추이), 산점도(원가율 vs 공헌이익)
- **데이터 미입력 시**: 해당 ZONE 안내 문구 + 메뉴/레시피/재료 입력 페이지로 이동 버튼

---

## 6. 구현 순서 제안

| 단계 | 작업 | 비고 |
|------|------|------|
| 1 | **재료별 원가 구성** | `_get_menu_ingredient_cost` 구현, ZONE B 강화 |
| 2 | **판매 데이터 연계** | `_calculate_cost_contribution`, `_calculate_contribution_margin` 구현, ZONE C |
| 3 | **ABC 분석** | `_abc_analysis_by_cost_rate`, `_abc_analysis_by_contribution` 구현, ZONE D |
| 4 | **원가 시뮬레이션** | `_simulate_cost_change`, `_simulate_usage_change` 구현, ZONE E |
| 5 | **원가 트렌드** | `_detect_ingredient_price_increase`, 월별 원가율 추이, ZONE F |
| 6 | **목표 vs 실제** | 목표 원가율 설정 및 비교, ZONE G |
| 7 | **액션 제안** | 자동 진단 및 우선순위별 액션, ZONE H |
| 8 | **ZONE A 강화** | 핵심 지표 추가 (고원가율 메뉴 수, 총 원가 기여도 등) |

---

## 7. 기대 효과

- **원가 상세 파악**: 재료별 원가 구성으로 원가 최적화 포인트 명확화.  
- **실제 수익성 분석**: 판매량 반영 원가 기여도·공헌이익으로 실제 수익성 파악.  
- **우선순위 명확화**: ABC 분석 및 매트릭스로 원가 최적화 우선순위 식별.  
- **시뮬레이션 기반 의사결정**: 재료 단가/사용량 변경 시나리오로 원가 최적화 효과 예측.  
- **트렌드 기반 대응**: 재료 단가 상승 감지 및 원가율 변화 추이로 선제적 대응.  
- **목표 달성 관리**: 목표 원가율 vs 실제 비교로 지속적 개선.

---

## 8. 정리

### 핵심 원칙

1. **원가 SSOT**: 메뉴별 원가는 **레시피 사용량 × 재료 단가**로만 계산.  
2. **판매 데이터 연계**: 실제 판매량을 반영한 원가 기여도·공헌이익 분석.  
3. **시뮬레이션 기반 의사결정**: 재료 단가/사용량 변경 시나리오로 원가 최적화 효과 예측.  
4. **우선순위 명확화**: ABC 분석 및 매트릭스로 원가 최적화 우선순위 식별.

### 다음 단계

1. 기획안 검토 및 확정  
2. `_get_menu_ingredient_cost`, `_calculate_cost_contribution` 등 **데이터 함수** 구현 및 단위 검증  
3. ZONE A → B → C → D → E → F → G → H 순으로 UI 적용  
4. 판매 데이터 미입력 등 **엣지 케이스** 확인  
5. 원가 시뮬레이션 **정확도** 검증  

---

**작성일**: 2026-01-24  
**참고**:  
- `ui_pages/cost_overview.py` (현재)  
- `src/ui.py` (`render_cost_analysis`)  
- `src/analytics.py` (`calculate_menu_cost`, `abc_analysis`)  
- `매출_분석_페이지_고도화_기획안.md` (ZONE 구조)  
- `비용_분석_페이지_고도화_기획안.md` (시뮬레이션, ABC 분석)
