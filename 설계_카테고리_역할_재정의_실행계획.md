# 설계 카테고리 역할 재정의 실행계획

**작성 일자**: 2026-01-24  
**목적**: 3층 구조(기준 구조 → 조작 레버 → 결과판) 기반 설계 카테고리 재정의를 단계별로 실행

---

## 전체 일정 개요

| Phase | 기간 | 주요 작업 |
|-------|------|-----------|
| **Phase 1: 기준 구조 만들기** | 1주 | 기준 구조 데이터 모델, 자동 수집, 저장/로드 |
| **Phase 2: 조작 레버 만들기** | 1.5주 | 각 설계실에 레버 UI 추가 |
| **Phase 3: 결과판 만들기** | 1.5주 | 실시간 계산, Impact Board, 판정 로직 |
| **Phase 4: 설계안 관리** | 1주 | 설계안 저장/비교/적용 |
| **Phase 5: 통합 및 테스트** | 1주 | 통합, 최적화, 테스트 |
| **총 예상 기간** | **6주** | |

---

## Phase 1: 기준 구조 만들기 (1층)

### 1.1 기준 구조 데이터 모델 설계

**목표**: 기준 구조를 저장할 데이터 구조 정의

**작업 내용**:
- 기준 구조 데이터 클래스/딕셔너리 구조 정의
  ```python
  baseline_structure = {
      "sales": {
          "daily_visitors": float,
          "avg_price_per_customer": float,
          "turnover_rate": float,
          "operating_days": int,
          "monthly_sales": float,  # 계산값
      },
      "menu": {
          "avg_cost_rate": float,
          "menu_sales_share": dict,  # {menu_name: share%}
      },
      "cost": {
          "fixed_costs": float,
          "variable_cost_ratio": float,
          "labor_cost_ratio": float,
      },
      "profit": {
          "break_even_sales": float,
          "expected_profit": float,
      },
      "structure": {
          "seats": int,
          "operating_hours": dict,  # {open: time, close: time}
      },
      "loaded_at": datetime,  # 기준 구조 불러온 시점
      "year": int,
      "month": int,
  }
  ```
- 세션 상태 키 정의: `_baseline_structure_{store_id}_{year}_{month}`

**예상 시간**: 0.5일

---

### 1.2 기준 구조 자동 수집 함수 구현

**목표**: 분석 데이터에서 기준 구조 자동 추출

**작업 내용**:
- `src/design/baseline_loader.py` 생성
- 함수 구현:
  - `load_baseline_structure(store_id, year, month) -> dict`
    - 매출 분석에서: 일평균 매출, 일평균 방문자, 객단가, 요일별 패턴
    - 비용 분석에서: 고정비, 변동비율, 인건비율
    - 원가 분석에서: 평균 원가율, 메뉴별 판매 비중
    - 손익분기 계산: `calculate_break_even_sales`
    - 좌석 수, 운영시간: (신규 입력 필요, 기본값 사용)

**예상 시간**: 2일

---

### 1.3 기준 구조 저장/로드

**목표**: 기준 구조를 세션 상태 또는 DB에 저장

**작업 내용**:
- 세션 상태 저장: `st.session_state["_baseline_structure"] = baseline_structure`
- (선택) DB 저장: `design_baselines` 테이블 생성 및 저장
- 로드 함수: `get_baseline_structure(store_id, year, month) -> dict`

**예상 시간**: 1일

---

### 1.4 설계 허브에 "기준 구조 불러오기" 추가

**목표**: 설계 허브에서 기준 구조를 한 번에 불러오기

**작업 내용**:
- 설계 허브 ZONE A에 "기준 구조 불러오기" 버튼 추가
- 클릭 시 `load_baseline_structure` 호출
- 기준 구조 요약 카드 표시:
  - 현재 월매출, 객단가, 회전율
  - 인건비율, 원가율, 고정비
  - 손익분기점
- "이 구조를 기준으로 설계 시작" 버튼 → 가게 설계 센터로 이동

**예상 시간**: 1일

---

### 1.5 가게 설계 센터에 기준 구조 요약 표시

**목표**: 가게 설계 센터에서 기준 구조를 한눈에 확인

**작업 내용**:
- 가게 설계 센터 ZONE A 상단에 기준 구조 요약 카드 4개 추가
- 기준 구조가 없으면 "기준 구조 불러오기" 버튼 표시
- 기준 구조가 있으면 기준 구조 카드 + "기준 구조 다시 불러오기" 버튼

**예상 시간**: 0.5일

**Phase 1 총 예상 시간**: 5일 (1주)

---

## Phase 2: 조작 레버 만들기 (2층)

### 2.1 수익 구조 설계실 - 매출 레버

**목표**: 일 방문객, 객단가, 회전율, 영업일수 조작 UI

**작업 내용**:
- 수익 구조 설계실 ZONE C에 "매출 레버" 섹션" 추가
- 레버 UI:
  - 일 방문객 수: `st.number_input` + ±10%, ±5% 버튼
  - 객단가: `st.number_input` + ±10%, ±5% 버튼
  - 회전율: `st.number_input` 또는 좌석 수 기반 자동 계산
  - 영업일수: `st.number_input` (기본값 30일)
- 레버 변경 시 `st.session_state["_revenue_levers"]` 업데이트
- 기준 구조에서 초기값 로드

**예상 시간**: 1일

---

### 2.2 수익 구조 설계실 - 비용 레버

**목표**: 인건비 구조, 고정비, 변동비율 조작 UI

**작업 내용**:
- 수익 구조 설계실 ZONE C에 "비용 레버" 섹션 추가
- 레버 UI:
  - 인건비 구조: 인원 수, 시급, 시간 입력
  - 고정비: 임차료, 공과금 입력 (목표 비용구조 연동)
  - 변동비율: 재료비율, 부가세&카드수수료 비율 입력
- 레버 변경 시 `st.session_state["_cost_levers"]` 업데이트

**예상 시간**: 1일

---

### 2.3 수익 구조 설계실 - 구조 레버

**목표**: 좌석 수, 운영시간 조작 UI

**작업 내용**:
- 수익 구조 설계실 ZONE C에 "구조 레버" 섹션 추가
- 레버 UI:
  - 좌석 수: `st.number_input`
  - 운영시간: 오픈 시간, 마감 시간 선택 (`st.time_input`)
- 레버 변경 시 `st.session_state["_structure_levers"]` 업데이트

**예상 시간**: 0.5일

---

### 2.4 메뉴 수익 구조 설계실 - 메뉴 레버

**목표**: 메뉴별 가격, 원가율, 판매 비중 조작 UI

**작업 내용**:
- 메뉴 수익 구조 설계실 ZONE C에 "메뉴 레버" 섹션 추가
- 레버 UI:
  - 메뉴별 가격: `st.number_input` 또는 ±버튼
  - 메뉴별 원가율: `st.number_input` 또는 원가 입력
  - 메뉴별 판매 비중: `st.slider` (0~100%, 합계 100% 검증)
- 일괄 조작:
  - "전체 가격 ±10%" 버튼
  - "전체 원가율 ±2%p" 버튼
- 레버 변경 시 `st.session_state["_menu_levers"]` 업데이트

**예상 시간**: 1.5일

---

### 2.5 메뉴 포트폴리오 설계실 - 포트폴리오 레버

**목표**: 역할 태그, 카테고리, 메뉴 추가/제거 조작 UI

**작업 내용**:
- 메뉴 포트폴리오 설계실 ZONE C에 "포트폴리오 레버" 섹션 추가
- 레버 UI:
  - 역할 태그 변경: `st.selectbox` (미끼/볼륨/마진)
  - 카테고리 변경: `st.selectbox` (대표/주력/유인/보조/기타)
  - 메뉴 추가/제거: 기존 Design Tools 활용

**예상 시간**: 0.5일

---

### 2.6 재료 구조 설계실 - 재료 레버

**목표**: 재료 단가, 대체재, 발주 구조 조작 UI

**작업 내용**:
- 재료 구조 설계실 ZONE C에 "재료 레버" 섹션 추가
- 레버 UI:
  - 재료 단가 변경: `st.number_input` 또는 ±버튼
  - 대체재 선택: `st.selectbox`
  - 발주 구조: 발주단위, 변환비율 입력

**예상 시간**: 1일

**Phase 2 총 예상 시간**: 5.5일 (약 1.5주)

---

## Phase 3: 결과판 만들기 (3층)

### 3.1 실시간 계산 엔진 구현

**목표**: 레버 변경 시 즉시 결과 계산

**작업 내용**:
- `src/design/impact_calculator.py` 생성
- 함수 구현:
  - `calculate_expected_sales(levers, baseline) -> float`
    - 일 방문객 × 객단가 × 회전율 × 영업일수
  - `calculate_expected_profit(levers, baseline) -> float`
    - 예상 매출 - (고정비 + 변동비)
  - `calculate_break_even_change(levers, baseline) -> dict`
    - 기준 손익분기 vs 설계안 손익분기
  - `calculate_cost_rate_changes(levers, baseline) -> dict`
    - 인건비율, 원가율 변화
  - `calculate_target_achievement(levers, baseline, target_sales) -> float`
    - 예상 매출 / 목표 매출 × 100
  - `judge_survival_structure(levers, baseline) -> dict`
    - 안정/주의/위험 판정 + 이유

**예상 시간**: 3일

---

### 3.2 결과판 UI 구현

**목표**: Impact Board UI 컴포넌트 생성

**작업 내용**:
- `ui_pages/design_lab/impact_board.py` 생성
- 함수 구현:
  - `render_impact_board(levers, baseline, calculations) -> None`
    - 예상 월매출 (큰 숫자 + 기준 대비 ±%)
    - 예상 영업이익 (큰 숫자 + 기준 대비 ±%)
    - 손익분기점 변화 (기준 vs 설계안 비교)
    - 인건비율 변화 (기준 vs 설계안 비교)
    - 원가율 변화 (기준 vs 설계안 비교)
    - 목표 달성 가능성 (게이지)
    - 위험 경고 (경고 배지 + 이유)

**예상 시간**: 2일

---

### 3.3 "살아남는 구조" 판정 로직

**목표**: 설계안의 생존 가능성 자동 판정

**작업 내용**:
- `judge_survival_structure` 함수 상세 구현
- 판정 기준:
  - ✅ 안정: 예상 매출 > 손익분기 × 1.2, 원가율 < 35%, 인건비율 < 30%
  - ⚠️ 주의: 예상 매출 > 손익분기, 원가율 35~40%, 인건비율 30~35%
  - 🔴 위험: 예상 매출 < 손익분기, 원가율 > 40%, 인건비율 > 35%
- 대형 배지 UI: "이 설계안은 살아남는 구조입니다" / "이 설계안은 위험합니다"
- 상세 이유 표시: 위험 요소별 설명

**예상 시간**: 1일

---

### 3.4 기준 vs 설계안 비교 UI

**목표**: 기준 구조와 설계안을 나란히 비교

**작업 내용**:
- 비교 카드 UI 구현
- 기준 구조 vs 설계안 나란히 표시
- 변화량 강조: ±%를 크고 눈에 띄게 표시
- 비교 차트: 기준 vs 설계안 막대 그래프

**예상 시간**: 1일

---

### 3.5 위험 경고 시스템

**목표**: 위험 요소별 경고 메시지 표시

**작업 내용**:
- 위험 요소 감지:
  - 손익분기 미달
  - 원가율 과다
  - 인건비율 과다
  - 목표 달성 불가
- 경고 메시지 생성:
  - 위험 요소별 설명
  - 개선 방안 제시
- 경고 배지 UI: 위험 요소별 배지 표시

**예상 시간**: 1일

**Phase 3 총 예상 시간**: 8일 (약 1.5주)

---

## Phase 4: 설계안 관리

### 4.1 설계안 저장/로드 기능

**목표**: 레버 조작 결과를 설계안으로 저장

**작업 내용**:
- 설계안 데이터 구조 정의:
  ```python
  design_draft = {
      "name": str,  # "설계안 1", "설계안 2", ...
      "levers": dict,  # 모든 레버 값
      "calculations": dict,  # 계산된 결과
      "survival_judgment": dict,  # 판정 결과
      "created_at": datetime,
  }
  ```
- 저장 함수: `save_design_draft(store_id, draft) -> str` (draft_id 반환)
- 로드 함수: `load_design_drafts(store_id) -> list`
- 세션 상태 또는 DB 저장 (선택)

**예상 시간**: 1.5일

---

### 4.2 설계안 비교 UI

**목표**: 여러 설계안을 나란히 비교

**작업 내용**:
- 설계안 목록 UI: 저장된 설계안 목록 표시
- 설계안 비교 UI:
  - 탭으로 전환: "기준 구조", "설계안 1", "설계안 2", ...
  - 나란히 비교: 기준 vs 설계안 1 vs 설계안 2
- 비교 지표: 매출, 이익, 손익분기점, 원가율, 인건비율 등

**예상 시간**: 1.5일

---

### 4.3 설계안 적용 기능

**목표**: 설계안을 목표 비용구조/목표 매출구조에 반영

**작업 내용**:
- "이 설계안으로 적용" 버튼
- 적용 로직:
  - 비용 레버 → 목표 비용구조에 반영
  - 매출 레버 → 목표 매출구조에 반영
  - 메뉴 레버 → 메뉴 마스터에 반영 (선택)
- 적용 확인: "설계안이 목표 구조에 반영되었습니다" 메시지

**예상 시간**: 1일

**Phase 4 총 예상 시간**: 4일 (1주)

---

## Phase 5: 통합 및 테스트

### 5.1 모든 설계실에 통합

**목표**: 각 설계실에 기준 구조 + 레버 + 결과판 통합

**작업 내용**:
- 수익 구조 설계실: 기준 구조 + 매출/비용/구조 레버 + 결과판 통합
- 메뉴 수익 구조 설계실: 기준 구조 + 메뉴 레버 + 결과판 통합
- 메뉴 포트폴리오 설계실: 기준 구조 + 포트폴리오 레버 + 결과판 통합
- 재료 구조 설계실: 기준 구조 + 재료 레버 + 결과판 통합
- 가게 설계 센터: 기준 구조 요약 + 설계안 비교 통합

**예상 시간**: 3일

---

### 5.2 실시간 계산 성능 최적화

**목표**: 레버 조작 시 즉시 결과 표시 (지연 최소화)

**작업 내용**:
- 계산 함수 최적화 (불필요한 재계산 제거)
- 세션 상태 캐싱
- `st.rerun()` 최소화 (필요시만)
- 대량 데이터 처리 최적화 (메뉴 100개+ 시)

**예상 시간**: 1.5일

---

### 5.3 사용자 테스트 및 피드백 반영

**목표**: 실제 사용자 테스트 후 개선

**작업 내용**:
- 사용자 테스트 시나리오 작성
- 테스트 실행 및 피드백 수집
- 피드백 반영 (UI 개선, 기능 추가 등)
- 문서화 (사용 가이드)

**예상 시간**: 2일

**Phase 5 총 예상 시간**: 6.5일 (약 1주)

---

## 전체 일정 요약

| Phase | 기간 | 주요 산출물 |
|-------|------|------------|
| **Phase 1** | 1주 | 기준 구조 데이터 모델, 자동 수집 함수, 설계 허브/가게 설계 센터 UI |
| **Phase 2** | 1.5주 | 각 설계실 레버 UI (매출/비용/구조/메뉴/포트폴리오/재료) |
| **Phase 3** | 1.5주 | 실시간 계산 엔진, Impact Board, 판정 로직, 비교 UI |
| **Phase 4** | 1주 | 설계안 저장/로드, 비교 UI, 적용 기능 |
| **Phase 5** | 1주 | 통합, 최적화, 테스트 |
| **총 예상 기간** | **6주** | |

---

## 우선순위 제안

### High Priority (필수)

1. **Phase 1**: 기준 구조 만들기 (설계의 출발점)
2. **Phase 2-1, 2-2**: 수익 구조 설계실 매출/비용 레버 (핵심 레버)
3. **Phase 3-1, 3-2**: 실시간 계산 엔진 + 결과판 (핵심 기능)

### Medium Priority (중요)

4. **Phase 2-4**: 메뉴 수익 구조 설계실 메뉴 레버
5. **Phase 3-3**: "살아남는 구조" 판정
6. **Phase 4-1, 4-2**: 설계안 저장/비교

### Low Priority (선택)

7. **Phase 2-3, 2-5, 2-6**: 구조/포트폴리오/재료 레버 (추가 레버)
8. **Phase 4-3**: 설계안 적용 기능
9. **Phase 5**: 통합 및 최적화

---

## 리스크 및 대응 방안

### 리스크 1: 실시간 계산 성능

**문제**: 레버 조작 시마다 재계산하면 지연 발생 가능

**대응**:
- 계산 결과 캐싱
- Debounce 적용 (레버 변경 후 0.5초 후 계산)
- 필수 계산만 수행, 나머지는 지연 로딩

### 리스크 2: 기준 구조 데이터 부족

**문제**: 분석 데이터가 없으면 기준 구조를 만들 수 없음

**대응**:
- 데이터 부족 시 "기준 구조를 만들 수 없습니다. 먼저 매출·비용·원가 데이터를 입력하세요." 메시지
- 부분 데이터로도 기준 구조 생성 가능하도록 (누락 항목은 기본값 사용)

### 리스크 3: 레버 조작 복잡도

**문제**: 레버가 많으면 사용자가 혼란스러울 수 있음

**대응**:
- 레버를 섹션별로 그룹화 (매출 레버, 비용 레버 등)
- 기본 레버만 표시, 고급 레버는 expander로 숨김
- 레버별 도움말 제공

---

## 성공 지표

### 기능 완성도

- [ ] 기준 구조 자동 수집 정확도 95% 이상
- [ ] 실시간 계산 응답 시간 1초 이내
- [ ] "살아남는 구조" 판정 정확도 90% 이상

### 사용자 경험

- [ ] 사용자가 레버 조작 후 즉시 결과 확인 가능
- [ ] 기준 vs 설계안 비교가 직관적으로 이해 가능
- [ ] 설계안 저장/비교/적용이 원활하게 동작

### 비즈니스 가치

- [ ] 사용자가 여러 설계안을 비교하여 최적안 선택
- [ ] 설계 단계에서 위험 구조 사전 차단
- [ ] 구조 기반 목표 설정으로 달성 가능성 향상

---

**작성일**: 2026-01-24  
**참고**: `설계_카테고리_역할_재정의_기획안.md`
