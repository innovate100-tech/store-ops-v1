# Phase 1 STEP 1 완료 보고서
## 온보딩 제거 + 홈 신규 사용자 모드

**작업 일자**: 2026-01-24  
**목표**: 로그인 후 무조건 홈 화면, 신규 사용자(데이터 0)일 때 홈은 "입력 유도 화면"

---

## 1. 변경 파일 목록

### 1.1 `app.py`
**변경 내용**:
- 온보딩 흐름 제거: `onboarding_mode`가 NULL이면 자동으로 'coach' 설정하고 홈으로 이동
- 온보딩 화면(`onboarding_mode_select.py`) 진입 로직 제거
- 매장 생성 후 온보딩 체크도 자동 처리로 변경

**주요 변경 사항**:
```python
# 이전: needs_onboarding()이면 onboarding_mode_select 화면 표시
# 변경 후: needs_onboarding()이면 자동으로 set_onboarding_mode(user_id, 'coach') 호출 후 홈으로 이동
```

**라인 번호**: 27-91 (온보딩 체크 로직), 100-115 (매장 생성 후 온보딩 체크)

### 1.2 `ui_pages/home/home_page.py`
**변경 내용**:
- 신규 사용자 홈 모드 추가: `_render_new_user_home()` 함수 추가
- `_render_home_body()`에서 `data_level == 0`일 때 신규 사용자 모드로 분기
- 기존 사용자 홈 로직은 그대로 유지

**주요 변경 사항**:
```python
# data_level 체크 후 신규 사용자 분기
if data_level == 0:
    _render_new_user_home(store_id)
    return  # 기존 ZONE 렌더링 건너뜀

# 기존 사용자: 기존 로직 유지
kpis = load_home_kpis(store_id, year, month)
# ... 기존 ZONE 렌더링
```

**라인 번호**: 184-220 (신규 사용자 홈 함수 추가), 222-251 (기존 홈 로직 유지)

---

## 2. 신규 사용자 홈 스크린 설명

### 2.1 화면 구성

**메인 메시지 카드**:
- 그라데이션 배경 (보라색 계열)
- 제목: "아직 매장 데이터가 없습니다"
- 부제목: "오늘 상황을 하나만 입력해도 분석이 시작됩니다"

**안내 메시지**:
- 시작하기 안내
- 매출과 방문자 수만 입력하면 전략 제시
- 메뉴나 판매량은 나중에 입력 가능

**입력 버튼** (2개 옵션):
1. **"오늘 데이터 입력하기"** (Primary 버튼)
   - 클릭 시 → "일일 입력(통합)" 페이지로 이동
2. **"점장 마감하기"** (Secondary 버튼)
   - 클릭 시 → "점장 마감" 페이지로 이동

**추가 안내** (Expander):
- 입력 방법 설명
- 다음 단계 안내

### 2.2 사용자 경험 흐름

```
[신규 계정 로그인]
  ↓
[매장 생성] (store_id 생성)
  ↓
[홈 화면 진입]
  ↓
[data_level == 0 체크]
  ↓
[신규 사용자 홈 화면 표시]
  - "아직 매장 데이터가 없습니다" 메시지
  - "오늘 데이터 입력하기" 버튼
  ↓
[버튼 클릭]
  ↓
[일일 입력(통합) 페이지로 이동]
```

### 2.3 신규 사용자 판단 기준

**`detect_data_level(store_id)` 함수 사용**:
- **LEVEL 0**: `sales` 테이블에 데이터 0건 → 신규 사용자
- **LEVEL 1+**: `sales` 테이블에 데이터 1건 이상 → 기존 사용자

**체크 로직**:
```python
data_level = detect_data_level(store_id)
if data_level == 0:
    _render_new_user_home(store_id)  # 신규 사용자 모드
    return
# 기존 사용자 로직 계속...
```

---

## 3. 신규/기존 테스트 체크리스트

### 3.1 신규 계정 테스트

#### ✅ 1. 가입/로그인
- [ ] 신규 계정 생성
- [ ] 로그인 성공
- [ ] **온보딩 화면 없이 바로 매장 생성 화면으로 이동**
- [ ] `onboarding_mode`가 자동으로 'coach'로 설정됨

#### ✅ 2. 매장 생성
- [ ] 매장명 입력 (예: "테스트 매장")
- [ ] "매장 생성" 버튼 클릭
- [ ] 매장 생성 성공
- [ ] **매장 생성 후 홈 화면으로 자동 이동**

#### ✅ 3. 홈 화면 (신규 사용자 모드)
- [ ] 홈 화면 진입
- [ ] **"아직 매장 데이터가 없습니다" 메시지 표시**
- [ ] **"오늘 상황을 하나만 입력해도 분석이 시작됩니다" 부제목 표시**
- [ ] **"오늘 데이터 입력하기" 버튼 표시 (Primary)**
- [ ] **"점장 마감하기" 버튼 표시 (Secondary)**
- [ ] 안내 메시지 표시
- [ ] "더 알아보기" Expander 표시

#### ✅ 4. 입력 버튼 동작
- [ ] "오늘 데이터 입력하기" 버튼 클릭
- [ ] **"일일 입력(통합)" 페이지로 이동**
- [ ] 홈으로 돌아와서 "점장 마감하기" 버튼 클릭
- [ ] **"점장 마감" 페이지로 이동**

#### ✅ 5. 온보딩 흐름 제거 확인
- [ ] 온보딩 화면(`onboarding_mode_select.py`)이 전혀 표시되지 않음
- [ ] `onboarding_mode`가 NULL이어도 자동으로 'coach'로 설정됨
- [ ] 매장 생성 후에도 온보딩 화면이 표시되지 않음

### 3.2 기존 계정 테스트

#### ✅ 1. 기존 계정 로그인
- [ ] 기존 계정으로 로그인
- [ ] **온보딩 화면 없이 바로 홈으로 이동**
- [ ] 기존 홈 화면이 정상적으로 표시됨

#### ✅ 2. 홈 화면 (기존 사용자 모드)
- [ ] 홈 화면 진입
- [ ] **신규 사용자 모드가 표시되지 않음**
- [ ] **기존 ZONE 구조가 정상적으로 표시됨**:
  - ZONE 0: 오늘의 운영 지시
  - ZONE 1: 이번 달 가게 전략 요약
  - ZONE 2: 문제 인식 & 빠른 진입
  - ZONE 3: 오늘 상태판
  - ZONE 4: 이번 주 우선순위 TOP3 (lazy)
  - ZONE 5: 가게 구조 스냅샷 (lazy)

#### ✅ 3. 기존 기능 정상 작동
- [ ] KPI 로드 정상
- [ ] 전략 카드 표시 정상
- [ ] 문제 인식 기능 정상
- [ ] 상태판 표시 정상

---

## 4. 구현 세부 사항

### 4.1 온보딩 흐름 제거

**변경 전**:
```python
if needs_onboarding(user_id):
    render_onboarding_mode_select()  # 화면 표시
    st.stop()
```

**변경 후**:
```python
if needs_onboarding(user_id):
    set_onboarding_mode(user_id, 'coach')  # 자동 설정
    st.session_state[_onboarding_complete_key] = True
    # 화면 표시 없이 바로 홈으로 이동
```

### 4.2 신규 사용자 홈 모드

**추가된 함수**:
```python
def _render_new_user_home(store_id: str) -> None:
    """Phase 1 STEP 1: 신규 사용자 홈 화면 (데이터 0건)"""
    # 메인 메시지 카드
    # 안내 메시지
    # 입력 버튼 (일일 입력 / 점장 마감)
    # 추가 안내 (Expander)
```

**분기 로직**:
```python
data_level = detect_data_level(store_id)
if data_level == 0:
    _render_new_user_home(store_id)
    return  # 기존 ZONE 렌더링 건너뜀

# 기존 사용자: 기존 로직 유지
kpis = load_home_kpis(store_id, year, month)
# ... 기존 ZONE 렌더링
```

### 4.3 기존 사용자 홈 로직 유지

**확인 사항**:
- `data_level > 0`일 때 기존 로직 그대로 실행
- 모든 ZONE 렌더링 함수 호출 유지
- KPI 로드 및 표시 정상 작동
- 전략 카드, 문제 인식 등 모든 기능 정상 작동

---

## 5. 성공 기준 달성 여부

### ✅ 1. 온보딩 흐름 제거
- [x] 신규 가입 후 온보딩 화면 없이 바로 매장 생성 화면으로 이동
- [x] `onboarding_mode`가 NULL이면 자동으로 'coach'로 설정
- [x] 매장 생성 후에도 온보딩 화면이 표시되지 않음

### ✅ 2. 홈이 첫 화면
- [x] 로그인 후 무조건 홈 화면으로 이동
- [x] 온보딩 화면을 거치지 않고 바로 홈으로 이동

### ✅ 3. 신규 사용자 입력 유도
- [x] 신규 사용자(데이터 0건)일 때 홈에 입력 유도 화면 표시
- [x] "아직 매장 데이터가 없습니다" 메시지 표시
- [x] "오늘 데이터 입력하기" 버튼으로 일일 입력 페이지로 이동
- [x] "점장 마감하기" 버튼으로 점장 마감 페이지로 이동

### ✅ 4. 기존 사용자 홈 변화 없음
- [x] 기존 사용자는 기존 홈 화면 그대로 표시
- [x] 모든 기존 기능 정상 작동

---

## 6. 다음 단계

Phase 1 STEP 1이 완료되었습니다. 다음 단계는:

1. **Phase 1 STEP 2**: 일일 입력 화면 신규 사용자 최적화
   - 신규 사용자일 때 판매량/메모 섹션 숨김
   - 저장 후 성공 메시지 개선

2. **Phase 1 STEP 3**: 매장 생성 화면 개선
   - 매장 생성 성공 시 "일일 입력" 또는 "홈" 선택 제공
   - 환영 메시지 추가

3. **Phase 1 STEP 4**: 홈 ZONE 0 신규 사용자 최적화
   - 신규 사용자일 때 "오늘 매출 입력하기" 고정
   - "오늘의 지시 TOP3" 섹션 추가

---

**작성일**: 2026-01-24  
**담당**: Phase 1 STEP 1 엔지니어
