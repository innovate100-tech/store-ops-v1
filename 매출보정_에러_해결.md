# ë§¤ì¶œ ë³´ì • ì—ëŸ¬ í•´ê²°

## ğŸš¨ ì—ëŸ¬ ë‚´ìš©

```
âŒ ë§¤ì¶œ ì €ì¥ ì‹¤íŒ¨: {'message': 'Could not find the function public.save_sales_with_daily_close_sync(...)', 'code': 'PGRST202'}
```

## ì›ì¸

`save_sales` í•¨ìˆ˜ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” `save_sales_with_daily_close_sync` RPC í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

## í•´ê²°

`save_sales` í•¨ìˆ˜ë¥¼ ìˆ˜ì •í•˜ì—¬:
- âŒ RPC í•¨ìˆ˜ í˜¸ì¶œ ì œê±°
- âœ… `sales` í…Œì´ë¸”ì— ì§ì ‘ upsert
- âœ… `daily_close`ëŠ” ì ˆëŒ€ ìˆ˜ì •í•˜ì§€ ì•ŠìŒ (SSOT ì •ì±… ì¤€ìˆ˜)

## ë³€ê²½ ì‚¬í•­

**ë³€ê²½ ì „:**
```python
supabase.rpc('save_sales_with_daily_close_sync', {
    'p_date': date_str,
    'p_store_id': str(store_id),
    ...
}).execute()
```

**ë³€ê²½ í›„:**
```python
supabase.table("sales").upsert({
    "store_id": store_id,
    "date": date_str,
    "card_sales": float(card_sales),
    "cash_sales": float(cash_sales),
    "total_sales": float(total_sales)
}, on_conflict="store_id,date").execute()
```

## SSOT ì •ì±… ì¤€ìˆ˜

- âœ… ë§¤ì¶œ ë³´ì •ì€ `sales`ë§Œ upsert
- âœ… `daily_close`ëŠ” ì ˆëŒ€ ìˆ˜ì •í•˜ì§€ ì•ŠìŒ
- âœ… ì¶©ëŒ ê²½ê³ ëŠ” í‘œì‹œí•˜ì§€ë§Œ ì €ì¥ì€ ì§„í–‰

## í…ŒìŠ¤íŠ¸

1. ì ì¥ ë§ˆê°ìœ¼ë¡œ ë§¤ì¶œ ì…ë ¥
2. ë§¤ì¶œ ë³´ì • í˜ì´ì§€ì—ì„œ ê°™ì€ ë‚ ì§œì— ë‹¤ë¥¸ ë§¤ì¶œ ì…ë ¥
3. ì €ì¥ ì„±ê³µ í™•ì¸
4. `daily_close`ëŠ” ë³€ê²½ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
