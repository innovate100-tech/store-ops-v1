# ğŸ“œ PHASE 4 / STEP 4.1 - SaaS ìˆ«ì í—Œë²• ê°ì‚¬ ë¦¬í¬íŠ¸

**ì‘ì„±ì¼**: 2025-01-23  
**ì—­í• **: SaaS ì¬ë¬´ ë°ì´í„° ê°ì‚¬ê´€ (Data Auditor)  
**ëŒ€ìƒ**: 5ëŒ€ í•µì‹¬ ìˆ«ì ì „ìˆ˜ ì¡°ì‚¬

---

## ğŸ“Š ì¡°ì‚¬ ê°œìš”

- **ì¡°ì‚¬í•œ íŒŒì¼ ìˆ˜**: ì•½ 50ê°œ íŒŒì¼ (Python, SQL, Markdown í¬í•¨)
- **ê²€ìƒ‰ í‚¤ì›Œë“œ**: sales, total_sales, monthly_sales, operating_profit, break_even, cost_ratio, ingredient_usage ë“±
- **ê°ì‚¬ ê¸°ì¤€**: SaaS ìˆ«ì í—Œë²• v1.0 (5ëŒ€ í•µì‹¬ ìˆ«ì)

---

## 1ï¸âƒ£ ì›”ë§¤ì¶œ (Monthly Sales)

### ì‚¬ìš© ìœ„ì¹˜

#### âœ… ê³µì‹ ê²½ë¡œ (SSOT: sales í…Œì´ë¸”)
- **`src/storage_supabase.py:3085`** â†’ `load_monthly_sales_total()`
  - ê³„ì‚°: `sales.total_sales SUM` (KST ê¸°ì¤€ ì›” ë²”ìœ„)
  - ì‚¬ìš©ì²˜:
    - `ui_pages/home.py` â†’ ì´ë²ˆ ë‹¬ ë§¤ì¶œ í‘œì‹œ
    - `ui_pages/settlement_actual.py` â†’ ì‹¤ì œì •ì‚° ë§¤ì¶œ ë¶ˆëŸ¬ì˜¤ê¸°
    - `ui_pages/sales_entry.py` â†’ ë§¤ì¶œ ë³´ì • í˜ì´ì§€

#### âš ï¸ ë¹„ê³µì‹ ê²½ë¡œ (ìœ„í—˜ ê°€ëŠ¥ì„±)
- **`ui_pages/sales_management.py:85`** â†’ `month_data['ì´ë§¤ì¶œ'].sum()`
  - ê³„ì‚°: `load_csv('sales.csv')` â†’ `ì´ë§¤ì¶œ` ì»¬ëŸ¼ SUM
  - ìœ„í—˜ë„: ğŸŸ§ MEDIUM
  - ë©”ëª¨: CSV ìºì‹œ ê¸°ë°˜, sales í…Œì´ë¸”ê³¼ ë¶ˆì¼ì¹˜ ê°€ëŠ¥

- **`ui_pages/dashboard/metrics.py:262`** â†’ `month_data['ì´ë§¤ì¶œ'].sum()`
  - ê³„ì‚°: `load_csv('sales.csv')` â†’ ì›”ë³„ í•„í„°ë§ í›„ SUM
  - ìœ„í—˜ë„: ğŸŸ§ MEDIUM
  - ë©”ëª¨: ëŒ€ì‹œë³´ë“œì™€ í™ˆì´ ë‹¤ë¥¸ ì†ŒìŠ¤ ì‚¬ìš© ê°€ëŠ¥

- **`ui_pages/dashboard/metrics.py:72`** â†’ `compute_monthly_summary()`
  - ê³„ì‚°: `load_csv('sales.csv')` â†’ groupby(['ì—°ë„', 'ì›”']) â†’ `ì´ë§¤ì¶œ` SUM
  - ìœ„í—˜ë„: ğŸŸ§ MEDIUM
  - ë©”ëª¨: ì›”ë³„ ì§‘ê³„ê°€ CSV ê¸°ë°˜

### ê³„ì‚° ë°©ì‹ ìš”ì•½

| ìœ„ì¹˜ | í…Œì´ë¸”/ì†ŒìŠ¤ | ê³„ì‚° ë°©ì‹ | ê³µì‹ ì—¬ë¶€ |
|------|------------|----------|----------|
| `load_monthly_sales_total()` | `sales` | `total_sales SUM` | âœ… í—Œë²• ì¤€ìˆ˜ |
| `sales_management.py` | `sales.csv` (ìºì‹œ) | `ì´ë§¤ì¶œ SUM` | âŒ í—Œë²• ìœ„ë°˜ ê°€ëŠ¥ |
| `dashboard/metrics.py` | `sales.csv` (ìºì‹œ) | `ì´ë§¤ì¶œ SUM` | âŒ í—Œë²• ìœ„ë°˜ ê°€ëŠ¥ |

### ìœ„í—˜ë„: ğŸŸ§ MEDIUM

**ì´ìœ **:
- ê³µì‹ í•¨ìˆ˜(`load_monthly_sales_total`)ëŠ” ì¡´ì¬í•˜ë‚˜, ì¼ë¶€ í˜ì´ì§€ê°€ CSV ìºì‹œ ì§ì ‘ ì‚¬ìš©
- í™”ë©´ë§ˆë‹¤ ë‹¤ë¥¸ ê³„ì‚° ê²½ë¡œë¡œ ì¸í•œ ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±
- CSV ìºì‹œì™€ DB ë™ê¸°í™” ë¬¸ì œ

---

## 2ï¸âƒ£ ì˜ì—…ì´ìµ (Operating Profit)

### ì‚¬ìš© ìœ„ì¹˜

#### âœ… ê³µì‹ ê²½ë¡œ (SSOT: actual_settlement_items ê¸°ë°˜ ê³„ì‚°)
- **`ui_pages/settlement_actual.py:214`** â†’ `_calculate_totals()`
  - ê³„ì‚°: `operating_profit = total_sales - total_cost`
  - `total_cost = sum(category_totals)` (ê³ ì •ë¹„ + ë³€ë™ë¹„)
  - ì‚¬ìš©ì²˜: ì‹¤ì œì •ì‚° í˜ì´ì§€ ë‚´ë¶€ ê³„ì‚°

- **`src/storage_supabase.py:3394`** â†’ `load_monthly_settlement_snapshot()`
  - ê³„ì‚°: `operating_profit = float(total_sales) - total_cost`
  - `total_cost = sum(category_totals)` (actual_settlement_items ê¸°ë°˜)
  - ì‚¬ìš©ì²˜: ì„±ì í‘œ, ì •ì‚° íˆìŠ¤í† ë¦¬

#### âš ï¸ ë¹„ê³µì‹ ê²½ë¡œ (ì˜ˆìƒ/ëª©í‘œ ê³„ì‚°)
- **`ui_pages/settlement_actual.py:1028`** â†’ `_compute_scorecard()`
  - ê³„ì‚°: `target_profit = target_sales - target_total_cost`
  - ìœ„í—˜ë„: ğŸŸ¨ LOW (ëª©í‘œ ê³„ì‚°ìš©)

- **`ui_pages/target_cost_structure.py:2307`** â†’ ëª©í‘œ ë§¤ì¶œ ê¸°ì¤€
  - ê³„ì‚°: `target_profit = (target_sales * (1 - variable_rate_decimal)) - fixed_costs`
  - ìœ„í—˜ë„: ğŸŸ¨ LOW (ì˜ˆìƒ ê³„ì‚°ìš©)

- **`app.py:2307`** â†’ ëª©í‘œ ë§¤ì¶œ ê¸°ì¤€
  - ê³„ì‚°: `target_profit = (target_sales * (1 - variable_rate_decimal)) - fixed_costs`
  - ìœ„í—˜ë„: ğŸŸ¨ LOW (ì˜ˆìƒ ê³„ì‚°ìš©)

### ê³„ì‚° ë°©ì‹ ìš”ì•½

| ìœ„ì¹˜ | ì†ŒìŠ¤ | ê³„ì‚° ë°©ì‹ | ê³µì‹ ì—¬ë¶€ |
|------|------|----------|----------|
| `settlement_actual.py` | actual_settlement_items | `sales - cost` | âœ… í—Œë²• ì¤€ìˆ˜ |
| `load_monthly_settlement_snapshot()` | actual_settlement_items | `sales - cost` | âœ… í—Œë²• ì¤€ìˆ˜ |
| `target_cost_structure.py` | expense_structure + targets | ì˜ˆìƒ ê³„ì‚° | ğŸŸ¨ êµ¬ì¡°ìš© |

### ìœ„í—˜ë„: ğŸŸ¨ LOW

**ì´ìœ **:
- ì‹¤ì œ ì˜ì—…ì´ìµì€ `actual_settlement_items` ê¸°ë°˜ìœ¼ë¡œ ì¼ê´€ì„± ìˆê²Œ ê³„ì‚°ë¨
- ëª©í‘œ/ì˜ˆìƒ ê³„ì‚°ì€ ëª…í™•íˆ êµ¬ë¶„ë˜ì–´ ìˆìŒ
- ë‹¨ì¼ SSOT í•¨ìˆ˜ëŠ” ì—†ìœ¼ë‚˜, ê³„ì‚° ë¡œì§ì´ ë‹¨ìˆœí•˜ê³  ì¼ê´€ì 

---

## 3ï¸âƒ£ ì†ìµë¶„ê¸°ì  (Break Even Sales)

### ì‚¬ìš© ìœ„ì¹˜

#### âœ… ê³µì‹ ê²½ë¡œ (expense_structure ê¸°ë°˜)
- **`ui_pages/dashboard/metrics.py:193`** â†’ `_compute_dashboard_metrics()`
  - ê³„ì‚°: `breakeven_sales = fixed_costs / (1 - variable_rate_decimal)`
  - `fixed_costs`: ì„ì°¨ë£Œ + ì¸ê±´ë¹„ + ê³µê³¼ê¸ˆ í•©ê³„
  - `variable_rate_decimal`: (ì¬ë£Œë¹„ + ë¶€ê°€ì„¸&ì¹´ë“œìˆ˜ìˆ˜ë£Œ) / 100
  - ì‚¬ìš©ì²˜: í†µí•© ëŒ€ì‹œë³´ë“œ

- **`app.py:3155`** â†’ ì†ìµë¶„ê¸°ì  ê³„ì‚° í˜ì´ì§€
  - ê³„ì‚°: `breakeven_sales = fixed_costs / (1 - variable_rate_decimal)`
  - ì‚¬ìš©ì²˜: ëª©í‘œ ë¹„ìš©êµ¬ì¡° í˜ì´ì§€

- **`ui_pages/target_cost_structure.py:3155`** â†’ ëª©í‘œ ë¹„ìš©êµ¬ì¡° í˜ì´ì§€
  - ê³„ì‚°: `breakeven_sales = fixed_costs / (1 - variable_rate_decimal)`
  - ì‚¬ìš©ì²˜: ëª©í‘œ ë¹„ìš©êµ¬ì¡° í˜ì´ì§€

- **`ui_pages/home.py`** â†’ `get_store_financial_structure()`
  - ê³„ì‚°: `break_even_sales = fixed_cost / (1 - variable_ratio)`
  - ì‚¬ìš©ì²˜: í™ˆ "ìš°ë¦¬ ê°€ê²Œ ìˆ«ì êµ¬ì¡°" ì„¹ì…˜

#### âš ï¸ ì¤‘ë³µ ê³„ì‚° (ë™ì¼ ê³µì‹, ë‹¤ë¥¸ ìœ„ì¹˜)
- **`app.py:2272`** â†’ ì¼ì¼ ì†ìµë¶„ê¸° ë§¤ì¶œ ê³„ì‚°
  - ê³„ì‚°: `weekday_daily_breakeven = (breakeven_sales * weekday_ratio / 100) / 22`
  - ìœ„í—˜ë„: ğŸŸ§ MEDIUM (ê³µì‹ì€ ë§ìœ¼ë‚˜ ì¤‘ë³µ)

### ê³„ì‚° ë°©ì‹ ìš”ì•½

| ìœ„ì¹˜ | ì†ŒìŠ¤ | ê³„ì‚° ë°©ì‹ | ê³µì‹ ì—¬ë¶€ |
|------|------|----------|----------|
| `dashboard/metrics.py` | expense_structure | `fixed / (1 - variable)` | âœ… í—Œë²• ì¤€ìˆ˜ |
| `app.py` | expense_structure | `fixed / (1 - variable)` | âœ… í—Œë²• ì¤€ìˆ˜ |
| `target_cost_structure.py` | expense_structure | `fixed / (1 - variable)` | âœ… í—Œë²• ì¤€ìˆ˜ |
| `home.py` | expense_structure | `fixed / (1 - variable)` | âœ… í—Œë²• ì¤€ìˆ˜ |

### ìœ„í—˜ë„: ğŸŸ§ MEDIUM

**ì´ìœ **:
- ê³µì‹ì€ ì¼ê´€ë˜ë‚˜, 4ê°œ ì´ìƒì˜ ìœ„ì¹˜ì—ì„œ ì¤‘ë³µ ê³„ì‚°
- SSOT í•¨ìˆ˜ ì—†ìŒ â†’ í–¥í›„ ìˆ˜ì • ì‹œ ëˆ„ë½ ê°€ëŠ¥ì„±
- ê³ ì •ë¹„/ë³€ë™ë¹„ ê³„ì‚° ë¡œì§ë„ ì¤‘ë³µ (ì„ì°¨ë£Œ+ì¸ê±´ë¹„+ê³µê³¼ê¸ˆ, ì¬ë£Œë¹„+ë¶€ê°€ì„¸&ì¹´ë“œìˆ˜ìˆ˜ë£Œ)

---

## 4ï¸âƒ£ ì›ê°€ìœ¨ (Cost Ratio)

### ì‚¬ìš© ìœ„ì¹˜

#### âœ… ê³µì‹ ê²½ë¡œ (ë ˆì‹œí”¼ + ì¬ë£Œ ë‹¨ê°€ ê¸°ë°˜)
- **`src/analytics.py:71`** â†’ `calculate_menu_cost()`
  - ê³„ì‚°: `ì›ê°€ = sum(ì‚¬ìš©ëŸ‰ * ë‹¨ê°€)` â†’ `ì›ê°€ìœ¨ = (ì›ê°€ / íŒë§¤ê°€) * 100`
  - ì†ŒìŠ¤: `menu_master`, `recipes`, `ingredient_master`
  - ì‚¬ìš©ì²˜:
    - `ui_pages/cost_overview.py` â†’ ì›ê°€ íŒŒì•… í˜ì´ì§€
    - `app.py:2741` â†’ íŒë§¤ ë¶„ì„ í˜ì´ì§€
    - `ui_pages/sales_analysis.py` â†’ íŒë§¤ ë¶„ì„

#### âš ï¸ ë¹„ê³µì‹ ê²½ë¡œ (ëª©í‘œ/ì˜ˆìƒ)
- **`ui_pages/target_gap_analysis.py`** (ì¶”ì •)
  - ê³„ì‚°: `current_cost_rate = (menu_sales['ì›ê°€ìœ¨'] * menu_sales['ë§¤ì¶œë¹„ì¤‘']).sum()`
  - ìœ„í—˜ë„: ğŸŸ¨ LOW (ê°€ì¤‘ í‰ê· , ì˜ˆìƒìš©)

- **`ui_pages/sales_analysis.py`** â†’ íŒë§¤ ë¶„ì„
  - ê³„ì‚°: `ì›ê°€ìœ¨ = (ì›ê°€ / íŒë§¤ê°€) * 100` (ë©”ë‰´ë³„)
  - ìœ„í—˜ë„: ğŸŸ¨ LOW (í‘œì‹œìš©)

### ê³„ì‚° ë°©ì‹ ìš”ì•½

| ìœ„ì¹˜ | ì†ŒìŠ¤ | ê³„ì‚° ë°©ì‹ | ê³µì‹ ì—¬ë¶€ |
|------|------|----------|----------|
| `analytics.py:calculate_menu_cost()` | recipes + ingredients | `(ì›ê°€/íŒë§¤ê°€)*100` | âœ… í—Œë²• ì¤€ìˆ˜ |
| `sales_analysis.py` | íŒë§¤ ë°ì´í„° + ì›ê°€ | `(ì›ê°€/íŒë§¤ê°€)*100` | âœ… í—Œë²• ì¤€ìˆ˜ |
| `target_gap_analysis.py` | ê°€ì¤‘ í‰ê·  | ì˜ˆìƒ ê³„ì‚° | ğŸŸ¨ êµ¬ì¡°ìš© |

### ìœ„í—˜ë„: ğŸŸ¨ LOW

**ì´ìœ **:
- ë©”ë‰´ë³„ ì›ê°€ìœ¨ ê³„ì‚°ì€ `calculate_menu_cost()`ë¡œ í†µì¼ë¨
- ì‹¤ì œ ì›ê°€ìœ¨ê³¼ ëª©í‘œ ì›ê°€ìœ¨ì´ ëª…í™•íˆ êµ¬ë¶„ë¨
- ë‹¨ì¼ SSOT í•¨ìˆ˜ ì¡´ì¬

---

## 5ï¸âƒ£ ì‹¤ì œ ì¬ë£Œ ì‚¬ìš©ëŸ‰ (Actual Ingredient Usage)

### ì‚¬ìš© ìœ„ì¹˜

#### âœ… ê³µì‹ ê²½ë¡œ (íŒë§¤ëŸ‰ Ã— ë ˆì‹œí”¼)
- **`src/analytics.py:125`** â†’ `calculate_ingredient_usage()`
  - ê³„ì‚°: `ì¬ë£Œì‚¬ìš©ëŸ‰ = íŒë§¤ìˆ˜ëŸ‰ * ë ˆì‹œí”¼ì‚¬ìš©ëŸ‰`
  - ì†ŒìŠ¤: `daily_sales_df` (ë˜ëŠ” `v_daily_sales_items_effective`) + `recipe_df`
  - ì‚¬ìš©ì²˜:
    - `ui_pages/ingredient_usage_summary.py` â†’ ì¬ë£Œ ì‚¬ìš©ëŸ‰ ìš”ì•½
    - `app.py:2860` â†’ ì¬ë£Œë³„ ì‚¬ìš©ëŸ‰ ì§‘ê³„
    - `src/storage_supabase.py:2046` â†’ ë§ˆê° ì €ì¥ ì‹œ ì¬ê³  ì°¨ê°

#### âš ï¸ ë¹„ê³µì‹ ê²½ë¡œ (ì§ì ‘ ê³„ì‚°)
- **`src/storage_supabase.py:2046`** â†’ `save_daily_close()` ë‚´ë¶€
  - ê³„ì‚°: `usage = sales_qty * recipe_qty` (ì¸ë¼ì¸)
  - ìœ„í—˜ë„: ğŸŸ§ MEDIUM (ì¤‘ë³µ ë¡œì§)

- **`ui_pages/dashboard/metrics.py`** â†’ ëŒ€ì‹œë³´ë“œ ë©”ë‰´ ì„¹ì…˜
  - ê³„ì‚°: `daily_sales_df` ê¸°ë°˜ ì§ì ‘ ê³„ì‚° (ì¶”ì •)
  - ìœ„í—˜ë„: ğŸŸ§ MEDIUM

### ê³„ì‚° ë°©ì‹ ìš”ì•½

| ìœ„ì¹˜ | ì†ŒìŠ¤ | ê³„ì‚° ë°©ì‹ | ê³µì‹ ì—¬ë¶€ |
|------|------|----------|----------|
| `analytics.py:calculate_ingredient_usage()` | daily_sales + recipes | `íŒë§¤ëŸ‰ * ë ˆì‹œí”¼` | âœ… í—Œë²• ì¤€ìˆ˜ |
| `storage_supabase.py:save_daily_close()` | sales_items + recipes | `íŒë§¤ëŸ‰ * ë ˆì‹œí”¼` | âš ï¸ ì¤‘ë³µ |
| `dashboard/metrics.py` | daily_sales_df | ì§ì ‘ ê³„ì‚° | âš ï¸ ì¤‘ë³µ ê°€ëŠ¥ |

### ìœ„í—˜ë„: ğŸŸ§ MEDIUM

**ì´ìœ **:
- ê³µì‹ í•¨ìˆ˜(`calculate_ingredient_usage`) ì¡´ì¬í•˜ë‚˜, ì¼ë¶€ ìœ„ì¹˜ì—ì„œ ì¸ë¼ì¸ ê³„ì‚°
- `save_daily_close()` ë‚´ë¶€ì—ì„œ ì¬ê³  ì°¨ê°ìš©ìœ¼ë¡œ ì¤‘ë³µ ê³„ì‚°
- `v_daily_sales_items_effective` ì‚¬ìš© ì—¬ë¶€ ë¶ˆì¼ì¹˜ ê°€ëŠ¥

---

## ğŸ”´ HIGH ìœ„í—˜ í•­ëª© TOP 5

### 1. ì›”ë§¤ì¶œ: CSV ìºì‹œ ì§ì ‘ ì‚¬ìš© (ğŸŸ¥ HIGH)
- **ìœ„ì¹˜**: `sales_management.py`, `dashboard/metrics.py`
- **ë¬¸ì œ**: `load_monthly_sales_total()` (SSOT) ëŒ€ì‹  `load_csv('sales.csv')` ì§ì ‘ ì‚¬ìš©
- **ì˜í–¥**: í™”ë©´ë§ˆë‹¤ ë‹¤ë¥¸ ë§¤ì¶œ í‘œì‹œ ê°€ëŠ¥ì„±
- **ìš°ì„ ìˆœìœ„**: ìµœìš°ì„  (SSOT í†µí•© í•„ìš”)

### 2. ì†ìµë¶„ê¸°ì : ì¤‘ë³µ ê³„ì‚° ë¡œì§ (ğŸŸ¥ HIGH)
- **ìœ„ì¹˜**: `dashboard/metrics.py`, `app.py`, `target_cost_structure.py`, `home.py`
- **ë¬¸ì œ**: ê³ ì •ë¹„/ë³€ë™ë¹„ ê³„ì‚° ë¡œì§ì´ 4ê³³ ì´ìƒ ì¤‘ë³µ
- **ì˜í–¥**: ìˆ˜ì • ì‹œ ëˆ„ë½ ê°€ëŠ¥ì„±, ë¶ˆì¼ì¹˜ ìœ„í—˜
- **ìš°ì„ ìˆœìœ„**: ë†’ìŒ (SSOT í•¨ìˆ˜ ìƒì„± í•„ìš”)

### 3. ì›”ë§¤ì¶œ: ëŒ€ì‹œë³´ë“œ vs í™ˆ ë¶ˆì¼ì¹˜ (ğŸŸ¥ HIGH)
- **ìœ„ì¹˜**: `dashboard/metrics.py` vs `home.py`
- **ë¬¸ì œ**: ëŒ€ì‹œë³´ë“œëŠ” CSV, í™ˆì€ `load_monthly_sales_total()` ì‚¬ìš©
- **ì˜í–¥**: ê°™ì€ ìˆ«ìê°€ ë‹¤ë¥´ê²Œ í‘œì‹œë  ìˆ˜ ìˆìŒ
- **ìš°ì„ ìˆœìœ„**: ìµœìš°ì„ 

### 4. ì¬ë£Œ ì‚¬ìš©ëŸ‰: ì¸ë¼ì¸ ê³„ì‚° ì¤‘ë³µ (ğŸŸ§ MEDIUM â†’ ğŸŸ¥ HIGH)
- **ìœ„ì¹˜**: `storage_supabase.py:save_daily_close()` ë‚´ë¶€
- **ë¬¸ì œ**: `calculate_ingredient_usage()` í•¨ìˆ˜ ì¡´ì¬í•˜ë‚˜ ì¸ë¼ì¸ ê³„ì‚° ì‚¬ìš©
- **ì˜í–¥**: ë¡œì§ ë¶ˆì¼ì¹˜, ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€
- **ìš°ì„ ìˆœìœ„**: ì¤‘ê°„

### 5. ì›”ë§¤ì¶œ: CSV ìºì‹œ ë™ê¸°í™” ë¬¸ì œ (ğŸŸ¥ HIGH)
- **ìœ„ì¹˜**: `load_csv('sales.csv')` ì‚¬ìš© ì „ë°˜
- **ë¬¸ì œ**: DBì™€ CSV ìºì‹œ ë¶ˆì¼ì¹˜ ê°€ëŠ¥ì„±
- **ì˜í–¥**: ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë°ì´í„°ê°€ ì¦‰ì‹œ ë°˜ì˜ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
- **ìš°ì„ ìˆœìœ„**: ìµœìš°ì„ 

---

## ğŸŸ  MEDIUM ìœ„í—˜ í•­ëª© TOP 5

### 1. ì†ìµë¶„ê¸°ì : ì¼ì¼ ê³„ì‚° ì¤‘ë³µ
- **ìœ„ì¹˜**: `app.py`, `target_cost_structure.py`
- **ë¬¸ì œ**: í‰ì¼/ì£¼ë§ ì¼ì¼ ì†ìµë¶„ê¸° ë§¤ì¶œ ê³„ì‚° ë¡œì§ ì¤‘ë³µ
- **ìš°ì„ ìˆœìœ„**: ì¤‘ê°„

### 2. ì˜ì—…ì´ìµ: ëª©í‘œ ê³„ì‚°ê³¼ ì‹¤ì œ ê³„ì‚° í˜¼ì¬
- **ìœ„ì¹˜**: `settlement_actual.py`, `target_cost_structure.py`
- **ë¬¸ì œ**: ëª©í‘œì™€ ì‹¤ì œ ê³„ì‚°ì´ ê°™ì€ íŒŒì¼ì— ì„ì—¬ ìˆìŒ (êµ¬ë¶„ì€ ëª…í™•)
- **ìš°ì„ ìˆœìœ„**: ë‚®ìŒ

### 3. ì›ê°€ìœ¨: ê°€ì¤‘ í‰ê·  ê³„ì‚° ìœ„ì¹˜ ë¶ˆëª…í™•
- **ìœ„ì¹˜**: `target_gap_analysis.py` (ì¶”ì •)
- **ë¬¸ì œ**: ê°€ì¤‘ í‰ê·  ì›ê°€ìœ¨ ê³„ì‚°ì´ ì–´ë””ì„œ ì‚¬ìš©ë˜ëŠ”ì§€ ë¶ˆëª…í™•
- **ìš°ì„ ìˆœìœ„**: ë‚®ìŒ

### 4. ì¬ë£Œ ì‚¬ìš©ëŸ‰: v_daily_sales_items_effective ì‚¬ìš© ë¶ˆì¼ì¹˜
- **ìœ„ì¹˜**: `calculate_ingredient_usage()` vs `save_daily_close()`
- **ë¬¸ì œ**: override ë ˆì´ì–´ ì‚¬ìš© ì—¬ë¶€ ë¶ˆì¼ì¹˜ ê°€ëŠ¥
- **ìš°ì„ ìˆœìœ„**: ì¤‘ê°„

### 5. ì›”ë§¤ì¶œ: ì›”ë³„ ì§‘ê³„ í•¨ìˆ˜ ì¤‘ë³µ
- **ìœ„ì¹˜**: `compute_monthly_summary()` vs `load_monthly_sales_total()`
- **ë¬¸ì œ**: ë‘ í•¨ìˆ˜ ëª¨ë‘ ì›”ë³„ ë§¤ì¶œ ì§‘ê³„í•˜ë‚˜ ìš©ë„ê°€ ë‹¤ë¦„
- **ìš°ì„ ìˆœìœ„**: ë‚®ìŒ

---

## ğŸŸ¡ LOW ìœ„í—˜ í•­ëª© ìš”ì•½

- **ëª©í‘œ/ì˜ˆìƒ ê³„ì‚°**: ëª©í‘œ ë¹„ìš©êµ¬ì¡°, ëª©í‘œ ë§¤ì¶œ ê¸°ë°˜ ê³„ì‚°ì€ êµ¬ì¡°ìš©ìœ¼ë¡œ ëª…í™•íˆ êµ¬ë¶„ë¨
- **ë‹¨ì¼ ì‚¬ìš© ìœ„ì¹˜**: ì›ê°€ìœ¨ ê³„ì‚°(`calculate_menu_cost`)ì€ SSOT í•¨ìˆ˜ë¡œ í†µì¼ë¨
- **ì˜ì—…ì´ìµ**: ì‹¤ì œ ê³„ì‚°ì€ `actual_settlement_items` ê¸°ë°˜ìœ¼ë¡œ ì¼ê´€ì 

---

## ğŸ“‹ ê°œì„  ëŒ€ìƒ ë¦¬ìŠ¤íŠ¸

### ë°˜ë“œì‹œ ë‹¨ì¼í™”í•´ì•¼ í•  ê³„ì‚°

- [ ] **ì›”ë§¤ì¶œ**: ëª¨ë“  ìœ„ì¹˜ì—ì„œ `load_monthly_sales_total()` ì‚¬ìš© ê°•ì œ
  - `sales_management.py`: CSV ì§ì ‘ ì‚¬ìš© â†’ `load_monthly_sales_total()` ë³€ê²½
  - `dashboard/metrics.py`: CSV ì§ì ‘ ì‚¬ìš© â†’ `load_monthly_sales_total()` ë³€ê²½
  - `compute_monthly_summary()`: CSV ê¸°ë°˜ â†’ `load_monthly_sales_total()` ê¸°ë°˜ìœ¼ë¡œ ë¦¬íŒ©í† ë§

- [ ] **ì†ìµë¶„ê¸°ì **: SSOT í•¨ìˆ˜ ìƒì„±
  - í•¨ìˆ˜ëª…: `calculate_break_even_sales(store_id, year, month)`
  - ê³ ì •ë¹„/ë³€ë™ë¹„ ê³„ì‚°ë„ í¬í•¨
  - ì‚¬ìš©ì²˜: `dashboard/metrics.py`, `app.py`, `target_cost_structure.py`, `home.py`

### êµ¬ì¡°/ì˜ˆìƒìœ¼ë¡œ ë‚´ë ¤ì•¼ í•  ê³„ì‚°

- [ ] **ëª©í‘œ ì˜ì—…ì´ìµ**: `target_profit` ê³„ì‚°ì„ ë³„ë„ í•¨ìˆ˜ë¡œ ë¶„ë¦¬
  - í˜„ì¬: `settlement_actual.py`, `target_cost_structure.py`ì— í˜¼ì¬
  - ì œì•ˆ: `calculate_target_profit()` í•¨ìˆ˜ ìƒì„±

### SSOT í•¨ìˆ˜ë¡œ ë¬¶ì–´ì•¼ í•  ë¶€ë¶„

- [ ] **ê³ ì •ë¹„ ê³„ì‚°**: `get_fixed_costs(store_id, year, month)`
  - í˜„ì¬: 4ê³³ ì´ìƒì—ì„œ `ì„ì°¨ë£Œ + ì¸ê±´ë¹„ + ê³µê³¼ê¸ˆ` ì¤‘ë³µ ê³„ì‚°
  - ì‚¬ìš©ì²˜: ì†ìµë¶„ê¸°ì , í™ˆ ìˆ«ì êµ¬ì¡°, ëŒ€ì‹œë³´ë“œ

- [ ] **ë³€ë™ë¹„ìœ¨ ê³„ì‚°**: `get_variable_cost_ratio(store_id, year, month)`
  - í˜„ì¬: 4ê³³ ì´ìƒì—ì„œ `ì¬ë£Œë¹„ + ë¶€ê°€ì„¸&ì¹´ë“œìˆ˜ìˆ˜ë£Œ` ì¤‘ë³µ ê³„ì‚°
  - ì‚¬ìš©ì²˜: ì†ìµë¶„ê¸°ì , í™ˆ ìˆ«ì êµ¬ì¡°, ëŒ€ì‹œë³´ë“œ

- [ ] **ì¬ë£Œ ì‚¬ìš©ëŸ‰ ê³„ì‚°**: `calculate_ingredient_usage()` ê°•ì œ ì‚¬ìš©
  - `save_daily_close()` ë‚´ë¶€ ì¸ë¼ì¸ ê³„ì‚° ì œê±°
  - `calculate_ingredient_usage()` í˜¸ì¶œë¡œ í†µì¼

### í…ŒìŠ¤íŠ¸ í•„ìš” ì˜ì—­

- [ ] **ì›”ë§¤ì¶œ ì¼ê´€ì„± í…ŒìŠ¤íŠ¸**: í™ˆ, ëŒ€ì‹œë³´ë“œ, ë§¤ì¶œ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ê°™ì€ ê°’ í‘œì‹œ í™•ì¸
- [ ] **ì†ìµë¶„ê¸°ì  ì¼ê´€ì„± í…ŒìŠ¤íŠ¸**: ëª¨ë“  í˜ì´ì§€ì—ì„œ ê°™ì€ ê°’ ê³„ì‚° í™•ì¸
- [ ] **ì¬ë£Œ ì‚¬ìš©ëŸ‰ ì •í™•ì„± í…ŒìŠ¤íŠ¸**: override ë ˆì´ì–´ ë°˜ì˜ ì—¬ë¶€ í™•ì¸
- [ ] **CSV ìºì‹œ ë™ê¸°í™” í…ŒìŠ¤íŠ¸**: DB ì—…ë°ì´íŠ¸ í›„ CSV ìºì‹œ ì¦‰ì‹œ ë°˜ì˜ í™•ì¸

---

## ğŸ¯ ë‹¤ìŒ STEP ê¶Œê³ 

### Phase 4.2 (ì •ë¦¬) ìš°ì„ ìˆœìœ„

1. **ìµœìš°ì„ **: ì›”ë§¤ì¶œ SSOT í†µí•©
   - `load_monthly_sales_total()` ì‚¬ìš© ê°•ì œ
   - CSV ì§ì ‘ ì‚¬ìš© ì œê±°
   - í…ŒìŠ¤íŠ¸: ëª¨ë“  í˜ì´ì§€ì—ì„œ ê°™ì€ ê°’ í‘œì‹œ

2. **ë†’ìŒ**: ì†ìµë¶„ê¸°ì  SSOT í•¨ìˆ˜ ìƒì„±
   - `calculate_break_even_sales()` ìƒì„±
   - ê³ ì •ë¹„/ë³€ë™ë¹„ ê³„ì‚° í•¨ìˆ˜ë„ í•¨ê»˜ ìƒì„±
   - ëª¨ë“  ìœ„ì¹˜ì—ì„œ í•¨ìˆ˜ í˜¸ì¶œë¡œ ë³€ê²½

3. **ì¤‘ê°„**: ì¬ë£Œ ì‚¬ìš©ëŸ‰ ê³„ì‚° í†µì¼
   - `save_daily_close()` ë‚´ë¶€ ì¸ë¼ì¸ ê³„ì‚° ì œê±°
   - `calculate_ingredient_usage()` ê°•ì œ ì‚¬ìš©

4. **ë‚®ìŒ**: ëª©í‘œ/ì˜ˆìƒ ê³„ì‚° ë¶„ë¦¬
   - ëª©í‘œ ê³„ì‚° í•¨ìˆ˜ ë¶„ë¦¬ (ì„ íƒì )

---

## ğŸ“Š í†µê³„ ìš”ì•½

- **ì›”ë§¤ì¶œ ê²½ë¡œ ìˆ˜**: 5ê°œ (ê³µì‹ 1ê°œ, ë¹„ê³µì‹ 4ê°œ)
- **ì˜ì—…ì´ìµ ê²½ë¡œ ìˆ˜**: 3ê°œ (ê³µì‹ 2ê°œ, ëª©í‘œ 1ê°œ)
- **ì†ìµë¶„ê¸°ì  ê²½ë¡œ ìˆ˜**: 4ê°œ (ëª¨ë‘ ê³µì‹, ì¤‘ë³µ)
- **ì›ê°€ìœ¨ ê²½ë¡œ ìˆ˜**: 2ê°œ (ê³µì‹ 1ê°œ, ê°€ì¤‘í‰ê·  1ê°œ)
- **ì‹¤ì œ ì‚¬ìš©ëŸ‰ ê²½ë¡œ ìˆ˜**: 3ê°œ (ê³µì‹ 1ê°œ, ì¸ë¼ì¸ 2ê°œ)

---

**ê°ì‚¬ ì™„ë£Œì¼**: 2025-01-23  
**ë‹¤ìŒ ë‹¨ê³„**: Phase 4.2 - SSOT í†µí•© ë° í•¨ìˆ˜ ìƒì„±
