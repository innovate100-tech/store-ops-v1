# PHASE 9 / STEP 9-6 — 가게 설계 센터 생성 + 설계실 공통 UX 업그레이드 완료

## 📋 작업 목표

3가지 목표를 한 번에 구현했습니다:
1. "가게 설계 센터(통합 진단실)" 신규 페이지 생성
2. 각 설계실 상단에 공통 버튼 추가
3. 설계실 상단 토글 "전략 브리핑 / 전략 실행" UX 분리

---

## ✅ 완료된 작업

### 1. 가게 설계 센터 페이지 생성
- **파일**: `ui_pages/design_lab/design_center.py` (신규 생성)
- **데이터 헬퍼**: `ui_pages/design_lab/design_center_data.py` (신규 생성)
- **기능**: 4개 설계실 통합 진단 및 상태 요약
- **라우팅**: app.py에 "가게 설계 센터" 라우팅 추가
- **사이드바**: "🔥 가게 설계" 카테고리 최상단에 추가

### 2. 공통 네비게이션 버튼 컴포넌트 생성
- **파일**: `ui_pages/design_lab/design_lab_nav.py` (신규 생성)
- **기능**: `render_back_to_design_center_button()` 함수
- **적용**: 4개 설계실 모두에 추가

### 3. 설계실 탭 분리 (전략 브리핑 / 전략 실행)
- **적용 대상**: 4개 설계실 모두
- **구조**: `st.tabs(["📊 전략 브리핑", "🛠️ 전략 실행"])`
- **브리핑 탭**: ZONE A/B/C (코치 요약, 구조 맵, 사장 학교)
- **실행 탭**: ZONE D (설계 도구)

---

## 📝 페이지 구조

### 가게 설계 센터 (통합 진단실)

#### ZONE A: 코치 요약 (통합)
- **카드 4개** (설계실 4개와 1:1 매핑):
  1. 메뉴 포트폴리오 상태 (균형 점수, 상태 배지)
  2. 메뉴 수익 구조 상태 (고원가율 메뉴 수, 상태 배지)
  3. 재료 구조 상태 (TOP3 집중도, 상태 배지)
  4. 수익 구조 상태 (손익분기점 대비 %, 상태 배지)
- **각 카드에 [바로가기] 버튼**: 해당 설계실로 이동
- **판결문**: 가장 의심되는 구조 1개 자동 선택
- **추천 액션**: 해당 설계실로 이동하는 CTA 버튼

#### ZONE B: 구조 레이더/요약 맵
- **4열 비교 테이블**: 구조명, 점수, 상태, 요약
- **구조 점수 비교 bar chart**: 4개 구조 점수 시각화

#### ZONE C: 코치 1차 판결 (핵심)
- **"이번 달 가장 의심되는 구조 1개"** 자동 선택
- **판결문 + 근거**: 숫자 포함
- **CTA 버튼**: [가장 의심되는 설계실로 이동]
- **두 번째 후보 보기** (expander): 옵션으로 표시

#### ZONE D: 전략 실행 런치패드
- **문제 상황별 실행 버튼** 6개:
  1. 매출 하락 원인 찾기 → 매출 분석
  2. 고원가율 메뉴 정리 → 메뉴 수익 구조 설계실
  3. 포트폴리오 미분류 정리 → 메뉴 등록
  4. 원가 집중/대체재 설계 → 재료 등록
  5. 손익분기점 갱신 → 수익 구조 설계실
  6. 홈으로 돌아가기 → 홈

---

## 📝 수정된 파일 목록

### 신규 생성 파일
1. **`ui_pages/design_lab/design_center.py`**
   - 가게 설계 센터 메인 페이지
   - 4층 구조 (ZONE A/B/C/D)

2. **`ui_pages/design_lab/design_center_data.py`**
   - 통합 진단 데이터 헬퍼 함수
   - `get_design_center_summary()`: 4개 설계실 요약 데이터
   - `get_primary_concern()`: 가장 의심되는 구조 선택

3. **`ui_pages/design_lab/design_lab_nav.py`**
   - 공통 네비게이션 컴포넌트
   - `render_back_to_design_center_button()`: 돌아가기 버튼

### 수정된 파일
1. **`ui_pages/menu_management.py`**
   - 공통 네비게이션 버튼 추가
   - 탭 분리 (전략 브리핑 / 전략 실행)

2. **`ui_pages/menu_profit_design_lab.py`**
   - 공통 네비게이션 버튼 추가
   - 탭 분리 (전략 브리핑 / 전략 실행)

3. **`ui_pages/ingredient_management.py`**
   - 공통 네비게이션 버튼 추가
   - 탭 분리 (전략 브리핑 / 전략 실행)

4. **`ui_pages/revenue_structure_design_lab.py`**
   - 공통 네비게이션 버튼 추가
   - 탭 분리 (전략 브리핑 / 전략 실행)

5. **`app.py`**
   - 사이드바: "가게 설계 센터" 최상단 추가
   - 라우팅: `elif page == "가게 설계 센터"` 추가

---

## ✅ 앱 실행 시 확인 체크리스트

### 가게 설계 센터
- [ ] 사이드바 "🔥 가게 설계" → "가게 설계 센터" 클릭 → 새 페이지 진입 OK
- [ ] ZONE A (코치 요약) 정상 표시
  - [ ] 4개 카드 정상 표시 (메뉴 포트폴리오, 메뉴 수익 구조, 재료 구조, 수익 구조)
  - [ ] 각 카드에 상태 배지 정상 표시 (✅/⚠️/🔴)
  - [ ] 카드별 바로가기 버튼 4개 정상 동작
  - [ ] 판결문 정상 표시
  - [ ] 추천 액션 버튼 정상 동작
- [ ] ZONE B (구조 레이더) 정상 표시
  - [ ] 4열 비교 테이블 정상 표시
  - [ ] 구조 점수 비교 bar chart 정상 표시
- [ ] ZONE C (코치 1차 판결) 정상 표시
  - [ ] 가장 의심되는 구조 자동 선택 정상 동작
  - [ ] 판결문 정상 표시
  - [ ] CTA 버튼 정상 동작
  - [ ] 두 번째 후보 보기 expander 정상 동작
- [ ] ZONE D (전략 실행 런치패드) 정상 표시
  - [ ] 6개 실행 버튼 정상 표시
  - [ ] 각 버튼 클릭 시 페이지 이동 정상 동작

### 설계실 공통 기능
- [ ] 각 설계실 상단에 [← 가게 설계 센터로 돌아가기] 버튼 존재
- [ ] 버튼 클릭 시 가게 설계 센터로 이동 정상 동작
- [ ] 각 설계실에 "전략 브리핑 / 전략 실행" 탭 분리 완료
- [ ] 브리핑 탭: ZONE A/B/C만 표시
- [ ] 실행 탭: ZONE D만 표시
- [ ] 기존 설계 도구(Zone D) 기능 깨짐 없음

### 설계실별 확인
- [ ] 메뉴 포트폴리오 설계실: 탭 분리 + 네비게이션 버튼 정상
- [ ] 메뉴 수익 구조 설계실: 탭 분리 + 네비게이션 버튼 정상
- [ ] 재료 구조 설계실: 탭 분리 + 네비게이션 버튼 정상
- [ ] 수익 구조 설계실: 탭 분리 + 네비게이션 버튼 정상

---

## 🎯 기대 동작

### 사용자 경험
1. **통합 진단**: 4개 설계실 상태를 한눈에 파악
2. **자동 판결**: 가장 의심되는 구조 자동 선택
3. **빠른 이동**: 카드별 바로가기 버튼으로 즉시 이동
4. **탭 분리**: 브리핑과 실행을 명확히 구분

### 코드 안정성
- 기존 설계 도구 기능 그대로 유지
- 공통 컴포넌트로 네비게이션 버튼 통일
- 탭 분리로 성능 최적화 (브리핑 탭: 요약만, 실행 탭: 도구만)

---

## 📌 참고사항

### 가게 설계 센터 데이터 정책
- **데이터 소스**: 각 설계실의 coach_data / helpers 재사용
- **점수 계산**: 간단 룰 기반 (0~100점)
- **상태 판정**: 안정 (70점 이상) / 주의 (40~69점) / 위험 (40점 미만)
- **가장 의심되는 구조**: 점수가 가장 낮은 구조 우선 선택

### 탭 분리 구조
- **브리핑 탭**: ZONE A/B/C만 렌더링 (요약/차트만 로드)
- **실행 탭**: ZONE D만 렌더링 (입력 폼/테이블만 로드)
- **성능 최적화**: 탭 전환 시 중복 계산 방지

### 네비게이션 버튼
- **위치**: 각 설계실 제목 바로 아래
- **기능**: `st.session_state.current_page = "가게 설계 센터"` + `st.rerun()`
- **통일성**: 공통 컴포넌트로 일관된 UX

---

## 🚀 배포 준비

모든 수정이 완료되었습니다. 다음 단계:
1. ✅ 앱 재시작
2. ✅ "가게 설계 센터" 메뉴 클릭 → 새 페이지 진입 확인
3. ✅ 가게 설계 센터에서 4개 설계실 상태 카드 확인
4. ✅ 가장 의심되는 구조 자동 판결 확인
5. ✅ 각 설계실에서 네비게이션 버튼 및 탭 분리 확인

---

## 📊 작업 요약

| 항목 | 상태 | 비고 |
|------|------|------|
| 가게 설계 센터 페이지 생성 | ✅ 완료 | design_center.py |
| 가게 설계 센터 데이터 헬퍼 | ✅ 완료 | design_center_data.py |
| 공통 네비게이션 버튼 컴포넌트 | ✅ 완료 | design_lab_nav.py |
| 메뉴 포트폴리오 설계실 탭 분리 | ✅ 완료 | menu_management.py |
| 메뉴 수익 구조 설계실 탭 분리 | ✅ 완료 | menu_profit_design_lab.py |
| 재료 구조 설계실 탭 분리 | ✅ 완료 | ingredient_management.py |
| 수익 구조 설계실 탭 분리 | ✅ 완료 | revenue_structure_design_lab.py |
| 사이드바 라우팅 추가 | ✅ 완료 | app.py |
| app.py 라우팅 추가 | ✅ 완료 | app.py |

---

## ✅ 최종 확인

- [x] 가게 설계 센터 페이지 생성 완료
- [x] 가게 설계 센터 데이터 헬퍼 생성 완료
- [x] 공통 네비게이션 버튼 컴포넌트 생성 완료
- [x] 4개 설계실 모두 네비게이션 버튼 추가 완료
- [x] 4개 설계실 모두 탭 분리 완료
- [x] 사이드바 및 라우팅 추가 완료
- [ ] 앱 실행 및 동작 확인 (사용자 확인 필요)

**참고**: 
- 가게 설계 센터는 4개 설계실의 통합 진단 페이지입니다.
- 각 설계실은 "전략 브리핑"과 "전략 실행"으로 명확히 구분됩니다.
- 모든 설계실에서 가게 설계 센터로 쉽게 돌아갈 수 있습니다.
