# SSOT ì •ì±… ì—…ë°ì´íŠ¸ ìˆ˜ì • ì™„ë£Œ

## ğŸ“‹ ì •ì±… ì—…ë°ì´íŠ¸ ìš”ì•½

**ë³€ê²½ ì „**:
- ëª¨ë“  ê³µì‹ KPIëŠ” `v_daily_sales_official` (daily_closeë§Œ)

**ë³€ê²½ í›„**:
- **í†µê³„/ë¶„ì„/KPI**: `v_daily_sales_best_available` (daily_close ìš°ì„ , ì—†ìœ¼ë©´ sales)
- **ë§ˆê°ë¥ /ì—°ì†ë§ˆê°/ê³µì‹ í™•ì •**: `v_daily_sales_official` (daily_closeë§Œ)

---

## âœ… ìˆ˜ì • ì™„ë£Œ í•­ëª©

### 1. `load_monthly_sales_total()` í•¨ìˆ˜ ìˆ˜ì •
- **íŒŒì¼**: `src/storage_supabase.py` ë¼ì¸ 3596-3630
- **ë³€ê²½**: `sales` í…Œì´ë¸” â†’ `v_daily_sales_best_available` ë·°
- **ê¸°ëŠ¥**: ë¯¸ë§ˆê° ë‚ ì§œ ê°œìˆ˜ë„ ë¡œê¹…

### 2. `load_monthly_official_sales_total()` í•¨ìˆ˜ ì¶”ê°€
- **íŒŒì¼**: `src/storage_supabase.py` ë¼ì¸ 3536-3592
- **ìš©ë„**: ë§ˆê°ë¥ /ì—°ì†ë§ˆê° ë“± ê³µì‹ ì „ìš© ì§€í‘œìš©
- **ê¸°ëŠ¥**: `v_daily_sales_official` ë·° ì‚¬ìš©

### 3. `count_unofficial_days_in_month()` í•¨ìˆ˜ ì¶”ê°€
- **íŒŒì¼**: `src/storage_supabase.py` ë¼ì¸ 3632-3668
- **ìš©ë„**: ë¯¸ë§ˆê° ë‚ ì§œ ê°œìˆ˜ ê³„ì‚°
- **ê¸°ëŠ¥**: `v_daily_sales_best_available`ì—ì„œ `is_official=false` ê°œìˆ˜ ë°˜í™˜

### 4. ë§¤ì¶œ ê´€ë¦¬ í˜ì´ì§€ ìˆ˜ì •
- **íŒŒì¼**: `ui_pages/sales_management.py`
- **ë³€ê²½**:
  - `load_csv('sales.csv')` â†’ `load_best_available_daily_sales()`
  - ë¯¸ë§ˆê° ë°°ì§€ ì¶”ê°€ (ë¼ì¸ 150-152)
- **ì˜í–¥**: ëª¨ë“  ë§¤ì¶œ ì§‘ê³„ê°€ best_available ê¸°ë°˜

### 5. ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ ìˆ˜ì •
- **íŒŒì¼**: 
  - `ui_pages/dashboard/data_loaders.py`: `load_best_available_daily_sales()` ì‚¬ìš©
  - `ui_pages/dashboard/metrics.py`: ë¯¸ë§ˆê° ë‚ ì§œ ê°œìˆ˜ ê³„ì‚° ë° ì „ë‹¬
  - `ui_pages/dashboard/sections.py`: ë¯¸ë§ˆê° ë°°ì§€ í‘œì‹œ (ë¼ì¸ 248-251)
- **ì˜í–¥**: ëª¨ë“  ë§¤ì¶œ ì§‘ê³„ê°€ best_available ê¸°ë°˜

### 6. ì‹¤ì œì •ì‚° í˜ì´ì§€ ìˆ˜ì •
- **íŒŒì¼**: `ui_pages/settlement_actual.py`
- **ë³€ê²½**: ë¯¸ë§ˆê° ë°°ì§€ ì¶”ê°€ (ë¼ì¸ 353-355)
- **ì˜í–¥**: `load_monthly_sales_total()` ì‚¬ìš© ì¤‘ì´ë¯€ë¡œ ìë™ìœ¼ë¡œ best_available ê¸°ë°˜

---

## ğŸ“Š í˜ì´ì§€ë³„ best_available vs official ì‚¬ìš©ì²˜ ë§¤í•‘

### ë§¤ì¶œ ê´€ë¦¬ í˜ì´ì§€ (`sales_management.py`)
| ì§€í‘œ | ì‚¬ìš© ë·° | ìœ„ì¹˜ |
|------|---------|------|
| ì´ë²ˆë‹¬ ëˆ„ì  ë§¤ì¶œ | `best_available` | ë¼ì¸ 116, 157 |
| ì „ì›” ëŒ€ë¹„ ë¹„êµ | `best_available` | ë¼ì¸ 224 |
| ì‘ë…„ ë™ì›” ëŒ€ë¹„ | `best_available` | ë¼ì¸ 241 |
| ì£¼ê°„ ë¹„êµ | `best_available` | ë¼ì¸ 257 |
| ìš”ì¼ë³„ ë¶„ì„ | `best_available` | ë¼ì¸ 291-297 |
| ì›”ë³„ ìš”ì•½ | `best_available` | ë¼ì¸ 496-512 |
| íŠ¸ë Œë“œ ë¶„ì„ | `best_available` | ë¼ì¸ 388-404 |
| ìƒê´€ê³„ìˆ˜ | `best_available` | ë¼ì¸ 640-642 |

### ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ (`dashboard/`)
| ì§€í‘œ | ì‚¬ìš© ë·° | ìœ„ì¹˜ |
|------|---------|------|
| ì›”ë§¤ì¶œ ì§‘ê³„ | `best_available` | `metrics.py` ë¼ì¸ 277 |
| ì›”ë³„ ìš”ì•½ (6ê°œì›”) | `best_available` | `metrics.py` ë¼ì¸ 81 |
| ì´ë²ˆë‹¬ ìš”ì•½ | `best_available` | `sections.py` ë¼ì¸ 248, 279 |
| ì†ìµë¶„ê¸° ë§¤ì¶œ ë¹„êµ | `best_available` | `sections.py` ë¼ì¸ 58, 71 |

### ì‹¤ì œì •ì‚° í˜ì´ì§€ (`settlement_actual.py`)
| ì§€í‘œ | ì‚¬ìš© ë·° | ìœ„ì¹˜ |
|------|---------|------|
| ì´ë§¤ì¶œ ìë™ ë¶ˆëŸ¬ì˜¤ê¸° | `best_available` | ë¼ì¸ 275, 292, 330 |
| KPI ì¹´ë“œ (ì´ë§¤ì¶œ) | `best_available` | ë¼ì¸ 359 |

### í™ˆ í˜ì´ì§€ (`home/`)
| ì§€í‘œ | ì‚¬ìš© ë·° | ìœ„ì¹˜ |
|------|---------|------|
| ì–´ì œ ë§¤ì¶œ | `official` (daily_close ì§ì ‘) | `home_data.py` ë¼ì¸ 86-101 |
| ë§ˆê° í†µê³„ | `official` (daily_close ì§ì ‘) | `home_data.py` ë¼ì¸ 31-33 |
| ìµœê·¼ 7ì¼ í‰ê·  ë¹„êµ | `best_available` ê¶Œì¥ | `home_page.py` ë¼ì¸ 487-493 âš ï¸ |

**ì°¸ê³ **: í™ˆ í˜ì´ì§€ì˜ ìµœê·¼ 7ì¼ í‰ê·  ë¹„êµëŠ” ì•„ì§ `sales` ì§ì ‘ ì¡°íšŒ ì¤‘. ê¶Œì¥ ìˆ˜ì • í•„ìš”.

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ë§ˆê° ì—†ëŠ” ë‚  sales ì…ë ¥ â†’ KPI ë°˜ì˜ + ë¯¸ë§ˆê° ë°°ì§€

**ì „ì œ ì¡°ê±´**:
- 2026-01-20ì— `daily_close` ì—†ìŒ
- 2026-01-20ì— `sales` í…Œì´ë¸”ì— ë§¤ì¶œ ì…ë ¥ (ë§¤ì¶œ ë³´ì • í˜ì´ì§€)

**ì˜ˆìƒ ê²°ê³¼**:

1. **ë§¤ì¶œ ê´€ë¦¬ í˜ì´ì§€**:
   - âœ… ì´ë²ˆë‹¬ ëˆ„ì  ë§¤ì¶œì— 2026-01-20 ë§¤ì¶œ í¬í•¨
   - âœ… "âš ï¸ **ë¯¸ë§ˆê° ë°ì´í„° í¬í•¨ (1ì¼)**" ë°°ì§€ í‘œì‹œ
   - âœ… ëª¨ë“  ë¹„êµ/ë¶„ì„ì— 2026-01-20 í¬í•¨

2. **ëŒ€ì‹œë³´ë“œ í˜ì´ì§€**:
   - âœ… ì›”ë§¤ì¶œ ì§‘ê³„ì— 2026-01-20 ë§¤ì¶œ í¬í•¨
   - âœ… "âš ï¸ **ë¯¸ë§ˆê° ë°ì´í„° í¬í•¨ (1ì¼)**" ë°°ì§€ í‘œì‹œ
   - âœ… ì´ë²ˆë‹¬ ìš”ì•½ì— 2026-01-20 í¬í•¨

3. **ì‹¤ì œì •ì‚° í˜ì´ì§€**:
   - âœ… ì´ë§¤ì¶œ ìë™ ë¶ˆëŸ¬ì˜¤ê¸°ì— 2026-01-20 ë§¤ì¶œ í¬í•¨
   - âœ… "âš ï¸ **ë¯¸ë§ˆê° ë°ì´í„° í¬í•¨ (1ì¼)**" ë°°ì§€ í‘œì‹œ

4. **í™ˆ í˜ì´ì§€**:
   - âœ… ì–´ì œ ë§¤ì¶œ: `daily_close`ì—ì„œ ì¡°íšŒí•˜ë¯€ë¡œ 2026-01-20 ì œì™¸ (ì •ìƒ)
   - âœ… ë§ˆê° í†µê³„: `daily_close` ê¸°ë°˜ì´ë¯€ë¡œ 2026-01-20 ì œì™¸ (ì •ìƒ)

### ì‹œë‚˜ë¦¬ì˜¤ 2: ë§ˆê° í›„ â†’ ë¯¸ë§ˆê° ë°°ì§€ ì‚¬ë¼ì§

**ì „ì œ ì¡°ê±´**:
- 2026-01-20ì— `sales`ë§Œ ìˆìŒ (ë¯¸ë§ˆê°)
- ì´í›„ ì ì¥ ë§ˆê°ìœ¼ë¡œ `daily_close` ìƒì„±

**ì˜ˆìƒ ê²°ê³¼**:
- âœ… ë¯¸ë§ˆê° ë°°ì§€ ì‚¬ë¼ì§ (unofficial_days = 0)
- âœ… ëª¨ë“  KPIëŠ” ë™ì¼ (best_availableì´ daily_close ìš°ì„  ì‚¬ìš©)

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì—¬ëŸ¬ ë‚  ë¯¸ë§ˆê°

**ì „ì œ ì¡°ê±´**:
- 2026-01-20, 2026-01-21, 2026-01-22ì— `sales`ë§Œ ìˆìŒ

**ì˜ˆìƒ ê²°ê³¼**:
- âœ… "âš ï¸ **ë¯¸ë§ˆê° ë°ì´í„° í¬í•¨ (3ì¼)**" ë°°ì§€ í‘œì‹œ
- âœ… ëª¨ë“  KPIì— 3ì¼ ë§¤ì¶œ í¬í•¨

---

## ğŸ“ ìˆ˜ì • íŒŒì¼ ëª©ë¡

### 1. `src/storage_supabase.py`
**ë³€ê²½ ë‚´ìš©**:
- `load_monthly_sales_total()` ìˆ˜ì • (ë¼ì¸ 3596-3630)
  - `sales` í…Œì´ë¸” â†’ `v_daily_sales_best_available` ë·°
  - ë¯¸ë§ˆê° ë‚ ì§œ ê°œìˆ˜ ë¡œê¹… ì¶”ê°€
- `load_monthly_official_sales_total()` ì¶”ê°€ (ë¼ì¸ 3536-3592)
  - `v_daily_sales_official` ë·° ì‚¬ìš©
  - ë§ˆê°ë¥ /ì—°ì†ë§ˆê° ë“± ê³µì‹ ì „ìš© ì§€í‘œìš©
- `count_unofficial_days_in_month()` ì¶”ê°€ (ë¼ì¸ 3632-3668)
  - ë¯¸ë§ˆê° ë‚ ì§œ ê°œìˆ˜ ê³„ì‚° í•¨ìˆ˜

### 2. `ui_pages/sales_management.py`
**ë³€ê²½ ë‚´ìš©**:
- ë¼ì¸ 11: import ì¶”ê°€ (`load_best_available_daily_sales`, `count_unofficial_days_in_month`)
- ë¼ì¸ 52-66: `load_csv('sales.csv')` â†’ `load_best_available_daily_sales()` ì‚¬ìš©
- ë¼ì¸ 116: `load_monthly_sales_total()` ì‚¬ìš© (best_available ê¸°ë°˜)
- ë¼ì¸ 118: `count_unofficial_days_in_month()` í˜¸ì¶œ
- ë¼ì¸ 150-152: ë¯¸ë§ˆê° ë°°ì§€ í‘œì‹œ ì¶”ê°€

### 3. `ui_pages/dashboard/data_loaders.py`
**ë³€ê²½ ë‚´ìš©**:
- ë¼ì¸ 4: import ì¶”ê°€ (`load_best_available_daily_sales`)
- ë¼ì¸ 14-25: `load_csv('sales.csv')` â†’ `load_best_available_daily_sales()` ì‚¬ìš©

### 4. `ui_pages/dashboard/metrics.py`
**ë³€ê²½ ë‚´ìš©**:
- ë¼ì¸ 9: import ì¶”ê°€ (`count_unofficial_days_in_month`)
- ë¼ì¸ 34-37: `compute_merged_sales_visitors()` ë‚´ë¶€ì—ì„œ `load_best_available_daily_sales()` ì‚¬ìš©
- ë¼ì¸ 280: `count_unofficial_days_in_month()` í˜¸ì¶œ
- ë¼ì¸ 341: `unofficial_days`ë¥¼ metricsì— ì¶”ê°€

### 5. `ui_pages/dashboard/sections.py`
**ë³€ê²½ ë‚´ìš©**:
- ë¼ì¸ 252: `unofficial_days` ì¶”ì¶œ
- ë¼ì¸ 272-274: ë¯¸ë§ˆê° ë°°ì§€ í‘œì‹œ ì¶”ê°€

### 6. `ui_pages/settlement_actual.py`
**ë³€ê²½ ë‚´ìš©**:
- ë¼ì¸ 21: import ì¶”ê°€ (`count_unofficial_days_in_month`)
- ë¼ì¸ 352: `count_unofficial_days_in_month()` í˜¸ì¶œ
- ë¼ì¸ 354-356: ë¯¸ë§ˆê° ë°°ì§€ í‘œì‹œ ì¶”ê°€

---

## âš ï¸ ì¶”ê°€ ê¶Œì¥ ìˆ˜ì •

### í™ˆ í˜ì´ì§€ (`ui_pages/home/home_page.py`)
- **ìœ„ì¹˜**: ë¼ì¸ 487-493 (`_render_status_strip()`)
- **í˜„ì¬**: `sales` í…Œì´ë¸” ì§ì ‘ ì¡°íšŒ
- **ê¶Œì¥**: `load_best_available_daily_sales()` ì‚¬ìš©
- **ìš°ì„ ìˆœìœ„**: ì¤‘ê°„ (í™ˆ í˜ì´ì§€ëŠ” ì°¸ê³ ìš©)

---

## âœ… ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `load_monthly_sales_total()`ê°€ `v_daily_sales_best_available` ì‚¬ìš©
- [ ] `load_monthly_official_sales_total()`ê°€ `v_daily_sales_official` ì‚¬ìš©
- [ ] ë§¤ì¶œ ê´€ë¦¬ í˜ì´ì§€ì— ë¯¸ë§ˆê° ë°°ì§€ í‘œì‹œ
- [ ] ëŒ€ì‹œë³´ë“œ í˜ì´ì§€ì— ë¯¸ë§ˆê° ë°°ì§€ í‘œì‹œ
- [ ] ì‹¤ì œì •ì‚° í˜ì´ì§€ì— ë¯¸ë§ˆê° ë°°ì§€ í‘œì‹œ
- [ ] ë§ˆê° ì—†ëŠ” ë‚  sales ì…ë ¥ ì‹œ KPIì— ë°˜ì˜
- [ ] ë§ˆê° í›„ ë¯¸ë§ˆê° ë°°ì§€ ì‚¬ë¼ì§

---

## ğŸ¯ ê¸°ëŒ€ ë™ì‘

### í†µê³„/ë¶„ì„/KPI
- âœ… `sales`ë§Œ ìˆëŠ” ë‚ ì§œë„ í¬í•¨
- âœ… `is_official=false`ë¡œ í‘œì‹œ
- âœ… ë¯¸ë§ˆê° ë°°ì§€ë¡œ ëª…í™•íˆ êµ¬ë¶„

### ë§ˆê°ë¥ /ì—°ì†ë§ˆê°
- âœ… `daily_close`ë§Œ ì¹´ìš´íŠ¸
- âœ… `sales`ë§Œ ìˆëŠ” ë‚ ì§œëŠ” ì œì™¸
- âœ… ê³µì‹ ìš´ì˜ ë£¨í‹´ ì§€í‘œë¡œ ì‚¬ìš©
