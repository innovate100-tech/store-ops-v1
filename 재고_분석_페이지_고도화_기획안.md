# 재고 분석 페이지 고도화 기획안

**작성 일자**: 2026-01-24  
**목적**: 재고 관리 강화 및 재고 최적화를 위한 실용적 인사이트 제공

---

## 📋 개요

현재 재고 분석 페이지는 **발주 필요량 분석**, **재고 현황 분석**, **발주 내보내기** 수준입니다.

**중요 제약사항**:  
- **발주 데이터 없음**: 발주 이력, 발주 빈도, 발주량 트렌드 분석 불가
- **입고 데이터 없음**: 입고 시점, 입고량 추적 불가
- **사용 가능한 데이터**: 사용 재료(사용량), 안전재고, 현재고
- **인벤토리 방식**: 불규칙적으로 인벤토리를 수행하여 안전재고 대비 현재고 차이 파악

이 기획안은  
1) **안전재고 vs 현재고 차이 분석**을 강화하고,  
2) **재고 회전율·재고 가치 분석**을 제공하며,  
3) **사용량 기반 재고 예측** 및 **안전재고 조정 시뮬레이션**을 통해 **실행 가능한 인사이트**를 제공하도록  
**재고 분석** 페이지를 고도화하는 내용을 담습니다.

---

## 1. 현재 이슈 정리

### 1.1 기능적 한계

- **안전재고 vs 현재고 차이**: 기본적인 차이만 표시, 시점별 변화 추이 없음.
- **재고 회전율**: TOP 10만 표시, 전체 재고 회전율 통계 없음.
- **재고 가치 분석**: 재고 금액, 재고 가치 변화 추이 없음.
- **재고 예측**: 단순 평균 사용량 기반, 계절성·트렌드 반영 없음.
- **재고 최적화**: 안전재고 조정 시나리오 시뮬레이션 없음.
- **인벤토리 시점 비교**: 불규칙적 인벤토리 데이터를 활용한 시점별 비교 없음.
- **내보내기 기능**: 발주 필요량만 내보내기, 안전재고 대비 차이 내보내기 없음.

### 1.2 데이터 제약사항

- **발주 데이터 없음**: 발주 이력, 발주 빈도, 발주량 분석 불가
- **입고 데이터 없음**: 입고 시점, 입고량 추적 불가
- **인벤토리 데이터**: 불규칙적으로 입력되는 현재고 데이터만 존재

---

## 2. 핵심 개선 사항

### 2.1 안전재고 vs 현재고 차이 분석 강화 (신규)

**목적**: 안전재고 대비 현재고 차이를 상세히 파악하여 품절/과다재고 위험 식별.

#### A. 안전재고 대비 차이 상세 분석

- **부족량**: 안전재고 - 현재고 (양수면 부족, 음수면 과다)
- **부족 비율**: (부족량 / 안전재고) × 100
- **예상 소진일**: 현재고 / 일평균 사용량 (사용량 데이터 있을 때)
- **품절 위험도**: 부족 비율 기반 등급 (긴급/주의/정상)

**UI 형태**:
- 안전재고 vs 현재고 비교 테이블 (부족량, 부족 비율, 예상 소진일, 위험도)
- 부족량 TOP 10, 과다재고 TOP 10
- 차트: 부족량/과다재고 바 차트

#### B. 인벤토리 시점별 비교 (신규)

- **인벤토리 이력**: 불규칙적으로 입력된 현재고 데이터를 시점별로 비교
- **재고 변화 추이**: 최근 인벤토리 시점별 현재고 변화
- **안전재고 대비 변화**: 각 인벤토리 시점의 안전재고 대비 차이 변화

**인사이트**:
- "배추 현재고가 최근 인벤토리에서 안전재고 대비 -30% 감소했습니다."
- "최근 3회 인벤토리에서 배추 재고가 지속적으로 감소하고 있습니다."

**구현 방법**:
- `inventory` 테이블의 `updated_at`을 활용하여 인벤토리 시점 추정
- 또는 별도 인벤토리 이력 테이블이 있으면 활용

### 2.2 재고 회전율·가치 분석 강화 (신규)

**목적**: 재고 효율성과 재고 가치를 종합적으로 파악.

#### A. 재고 회전율 상세 분석

- **전체 평균 재고 회전율**: 전체 재고의 평균 회전율 (사용량 기반)
- **재고 회전율 구간별 분포**: 높음(>1.0), 보통(0.5-1.0), 낮음(<0.5)
- **재고 회전율 TOP/BOTTOM 10**: 회전율이 높은/낮은 재료
- **재고 회전율 vs 사용량 상관**: 회전율이 낮은데 사용량이 많은 재료 식별

**인사이트**:
- "재고 회전율이 낮은 재료 5개가 전체 재고 가치의 30%를 차지합니다."
- "배추는 사용량이 많지만 재고 회전율이 낮아 과다재고 가능성이 있습니다."

#### B. 재고 가치 분석

- **총 재고 가치**: 재료별 현재고 × 단가 = 재고 가치 합계
- **재고 가치 TOP 10**: 재고 가치가 높은 재료
- **재고 가치 구간별 분포**: 고가치(100만원 이상), 중가치(50-100만원), 저가치(50만원 미만)
- **재고 가치 변화 추이**: 인벤토리 시점별 총 재고 가치 변화 (가능한 경우)

**인사이트**:
- "총 재고 가치가 최근 인벤토리에서 전월 대비 +10% 증가했습니다. 과다재고를 점검하세요."
- "재고 가치 TOP 5 재료가 전체 재고 가치의 60%를 차지합니다."

### 2.3 재고 예측 강화 (신규)

**목적**: 단순 평균 사용량을 넘어 계절성·트렌드를 반영한 재고 예측.

#### A. 계절성 반영 예측

- **요일별 사용량 패턴**: 요일별 평균 사용량 (주말 vs 평일)
- **월별 사용량 패턴**: 월별 평균 사용량 (계절성 반영)
- **예측 기간별 조정**: 단기(3일), 중기(7일), 장기(14일) 예측

**인사이트**:
- "배추는 주말 사용량이 평일 대비 +30% 높습니다. 주말 전 발주량을 늘리세요."
- "12월 배추 사용량이 평균 대비 +20% 증가합니다. 안전재고를 조정하세요."

#### B. 트렌드 기반 예측

- **사용량 증가/감소 트렌드**: 최근 3개월 사용량 추세 (증가/감소/유지)
- **트렌드 반영 예측**: 단순 평균이 아닌 트렌드 기반 예측
- **예상 소진일**: 현재고 / (일평균 사용량 × 트렌드 조정) = 예상 소진일

**인사이트**:
- "배추 사용량이 최근 3개월간 +5% 증가 추세입니다. 예상소요량을 +5% 조정하세요."
- "배추 현재고로 약 5일간 사용 가능합니다. (일평균 사용량 기준)"

### 2.4 재고 최적화 시뮬레이션 (신규)

**목적**: 안전재고 조정 시나리오별 재고 효율성 변화 예측.

#### A. 안전재고 조정 시뮬레이션

- **안전재고 변경**: ±10%, ±20% 또는 직접 입력
- **재고 효율성 변화**: 재고 회전율, 재고 가치, 품절 위험도 변화
- **트레이드오프 분석**: 안전재고 증가 → 재고 가치 증가, 품절 위험 감소

**예시**:
- "배추 안전재고를 10% 증가 → 재고 가치 +5만원, 품절 위험 -30%"
- "안전재고를 20% 감소 → 재고 가치 -10만원, 품절 위험 +50%"

#### B. 목표 재고 회전율 달성 시뮬레이션

- **목표 재고 회전율 입력**: 예) 1.0 (월 1회 회전)
- **필요 조정량 계산**: 현재 회전율에서 목표까지 필요한 안전재고 조정
- **우선순위 제안**: 조정 효과가 큰 재료 우선 제안

**예시**:
- "배추 재고 회전율을 0.5 → 1.0으로 높이려면 → 안전재고 30% 감소 필요"

### 2.5 재고 트렌드 분석 (신규)

**목적**: 재고 변화 추이를 파악하여 선제적 재고 관리.

#### A. 인벤토리 시점별 재고 변화

- **인벤토리 시점별 현재고**: 최근 인벤토리 시점별 현재고 변화
- **안전재고 대비 변화**: 각 인벤토리 시점의 안전재고 대비 차이 변화
- **재고 가치 변화**: 인벤토리 시점별 총 재고 가치 변화

**차트**:
- 라인 차트: 인벤토리 시점별 현재고, 안전재고 대비 차이
- 바 차트: 재고 가치 변화 TOP 10 재료 (증가/감소)

#### B. 사용량 트렌드

- **월별 사용량 추이**: 재료별 월별 사용량 변화
- **사용량 증가/감소 재료**: 전월 대비 사용량 변화가 큰 재료
- **사용량 vs 재고 상관**: 사용량 증가/감소와 재고 변화의 상관관계

**인사이트**:
- "배추 사용량이 최근 3개월간 +10% 증가했지만 재고는 -5% 감소했습니다. 안전재고를 늘리세요."

### 2.6 목표 vs 실제 비교 (신규)

**목적**: 목표 재고 회전율 대비 실제 재고 회전율을 비교하여 개선 필요 재료 식별.

#### A. 목표 재고 회전율 설정

- **재료별 목표 재고 회전율 입력**: 기본값 1.0 (월 1회 회전) 또는 재료별 개별 설정
- **카테고리별 목표 재고 회전율**: 카테고리별 기본 목표 재고 회전율 설정

#### B. 목표 vs 실제 비교

- **재료별 비교**: 목표 재고 회전율 vs 실제 재고 회전율, 차이
- **목표 미달 재료**: 실제 재고 회전율이 목표보다 낮은 재료 목록
- **목표 달성률**: 목표 재고 회전율 달성 재료 수 / 전체 재료 수

**인사이트**:
- "전체 재료 중 60%가 목표 재고 회전율을 달성했습니다."
- "배추 재고 회전율이 목표 1.0 대비 -0.5 미달했습니다. 안전재고 조정이 필요합니다."

### 2.7 재고 최적화 액션 제안 (신규)

**목적**: 재고 최적화를 위한 구체적이고 실행 가능한 액션 아이템 제안.

#### A. 자동 진단

- **과다재고 재료**: 재고 회전율이 낮고 재고 가치가 높은 재료
- **품절 위험 재료**: 현재고가 안전재고의 50% 미만인 재료
- **재고 가치 집중 재료**: 재고 가치가 높은 재료 중 회전율이 낮은 재료

#### B. 우선순위별 액션 제안

1. **안전재고 조정**: 과다재고 재료의 안전재고 감소 또는 품절 위험 재료의 안전재고 증가
2. **재고 회전율 개선**: 목표 재고 회전율 미달 재료의 안전재고 조정
3. **인벤토리 빈도 조정**: 품절 위험 재료의 인벤토리 빈도 증가 제안

**인사이트**:
- "배추 재고 회전율 0.5 → 안전재고 20% 감소 → 목표 1.0 달성 가능"
- "과다재고 재료 5개가 전체 재고 가치의 40%를 차지합니다. 이 재료들의 재고 최적화가 우선순위입니다."

### 2.8 내보내기 기능 강화 (신규)

**목적**: 안전재고 대비 현재고 차이를 포함한 다양한 형식의 내보내기 제공.

#### A. 안전재고 대비 차이 내보내기

- **CSV 형식**: 재료명, 현재고, 안전재고, 부족량, 부족 비율, 예상 소진일, 위험도
- **Excel 형식**: 위 내용 + 차트 포함 (선택)
- **인벤토리 체크리스트**: 인벤토리 시 사용할 체크리스트 형식

#### B. 재고 현황 종합 내보내기

- **재고 현황표**: 재료명, 현재고, 안전재고, 재고 가치, 재고 회전율, 상태
- **품절 위험 재료 목록**: 품절 위험 재료만 필터링하여 내보내기
- **과다재고 재료 목록**: 과다재고 재료만 필터링하여 내보내기

---

## 3. 새로운 페이지 구조 (ZONE 구분)

### 3.1 ZONE A: 핵심 지표 (기존 강화)

- **발주 필요 개수**, **긴급 발주 개수**, **주의 재고 개수**, **정상 재고 개수** (기존 유지)
- **총 재고 가치**, **평균 재고 회전율** (신규)
- **품절 위험 재료 수**, **과다재고 재료 수** (신규)

### 3.2 ZONE B: 안전재고 vs 현재고 차이 분석 (기존 강화)

- **안전재고 vs 현재고 비교 테이블** (부족량, 부족 비율, 예상 소진일, 위험도, 신규)
- **발주 필요량 테이블** (기존 유지)
- **부족량 TOP 10**, **과다재고 TOP 10** (신규)
- **인벤토리 시점별 비교** (최근 인벤토리 시점별 현재고 변화, 신규)

### 3.3 ZONE C: 재고 회전율·가치 분석 (신규)

- **재고 회전율 상세**: 전체 평균, 구간별 분포, TOP/BOTTOM 10
- **재고 가치 분석**: 총 재고 가치, TOP 10, 구간별 분포
- **재고 회전율 vs 재고 가치 매트릭스**: 4분면 분석

### 3.4 ZONE D: 재고 예측 강화 (신규)

- **계절성 반영 예측**: 요일별/월별 사용량 패턴, 예측 기간별 조정
- **트렌드 기반 예측**: 사용량 증가/감소 트렌드, 트렌드 반영 예측, 예상 소진일

### 3.5 ZONE E: 재고 최적화 시뮬레이션 (신규)

- **안전재고 조정 시뮬레이션**: 안전재고 변경, 재고 효율성 변화, 트레이드오프 분석
- **목표 재고 회전율 달성 시뮬레이션**: 목표 입력, 필요 조정량 계산

### 3.6 ZONE F: 재고 트렌드 (신규)

- **인벤토리 시점별 재고 변화**: 인벤토리 시점별 현재고, 안전재고 대비 차이, 재고 가치 변화
- **사용량 트렌드**: 월별 사용량 추이, 사용량 증가/감소 재료, 사용량 vs 재고 상관

### 3.7 ZONE G: 목표 vs 실제 (신규)

- **목표 재고 회전율 설정**: 재료별 또는 카테고리별 목표 재고 회전율 입력
- **목표 vs 실제 비교**: 재료별 목표 vs 실제, 목표 미달 재료, 목표 달성률

### 3.8 ZONE H: 재고 최적화 액션 (신규)

- **자동 진단**: 과다재고 재료, 품절 위험 재료, 재고 가치 집중 재료
- **우선순위별 액션 제안**: 안전재고 조정, 재고 회전율 개선, 인벤토리 빈도 조정

### 3.9 ZONE I: 재고 현황 분석 (기존 유지)

- **재고 상태 분포** (기존 유지)
- **재고 회전율 TOP 10** (기존 유지)
- **과다재고 경고** (기존 유지)

### 3.10 ZONE J: 내보내기 & 액션 (기존 강화)

- **안전재고 대비 차이 내보내기** (CSV, Excel, 인벤토리 체크리스트, 신규)
- **재고 현황 종합 내보내기** (재고 현황표, 품절 위험 목록, 과다재고 목록, 신규)
- **연계 페이지 이동** (기존 유지)

---

## 4. 데이터 함수 정리 및 증명

### 4.1 안전재고 vs 현재고 차이 계산 (신규)

```text
_calculate_safety_stock_gap(inventory_df, usage_df=None) → DataFrame
```

- **입력**: 재고 DataFrame, (선택) 사용량 DataFrame
- **로직**: 
  - 부족량 = 안전재고 - 현재고 (양수면 부족, 음수면 과다)
  - 부족 비율 = (부족량 / 안전재고) × 100
  - 예상 소진일 = 현재고 / 일평균 사용량 (사용량 있을 때)
  - 위험도 = 부족 비율 기반 등급 (긴급/주의/정상)
- **출력**: 재료명, 현재고, 안전재고, 부족량, 부족비율(%), 예상소진일, 위험도

### 4.2 재고 회전율 계산 (신규)

```text
_calculate_inventory_turnover(inventory_df, usage_df, period_days=30) → DataFrame
```

- **입력**: 재고 DataFrame, 사용량 DataFrame, 기간(일)
- **로직**: 기간 내 사용량 / 평균 재고 = 재고 회전율
  - 평균 재고 = 현재고 (단순화, 재고 이력 없으므로)
  - 재고 회전율 = 기간 내 총 사용량 / 현재고
- **출력**: 재료명, 현재고, 총사용량, 재고회전율

**증명**:
- 재고 회전율 = 기간 내 사용량 / 평균 재고 (표준 정의)
- 재고 이력이 없으므로 현재고를 평균 재고로 사용 (단순화)

### 4.3 재고 가치 계산 (신규)

```text
_calculate_inventory_value(inventory_df, ingredient_df) → DataFrame
```

- **입력**: 재고 DataFrame, 재료 마스터 DataFrame
- **로직**: 재료별 현재고 × 단가 = 재고 가치
- **출력**: 재료명, 현재고, 단가, 재고가치

### 4.4 인벤토리 시점별 비교 (신규)

```text
_compare_inventory_snapshots(inventory_df, months=3) → DataFrame
```

- **입력**: 재고 DataFrame (updated_at 포함), 기간(월)
- **로직**: 
  - `inventory` 테이블의 `updated_at`을 활용하여 인벤토리 시점 추정
  - 각 시점별 현재고, 안전재고 대비 차이 계산
  - 시점별 재고 가치 계산
- **출력**: 인벤토리시점, 재료명, 현재고, 안전재고, 부족량, 재고가치

**증명**:
- `inventory` 테이블의 `updated_at`이 인벤토리 시점을 나타낸다고 가정
- `updated_at`이 없거나 부정확하면 현재 시점만 사용 (트렌드 분석 불가)

### 4.5 재고 예측 강화 (신규)

```text
_predict_inventory_usage(usage_df, days_for_avg=7, forecast_days=3, 
                        consider_trend=True, consider_seasonality=False) → DataFrame
```

- **입력**: 사용량 DataFrame, 평균 계산 기간, 예측 일수, 트렌드 반영 여부, 계절성 반영 여부
- **로직**:
  - 기본: 최근 N일 평균 사용량 × 예측 일수
  - 트렌드 반영: 최근 3개월 사용량 추세(증가/감소) 반영
  - 계절성 반영: 요일별/월별 패턴 반영
- **출력**: 재료명, 예상소요량, 예상소진일, 예측신뢰도(%)

### 4.6 재고 시뮬레이션 (신규)

```text
_simulate_safety_stock_change(ingredient_name, safety_stock_change_pct, 
                             inventory_df, usage_df, ingredient_df) → dict
```

- **입력**: 재료명, 변경율(%), 재고, 사용량, 재료 마스터
- **로직**: 변경 후 안전재고로 재고 회전율, 재고 가치, 품절 위험도 재계산
- **출력**: 변경 전/후 재고 회전율, 재고 가치, 품절 위험도, 변화량

### 4.7 재고 트렌드 계산 (신규)

```text
_calculate_inventory_trend(inventory_df, usage_df, months=6) → DataFrame
```

- **입력**: 재고 DataFrame (updated_at 포함), 사용량 DataFrame, 기간(월)
- **로직**: 
  - 인벤토리 시점별 총 재고 가치, 평균 재고 회전율 계산
  - 전월 대비 변화율 계산 (인벤토리 시점이 월별로 있을 때)
- **출력**: 인벤토리시점, 총재고가치, 평균재고회전율, 재고가치변화율(%), 회전율변화율(%)

**증명**:
- 인벤토리 이력이 없으면 현재 재고만 사용 (트렌드 분석 불가)
- 인벤토리 이력이 있으면 `updated_at` 기반으로 시점별 재고 스냅샷으로 트렌드 계산

---

## 5. UI/UX 요약

- **재료 선택**: 드롭다운 또는 테이블 클릭으로 재료별 상세 분석
- **기간 선택**: 재고 트렌드, 사용량 트렌드 분석 시 최근 3/6개월 선택
- **시뮬레이션**: 안전재고 변경 슬라이더 또는 입력 필드, 실시간 계산
- **차트**: 바 차트(부족량, 재고 회전율, 재고 가치), 파이 차트(재고 상태 분포), 라인 차트(인벤토리 시점별 재고 변화, 사용량 트렌드)
- **내보내기**: 안전재고 대비 차이, 재고 현황 종합, 품절 위험 목록, 과다재고 목록 (CSV, Excel)
- **데이터 미입력 시**: 해당 ZONE 안내 문구 + 재고/재료 입력 페이지로 이동 버튼

---

## 6. 구현 순서 제안

| 단계 | 작업 | 비고 |
|------|------|------|
| 1 | **안전재고 vs 현재고 차이** | `_calculate_safety_stock_gap` 구현, ZONE B 강화 |
| 2 | **재고 회전율·가치 계산** | `_calculate_inventory_turnover`, `_calculate_inventory_value` 구현, ZONE C |
| 3 | **인벤토리 시점별 비교** | `_compare_inventory_snapshots` 구현, ZONE B/F |
| 4 | **재고 예측 강화** | `_predict_inventory_usage` 구현, ZONE D |
| 5 | **재고 시뮬레이션** | `_simulate_safety_stock_change` 구현, ZONE E |
| 6 | **재고 트렌드** | `_calculate_inventory_trend`, 인벤토리 시점별 재고 변화, ZONE F |
| 7 | **목표 vs 실제** | 목표 재고 회전율 설정 및 비교, ZONE G |
| 8 | **액션 제안** | 자동 진단 및 우선순위별 액션, ZONE H |
| 9 | **내보내기 강화** | 안전재고 대비 차이, 재고 현황 종합 내보내기, ZONE J |
| 10 | **ZONE A 강화** | 핵심 지표 추가 (총 재고 가치, 평균 재고 회전율, 품절 위험/과다재고 수) |

---

## 7. 기대 효과

- **안전재고 vs 현재고 명확화**: 부족량, 부족 비율, 예상 소진일로 품절/과다재고 위험 명확화.  
- **재고 효율성 파악**: 재고 회전율·재고 가치 분석으로 재고 효율성 명확화.  
- **예측 정확도 향상**: 계절성·트렌드 반영 예측으로 품절/과다재고 방지.  
- **시뮬레이션 기반 의사결정**: 안전재고 조정 시나리오로 재고 최적화 효과 예측.  
- **인벤토리 데이터 활용**: 불규칙적 인벤토리 데이터를 활용한 시점별 비교로 재고 변화 추이 파악.  
- **내보내기 기능 강화**: 안전재고 대비 차이를 포함한 다양한 형식의 내보내기로 실무 활용도 향상.

---

## 8. 정리

### 핵심 원칙

1. **재고 SSOT**: 재고 정보는 **inventory.csv** (현재고, 안전재고)로만 계산.  
2. **사용량 기반 분석**: 실제 사용량 데이터를 반영한 재고 회전율·예측 분석.  
3. **인벤토리 데이터 활용**: 불규칙적 인벤토리 데이터(`updated_at`)를 활용한 시점별 비교.  
4. **시뮬레이션 기반 의사결정**: 안전재고 조정 시나리오로 재고 최적화 효과 예측.  
5. **내보내기 우선**: 안전재고 대비 차이를 포함한 실용적인 내보내기 기능 제공.

### 제약사항 및 대응

- **발주 데이터 없음**: 발주 패턴 분석 제외, 사용량 기반 예측에 집중
- **입고 데이터 없음**: 입고 시점 추적 불가, 인벤토리 시점(`updated_at`) 활용
- **불규칙적 인벤토리**: 인벤토리 시점별 비교로 재고 변화 추이 파악

### 다음 단계

1. 기획안 검토 및 확정  
2. `_calculate_safety_stock_gap`, `_calculate_inventory_turnover` 등 **데이터 함수** 구현 및 단위 검증  
3. ZONE A → B → C → D → E → F → G → H → J 순으로 UI 적용  
4. 인벤토리 데이터 미입력 등 **엣지 케이스** 확인  
5. 재고 시뮬레이션 **정확도** 검증  
6. **내보내기 기능** 테스트 및 검증

---

**작성일**: 2026-01-24  
**참고**:  
- `ui_pages/analysis/inventory_analysis.py` (현재)  
- `src/analytics.py` (`calculate_order_recommendation`, `calculate_inventory_turnover`)  
- `매출_분석_페이지_고도화_기획안.md` (ZONE 구조)  
- `원가_분석_페이지_고도화_기획안.md` (시뮬레이션, 트렌드 분석)
