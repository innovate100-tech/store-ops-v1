# Phase 8-B Step 0: 홈 구조 분석

## 현재 홈 구조 (home.py)

### 전체 흐름
1. `render_home()` - 메인 함수
2. `render_day0_home()` - 데이터 0단계 전용 화면
3. 데이터 단계 판별 (`detect_data_level()`)
4. DAY 단계 판별 (`detect_owner_day_level()`)
5. 자동 코치 모드 확인 (`is_auto_coach_mode()`)

---

## 섹션 분류

### 1. Coach Only Sections (코치 모드 전용)

#### A. 성장 단계 메시지
- **위치**: 홈 최상단 (DAY0 아닌 경우)
- **내용**: DAY1/DAY3/DAY7 단계별 안내 메시지
- **코드**: `render_home()` 내부, `day_level` 기반
- **특징**: "기록 습관", "가게가 숫자로 보이기 시작", "매장 코치 모드" 등 안내성 문구

#### B. 자동 코치 모드 환영 메시지
- **위치**: 성장 단계 메시지 다음
- **내용**: "🎉 자동 코치 모드가 활성화되었습니다"
- **코드**: `is_coach_mode` 체크 후 최초 1회만 표시
- **특징**: 세션 상태로 중복 방지

#### C. 코치 요약 문장
- **위치**: 자동 코치 모드 환영 메시지 다음
- **내용**: "📋 이번 달 우리 가게 코치 요약"
- **코드**: `get_coach_summary()` 호출
- **특징**: 자동 코치 모드일 때만 표시 (`is_coach_mode` 체크)

#### D. 시작 미션 3개
- **위치**: 상태판 다음
- **내용**: 
  - 미션 1: 메뉴 3개 등록
  - 미션 2: 점장마감 3회
  - 미션 3: 이번 달 성적표 1회
- **코드**: `get_menu_count()`, `get_close_count()`, `check_actual_settlement_exists()` 사용
- **특징**: 진행률 바, 완료 보상 문장, 추천 다음 행동 포함

#### E. 오늘 하나만 (추천 액션)
- **위치**: 핵심 숫자 카드 다음
- **내용**: "🎯 오늘 코치의 한 가지 제안" (코치 모드) 또는 "🎯 오늘 하나만"
- **코드**: `get_today_one_action_with_day_context()` 호출
- **특징**: 코치 모드일 때 제목 변경, DAY 단계별 톤 튜닝

#### F. 문제 TOP3 / 잘한 점 TOP3
- **위치**: 오늘 하나만 다음
- **내용**: 
  - 문제 TOP3: `get_problems_top3()`
  - 잘한 점 TOP3: `get_good_points_top3()`
- **코드**: 룰 기반 분석, 자동 코치 모드일 때 행동 연결 문장 추가
- **특징**: 코치 모드일 때 가이드 텍스트 추가

#### G. 이상 징후
- **위치**: 문제/잘한 점 다음
- **내용**: "⚠️ 이상 징후" (최대 3개)
- **코드**: `get_anomaly_signals()` 호출
- **특징**: 자동 코치 모드일 때 행동 연결 문장 추가

#### H. 이번 달 가게 상태 한 줄 요약
- **위치**: 미니 차트 다음
- **내용**: "📌 이번 달 가게 상태 한 줄"
- **코드**: `get_month_status_summary()` 호출
- **특징**: 자동 코치 모드일 때만 표시 (`is_coach_mode` 체크)

---

### 2. Common Sections (공통 섹션)

#### A. 상태판
- **위치**: 코치 요약 다음
- **내용**: 
  - 이번 달 매출
  - 마감률/스트릭
- **코드**: `load_monthly_sales_total()`, `get_monthly_close_stats()`
- **특징**: Fast 모드에서도 필수 표시

#### B. 핵심 숫자 카드
- **위치**: 미션 다음
- **내용**: 
  - 오늘 매출
  - 이번 달 매출
  - 객단가
  - 이번 달 이익
- **코드**: 데이터 단계별 표시 여부 결정
- **특징**: Fast 모드 핵심 구성 요소

#### C. 우리 가게 숫자 구조
- **위치**: 미니 차트 다음
- **내용**: 
  - 고정비/변동비율/손익분기점
  - 매출 구간별 예상 이익
- **코드**: `get_store_financial_structure()` 호출
- **특징**: Fast 모드에서도 표시 (숫자 중심)

#### D. 이번 달 운영 메모
- **위치**: 숫자 구조 다음
- **내용**: 최신 5개 메모
- **코드**: `get_monthly_memos()` 호출
- **특징**: Fast 모드에서도 표시 (간단히)

---

### 3. Candidate Fast Sections (Fast 모드 최소화 대상)

#### A. 미니 차트
- **위치**: 이상 징후 다음
- **내용**: "📈 미니 차트" (현재는 플레이스홀더)
- **코드**: 데이터 단계별 메시지만 표시
- **특징**: Fast 모드에서 제외 가능

#### B. 장문 설명
- **위치**: 각 섹션 내부
- **내용**: 
  - 성장 단계 메시지의 장문 설명
  - 코치 요약의 상세 설명
  - 미션의 보상 문장
- **특징**: Fast 모드에서 최소화 또는 제거

#### C. 코치 메시지 블록
- **위치**: 문제/잘한 점/이상 징후 내부
- **내용**: "이 문제는 보통 요일/메뉴/객단가 흐름에서 원인이 보입니다" 등
- **특징**: Fast 모드에서 제거

---

## Fast Home 구성 목표

### 포함할 섹션 (30초 요약 화면)
1. **오늘 매출** - 핵심 숫자 카드에서
2. **이번 달 매출** - 핵심 숫자 카드에서
3. **객단가** - 핵심 숫자 카드에서
4. **이번 달 이익** - 핵심 숫자 카드에서 (가능하면)
5. **이번 달 마감률** - 상태판에서

### 바로가기 버튼 3개
1. 점장마감
2. 매출관리 (또는 대시보드)
3. 실제정산 (또는 판매관리)

### 오늘 할 일 1줄
- "오늘 마감 입력 안 됨"
- "이번 달 목표 없음"
- "이번 달 정산 미완"

### 제외할 섹션
- 미션 UI
- 성장 단계 문구
- 장문 설명
- 코치 메시지 블록
- 문제/잘한 점/이상 징후 (또는 최소화)
- 미니 차트

---

## 다음 단계

Step 1: 모드 선택 화면 구현
- 최초 로그인 시 1회 노출
- user_profiles.onboarding_mode 저장/불러오기
