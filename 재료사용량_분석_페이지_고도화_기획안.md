# 재료사용량 분석 페이지 고도화 기획안

**작성 일자**: 2026-01-24  
**목적**: 재료 사용량 분석 강화 및 사용량 최적화를 위한 실용적 인사이트 제공

---

## 📋 개요

현재 재료 사용량 집계 페이지는 **기간별 재료 사용량·사용단가 집계**, **TOP 10 재료**, **ABC 분석** 수준입니다.

이 기획안은  
1) **재료 사용량 트렌드 분석** (일별/요일별/월별, 변화율)을 강화하고,  
2) **메뉴별 재료 사용량 기여도** 및 **재료 효율성 분석**을 제공하며,  
3) **재료 사용량 예측** 및 **재고 연계 분석**을 통해 **실행 가능한 인사이트**를 제공하도록  
**재료 사용량 분석** 페이지를 고도화하는 내용을 담습니다.

---

## 1. 현재 이슈 정리

### 1.1 기능적 한계

- **사용량 트렌드**: 일별/요일별/월별 사용량 패턴 분석 없음.
- **사용량 변화율**: 전월 대비, 전년 동기 대비 변화율 분석 없음.
- **메뉴별 기여도**: 어떤 메뉴가 특정 재료를 많이 사용하는지 분석 없음.
- **재료 효율성**: 재료 사용량 대비 매출 기여도, 사용량 효율성 분석 없음.
- **사용량 예측**: 향후 사용량 예측 및 계절성 반영 없음.
- **재고 연계**: 사용량 vs 재고 상관, 사용량 기반 재고 최적화 제안 없음.
- **액션 제안**: 재료 사용량 최적화를 위한 구체적 액션 아이템 부족.
- **내보내기 기능**: 기본적인 데이터만 내보내기, 트렌드·예측 데이터 내보내기 없음.

---

## 2. 핵심 개선 사항

### 2.1 재료 사용량 트렌드 분석 강화 (신규)

**목적**: 재료 사용량의 시간적 패턴을 파악하여 선제적 재고 관리 및 발주 계획 수립.

#### A. 일별 사용량 트렌드

- **일별 사용량 추이**: 최근 30일, 60일, 90일 일별 사용량 변화
- **사용량 급증/급감 일자**: 전일 대비 사용량 ±50% 이상 변화한 일자
- **평균 일일 사용량**: 기간별 평균 일일 사용량 및 표준편차

**차트**:
- 라인 차트: 일별 사용량 추이
- 바 차트: 사용량 급증/급감 일자

**인사이트**:
- "배추 사용량이 최근 3일간 평균 대비 +30% 증가했습니다."
- "지난주 대비 이번 주 배추 사용량이 -20% 감소했습니다."

#### B. 요일별 사용량 패턴

- **요일별 평균 사용량**: 월요일~일요일 평균 사용량
- **주말 vs 평일 비교**: 주말(토/일) 평균 vs 평일(월~금) 평균
- **요일별 사용량 비율**: 요일별 사용량이 전체의 몇 %인지

**인사이트**:
- "배추는 주말 사용량이 평일 대비 +40% 높습니다."
- "금요일 배추 사용량이 가장 높습니다. 금요일 전 발주량을 늘리세요."

#### C. 월별 사용량 트렌드

- **월별 사용량 추이**: 최근 6개월, 12개월 월별 사용량 변화
- **전월 대비 변화율**: 전월 대비 사용량 증가/감소율
- **전년 동기 대비 변화율**: 전년 동월 대비 사용량 변화율 (계절성 파악)
- **사용량 증가/감소 재료**: 전월 대비 변화율이 큰 재료 TOP 10

**인사이트**:
- "배추 사용량이 전월 대비 +15% 증가했습니다."
- "12월 배추 사용량이 전년 동기 대비 +25% 증가합니다. (계절성 반영)"

### 2.2 메뉴별 재료 사용량 기여도 분석 (신규)

**목적**: 어떤 메뉴가 특정 재료를 많이 사용하는지 파악하여 메뉴별 원가 관리 및 재료 최적화.

#### A. 재료별 메뉴 기여도

- **재료 선택**: 드롭다운으로 재료 선택
- **메뉴별 사용량 기여도**: 선택한 재료를 사용하는 메뉴별 사용량·비율
- **메뉴별 사용량 순위**: 해당 재료 사용량이 많은 메뉴 TOP 10
- **메뉴별 매출 기여도**: 메뉴별 매출과 재료 사용량의 상관관계

**인사이트**:
- "배추는 김치찌개(60%), 된장찌개(30%), 기타(10%)에서 사용됩니다."
- "김치찌개가 배추 사용량의 60%를 차지하므로, 김치찌개 판매량 변화가 배추 사용량에 큰 영향을 줍니다."

#### B. 메뉴별 재료 사용량 효율성

- **재료 사용량 대비 매출**: 재료 사용량이 많지만 매출 기여도가 낮은 메뉴 식별
- **재료 사용량 효율 지수**: (매출 / 재료 사용량) = 재료 효율성
- **비효율 메뉴**: 재료 사용량은 많지만 매출이 낮은 메뉴

**인사이트**:
- "된장찌개는 배추 사용량이 많지만 매출 기여도가 낮아 재료 효율성이 낮습니다."
- "재료 효율성 개선을 위해 된장찌개 레시피 최적화를 검토하세요."

### 2.3 재료 사용량 예측 강화 (신규)

**목적**: 향후 재료 사용량을 예측하여 발주 계획 수립 및 재고 최적화.

#### A. 단기 예측 (3일, 7일, 14일)

- **예측 기간 선택**: 3일, 7일, 14일 중 선택
- **예상 사용량**: 최근 평균 사용량 기반 예상 사용량
- **트렌드 반영**: 최근 사용량 증가/감소 추세 반영
- **계절성 반영**: 요일별 패턴, 월별 패턴 반영

**인사이트**:
- "배추 예상 사용량 (7일): 500kg (일평균 71kg, 주말 패턴 반영)"
- "배추 사용량이 최근 3일간 +5% 증가 추세이므로 예상 사용량을 +5% 조정했습니다."

#### B. 중장기 예측 (1개월, 3개월)

- **월별 예상 사용량**: 향후 1개월, 3개월 월별 예상 사용량
- **계절성 반영**: 전년 동기 사용량 패턴 반영
- **예측 신뢰도**: 예측 정확도 지표

**인사이트**:
- "12월 배추 예상 사용량: 2,000kg (전년 동기 대비 +20% 증가 예상)"
- "계절성 패턴을 반영하여 12월 사용량을 상향 조정했습니다."

### 2.4 재고 연계 분석 (신규)

**목적**: 재료 사용량과 재고를 연계하여 재고 최적화 및 발주 계획 수립.

#### A. 사용량 vs 재고 상관 분석

- **현재고 대비 사용량**: 현재고로 며칠 사용 가능한지 (예상 소진일)
- **사용량 증가 vs 재고 감소**: 사용량 증가 추세와 재고 변화의 상관관계
- **재고 부족 위험**: 사용량 증가 추세인데 재고가 감소하는 재료 식별

**인사이트**:
- "배추 사용량이 최근 3개월간 +10% 증가했지만 재고는 -5% 감소했습니다. 발주량을 늘리세요."
- "배추 현재고로 약 5일간 사용 가능합니다. (일평균 사용량 기준)"

#### B. 사용량 기반 발주 제안

- **예상 사용량 기반 발주량**: 예상 사용량 + 안전재고 - 현재고 = 발주 필요량
- **사용량 트렌드 반영**: 사용량 증가 추세 반영 발주량 조정
- **우선순위 제안**: 사용량 증가 + 재고 부족 재료 우선 발주 제안

**인사이트**:
- "배추 예상 사용량(7일) 500kg + 안전재고 200kg - 현재고 100kg = 발주 필요량 600kg"
- "배추 사용량이 증가 추세이므로 발주량을 +10% 상향 조정을 권장합니다."

### 2.5 재료 사용량 효율성 분석 (신규)

**목적**: 재료 사용량 대비 매출 기여도를 분석하여 재료 효율성 파악.

#### A. 재료별 효율성 지수

- **재료 효율성 지수**: (총 매출 기여도 / 총 사용량) = 재료 효율성
- **효율성 순위**: 재료 효율성이 높은/낮은 재료 TOP 10
- **효율성 구간별 분포**: 고효율, 중효율, 저효율 재료 분류

**인사이트**:
- "배추는 사용량이 많지만 매출 기여도가 높아 효율성이 높습니다."
- "저효율 재료 5개가 전체 사용량의 30%를 차지합니다. 레시피 최적화를 검토하세요."

#### B. 재료 사용량 vs 원가 분석

- **재료 사용량 대비 원가**: 사용량이 많지만 원가 기여도가 낮은 재료
- **원가 효율성**: (원가 기여도 / 사용량) = 원가 효율성
- **비효율 재료**: 사용량은 많지만 원가 기여도가 낮은 재료

**인사이트**:
- "된장은 사용량이 많지만 원가 기여도가 낮아 원가 효율성이 낮습니다."

### 2.6 재료 사용량 최적화 액션 제안 (신규)

**목적**: 재료 사용량 최적화를 위한 구체적이고 실행 가능한 액션 아이템 제안.

#### A. 자동 진단

- **사용량 급증 재료**: 최근 사용량이 급증한 재료 (전월 대비 +20% 이상)
- **사용량 급감 재료**: 최근 사용량이 급감한 재료 (전월 대비 -20% 이상)
- **비효율 재료**: 사용량은 많지만 매출/원가 기여도가 낮은 재료
- **재고 부족 위험 재료**: 사용량 증가 추세인데 재고가 부족한 재료

#### B. 우선순위별 액션 제안

1. **발주량 조정**: 사용량 증가 + 재고 부족 재료의 발주량 증가
2. **레시피 최적화**: 비효율 재료의 레시피 최적화 검토
3. **메뉴 판매 전략**: 특정 재료 사용량이 많은 메뉴의 판매 전략 조정
4. **재고 관리**: 사용량 패턴(요일별, 월별) 반영 재고 관리

**인사이트**:
- "배추 사용량이 전월 대비 +15% 증가했지만 재고는 -5% 감소했습니다. 발주량을 +20% 증가하세요."
- "된장은 사용량이 많지만 매출 기여도가 낮습니다. 된장찌개 레시피 최적화를 검토하세요."

### 2.7 내보내기 기능 강화 (신규)

**목적**: 재료 사용량 데이터를 다양한 형식으로 내보내기 제공.

#### A. 사용량 데이터 내보내기

- **일별 사용량 내보내기**: 일별 재료 사용량 CSV/Excel
- **월별 사용량 내보내기**: 월별 재료 사용량 집계 CSV/Excel
- **재료별 사용량 내보내기**: 재료별 총 사용량·사용단가 CSV/Excel

#### B. 트렌드·예측 데이터 내보내기

- **사용량 트렌드 내보내기**: 일별/요일별/월별 사용량 트렌드 CSV/Excel
- **예측 데이터 내보내기**: 예상 사용량 데이터 CSV/Excel
- **재고 연계 분석 내보내기**: 사용량 vs 재고 상관 분석 데이터 CSV/Excel

---

## 3. 새로운 페이지 구조 (ZONE 구분)

### 3.1 ZONE A: 핵심 지표 (기존 강화)

- **총 사용량**, **총 사용단가** (기존 유지)
- **평균 일일 사용량**, **사용량 변화율(전월 대비)** (신규)
- **사용량 급증 재료 수**, **사용량 급감 재료 수** (신규)

### 3.2 ZONE B: 기간별 사용량 집계 (기존 유지 + 강화)

- **기간 선택 필터** (기존 유지)
- **재료별 총 사용량·사용단가 집계** (기존 유지)
- **TOP 10 재료** (기존 유지)
- **ABC 분석** (기존 유지)
- **사용량 변화율 (전월 대비)** (신규)

### 3.3 ZONE C: 재료 사용량 트렌드 (신규)

- **일별 사용량 추이**: 최근 30/60/90일 일별 사용량, 사용량 급증/급감 일자
- **요일별 사용량 패턴**: 요일별 평균 사용량, 주말 vs 평일 비교
- **월별 사용량 트렌드**: 최근 6/12개월 월별 추이, 전월/전년 동기 대비 변화율

### 3.4 ZONE D: 메뉴별 재료 사용량 기여도 (신규)

- **재료별 메뉴 기여도**: 재료 선택 → 메뉴별 사용량·비율, 메뉴별 사용량 순위
- **메뉴별 재료 사용량 효율성**: 재료 사용량 대비 매출, 재료 효율 지수, 비효율 메뉴

### 3.5 ZONE E: 재료 사용량 예측 (신규)

- **단기 예측**: 3일/7일/14일 예상 사용량, 트렌드·계절성 반영
- **중장기 예측**: 1개월/3개월 월별 예상 사용량, 계절성 반영, 예측 신뢰도

### 3.6 ZONE F: 재고 연계 분석 (신규)

- **사용량 vs 재고 상관**: 현재고 대비 사용량, 예상 소진일, 사용량 증가 vs 재고 감소
- **사용량 기반 발주 제안**: 예상 사용량 기반 발주량, 사용량 트렌드 반영, 우선순위 제안

### 3.7 ZONE G: 재료 사용량 효율성 분석 (신규)

- **재료별 효율성 지수**: 재료 효율성 지수, 효율성 순위, 효율성 구간별 분포
- **재료 사용량 vs 원가**: 재료 사용량 대비 원가, 원가 효율성, 비효율 재료

### 3.8 ZONE H: 재료 사용량 최적화 액션 (신규)

- **자동 진단**: 사용량 급증/급감 재료, 비효율 재료, 재고 부족 위험 재료
- **우선순위별 액션 제안**: 발주량 조정, 레시피 최적화, 메뉴 판매 전략, 재고 관리

### 3.9 ZONE I: 내보내기 & 액션 (기존 강화)

- **사용량 데이터 내보내기** (일별, 월별, 재료별, 신규)
- **트렌드·예측 데이터 내보내기** (트렌드, 예측, 재고 연계, 신규)
- **연계 페이지 이동** (기존 유지)

---

## 4. 데이터 함수 정리 및 증명

### 4.1 일별 사용량 트렌드 계산 (신규)

```text
_calculate_daily_usage_trend(usage_df, days=30) → DataFrame
```

- **입력**: 사용량 DataFrame (날짜, 재료명, 총사용량), 기간(일)
- **로직**: 일별 사용량 집계, 전일 대비 변화율 계산, 사용량 급증/급감 일자 식별
- **출력**: 날짜, 재료명, 사용량, 전일대비변화율(%), 급증/급감여부

### 4.2 요일별 사용량 패턴 계산 (신규)

```text
_calculate_weekday_usage_pattern(usage_df) → DataFrame
```

- **입력**: 사용량 DataFrame (날짜, 재료명, 총사용량)
- **로직**: 요일별 평균 사용량 계산, 주말 vs 평일 비교
- **출력**: 요일, 재료명, 평균사용량, 주말/평일구분, 비율(%)

### 4.3 월별 사용량 트렌드 계산 (신규)

```text
_calculate_monthly_usage_trend(usage_df, months=6) → DataFrame
```

- **입력**: 사용량 DataFrame, 기간(월)
- **로직**: 월별 사용량 집계, 전월 대비 변화율, 전년 동기 대비 변화율 계산
- **출력**: 년월, 재료명, 사용량, 전월대비변화율(%), 전년동기대비변화율(%)

### 4.4 메뉴별 재료 사용량 기여도 계산 (신규)

```text
_calculate_menu_contribution_to_ingredient(usage_df, daily_sales_df, recipe_df, ingredient_name) → DataFrame
```

- **입력**: 사용량 DataFrame, 일일 판매 DataFrame, 레시피 DataFrame, 재료명
- **로직**: 
  - 레시피에서 해당 재료를 사용하는 메뉴 필터링
  - 메뉴별 사용량 집계 (판매량 × 레시피 사용량)
  - 메뉴별 사용량 비율 계산
- **출력**: 메뉴명, 사용량, 비율(%), 매출, 효율지수

### 4.5 재료 사용량 예측 (신규)

```text
_predict_ingredient_usage(usage_df, forecast_days=7, consider_trend=True, consider_seasonality=True) → DataFrame
```

- **입력**: 사용량 DataFrame, 예측 일수, 트렌드 반영 여부, 계절성 반영 여부
- **로직**:
  - 기본: 최근 N일 평균 사용량 × 예측 일수
  - 트렌드 반영: 최근 사용량 추세(증가/감소) 반영
  - 계절성 반영: 요일별/월별 패턴 반영
- **출력**: 재료명, 예상사용량, 예측신뢰도(%)

### 4.6 재고 연계 분석 (신규)

```text
_analyze_usage_vs_inventory(usage_df, inventory_df, usage_trend_df) → DataFrame
```

- **입력**: 사용량 DataFrame, 재고 DataFrame, 사용량 트렌드 DataFrame
- **로직**: 
  - 현재고 대비 일평균 사용량으로 예상 소진일 계산
  - 사용량 증가 추세와 재고 변화 상관 분석
  - 재고 부족 위험 재료 식별
- **출력**: 재료명, 현재고, 일평균사용량, 예상소진일, 사용량증가율(%), 재고변화율(%), 위험도

### 4.7 재료 효율성 계산 (신규)

```text
_calculate_ingredient_efficiency(usage_df, daily_sales_df, recipe_df, menu_df) → DataFrame
```

- **입력**: 사용량 DataFrame, 일일 판매 DataFrame, 레시피 DataFrame, 메뉴 마스터 DataFrame
- **로직**:
  - 재료별 총 사용량 계산
  - 재료를 사용하는 메뉴의 총 매출 계산 (판매량 × 판매가)
  - 재료 효율성 지수 = 총 매출 / 총 사용량
- **출력**: 재료명, 총사용량, 총매출기여도, 효율지수, 효율등급

---

## 5. UI/UX 요약

- **재료 선택**: 드롭다운으로 재료별 상세 분석
- **기간 선택**: 일별 트렌드 (30/60/90일), 월별 트렌드 (6/12개월)
- **예측 기간 선택**: 단기(3/7/14일), 중장기(1/3개월)
- **차트**: 라인 차트(일별/월별 트렌드), 바 차트(요일별 패턴, TOP 10), 파이 차트(메뉴별 기여도)
- **내보내기**: 일별/월별/재료별 사용량, 트렌드, 예측 데이터 (CSV, Excel)
- **데이터 미입력 시**: 해당 ZONE 안내 문구 + 판매/레시피 입력 페이지로 이동 버튼

---

## 6. 구현 순서 제안

| 단계 | 작업 | 비고 |
|------|------|------|
| 1 | **일별 사용량 트렌드** | `_calculate_daily_usage_trend` 구현, ZONE C |
| 2 | **요일별 패턴** | `_calculate_weekday_usage_pattern` 구현, ZONE C |
| 3 | **월별 트렌드** | `_calculate_monthly_usage_trend` 구현, ZONE C |
| 4 | **메뉴별 기여도** | `_calculate_menu_contribution_to_ingredient` 구현, ZONE D |
| 5 | **사용량 예측** | `_predict_ingredient_usage` 구현, ZONE E |
| 6 | **재고 연계 분석** | `_analyze_usage_vs_inventory` 구현, ZONE F |
| 7 | **효율성 분석** | `_calculate_ingredient_efficiency` 구현, ZONE G |
| 8 | **액션 제안** | 자동 진단 및 우선순위별 액션, ZONE H |
| 9 | **ZONE A 강화** | 핵심 지표 추가 (평균 일일 사용량, 변화율, 급증/급감 수) |
| 10 | **내보내기 강화** | 일별/월별/트렌드/예측 데이터 내보내기, ZONE I |

---

## 7. 기대 효과

- **사용량 패턴 파악**: 일별/요일별/월별 사용량 트렌드로 사용량 패턴 명확화.  
- **선제적 재고 관리**: 사용량 예측 및 재고 연계 분석으로 발주 계획 수립.  
- **메뉴별 최적화**: 메뉴별 재료 사용량 기여도 분석으로 레시피 최적화.  
- **재료 효율성 개선**: 재료 효율성 분석으로 비효율 재료 식별 및 최적화.  
- **트렌드 기반 대응**: 사용량 변화율 분석으로 선제적 재고 관리.  
- **실행 가능한 인사이트**: 자동 진단 및 우선순위별 액션 제안으로 즉시 실행 가능.

---

## 8. 정리

### 핵심 원칙

1. **사용량 SSOT**: 재료 사용량은 **daily_sales_items × recipes**로만 계산.  
2. **트렌드 기반 분석**: 일별/요일별/월별 사용량 트렌드로 패턴 파악.  
3. **예측 기반 계획**: 사용량 예측으로 발주 계획 수립.  
4. **재고 연계**: 사용량과 재고를 연계하여 재고 최적화.  
5. **효율성 우선**: 재료 효율성 분석으로 비효율 재료 식별 및 최적화.

### 다음 단계

1. 기획안 검토 및 확정  
2. `_calculate_daily_usage_trend`, `_calculate_weekday_usage_pattern` 등 **데이터 함수** 구현 및 단위 검증  
3. ZONE A → B → C → D → E → F → G → H → I 순으로 UI 적용  
4. 데이터 미입력 등 **엣지 케이스** 확인  
5. 사용량 예측 **정확도** 검증  
6. **내보내기 기능** 테스트 및 검증

---

**작성일**: 2026-01-24  
**참고**:  
- `ui_pages/ingredient_usage_summary.py` (현재)  
- `src/analytics.py` (`calculate_ingredient_usage`)  
- `매출_분석_페이지_고도화_기획안.md` (ZONE 구조, 트렌드 분석)  
- `재고_분석_페이지_고도화_기획안.md` (사용량 트렌드, 예측, 재고 연계)
