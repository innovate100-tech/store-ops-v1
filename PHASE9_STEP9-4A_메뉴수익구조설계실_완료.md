# PHASE 9 / STEP 9-4A — Menu Profit Design Lab 완료

## 📋 작업 목표

"메뉴 수익 구조 설계실(가격·마진)"을 임시 연결(cost_overview)에서 분리하여 독립 페이지로 생성했습니다.
공통 프레임(Design Lab 4층 구조)을 사용합니다.

---

## ✅ 완료된 작업

### 1. 새 페이지 생성
- **파일**: `ui_pages/menu_profit_design_lab.py` (신규 생성)
- **기능**: 메뉴 수익 구조 설계실 전용 페이지
- **구조**: Design Lab 공통 프레임 4층 구조 사용

### 2. 사이드바 라우팅 변경
- **파일**: `app.py`
- **변경**: "메뉴 수익 구조 설계실" → 새 페이지로 연결
- **기존**: cost_overview는 "원가 분석"으로 유지

### 3. cost_overview.py 복원
- **파일**: `ui_pages/cost_overview.py`
- **변경**: 공통 프레임 제거, 원가 분석 전용 기능만 유지
- **위치**: "🟣 장사 분석" 카테고리에 유지

---

## 📝 페이지 구조 (4층)

### ZONE A: 코치 요약 (Coach Board)
- 원가율 35% 초과 메뉴 수
- 최고/최저 원가율 메뉴
- 평균 공헌이익 (가능하면)
- 판결문 + 추천 액션 ("가격 조정 후보 TOP3 확인")

### ZONE B: 구조 맵 (Structure Map)
- 메뉴별 원가율 분포 (bar chart)
- 공헌이익 TOP/Bottom 5 표

### ZONE C: 사장 학교 (Owner School)
- "원가율과 공헌이익은 다르다"
- "가격은 구조를 바꾼다"
- "미끼/볼륨/마진 메뉴의 조합"

### ZONE D: 설계 도구 (Design Tools)
1. **위험 메뉴 테이블**
   - 메뉴명, 판매가, 원가, 원가율, 공헌이익, 위험 사유
   - 필터: 원가율 >= 35%, 공헌이익 하위, 판매가 낮은데 원가 높은 메뉴, 전체

2. **가격/마진 시뮬레이터**
   - 메뉴 1개 선택
   - 가격 입력 (number_input)
   - 즉시 계산: 새 원가율, 새 공헌이익, 공헌이익 변화량

3. **메뉴 역할 태그** (표시만, DB 저장 없음)
   - 선택 메뉴에 대해: "미끼/볼륨/마진" 버튼 3개
   - session_state로만 유지
   - "저장 기능은 다음 단계" 안내 문구

---

## 📝 수정된 파일 목록

### 1. `ui_pages/menu_profit_design_lab.py` (신규 생성)
- 메뉴 수익 구조 설계실 전용 페이지
- Design Lab 공통 프레임 사용
- 위험 메뉴 분석, 가격/마진 시뮬레이터, 메뉴 역할 태그 포함

### 2. `app.py` (수정)
- "메뉴 수익 구조 설계실" 메뉴를 새 페이지로 연결
- 라우팅 추가: `elif page == "메뉴 수익 구조 설계실"`

### 3. `ui_pages/cost_overview.py` (수정)
- 공통 프레임 제거
- 원가 분석 전용 기능만 유지
- "원가 분석" 페이지로 복원

### 4. `ui_pages/design_lab/design_lab_coach_data.py` (수정)
- `get_menu_profit_design_coach_data()` 함수 수정
- 변수 참조 오류 수정
- 추천 액션 페이지를 "메뉴 수익 구조 설계실"로 변경

---

## ✅ 앱 실행 시 확인 체크리스트

### 라우팅 확인
- [ ] 사이드바 "🔥 가게 설계" → "메뉴 수익 구조 설계실" 클릭 → 새 페이지 진입 OK
- [ ] 사이드바 "🟣 장사 분석" → "원가 분석" 클릭 → cost_overview 페이지 진입 OK

### 메뉴 수익 구조 설계실 페이지
- [ ] ZONE A (코치 요약) 정상 표시
- [ ] ZONE B (구조 맵) 정상 표시 (원가율 분포, 공헌이익 TOP/Bottom 5)
- [ ] ZONE C (사장 학교) 정상 표시
- [ ] ZONE D (설계 도구) 정상 표시
  - [ ] 위험 메뉴 테이블 정상 표시 및 필터 동작
  - [ ] 가격/마진 시뮬레이터 정상 동작
  - [ ] 메뉴 역할 태그 정상 동작 (session_state 저장)

### 원가 분석 페이지
- [ ] 기존 원가 분석 기능 정상 동작
- [ ] 공통 프레임 없이 원가 분석만 표시

---

## 🎯 기대 동작

### 사용자 경험
1. **메뉴 수익 구조 설계실**: 가격·마진 중심의 설계 도구 제공
2. **원가 분석**: 원가율 중심의 분석 도구 제공
3. **명확한 분리**: 두 페이지가 서로 다른 목적으로 사용됨

### 코드 안정성
- 기존 함수 재사용 (`calculate_menu_cost`, `render_cost_analysis`)
- 공통 프레임 재사용
- DB 스키마 변경 없음

---

## 📌 참고사항

### 메뉴 역할 태그
- **현재**: session_state로만 저장 (페이지 새로고침 시 유지)
- **향후**: DB 저장 기능 추가 예정
- **안내**: "저장 기능은 다음 단계에서 추가될 예정입니다" 문구 표시

### 가격/마진 시뮬레이터
- **실시간 계산**: 가격 변경 시 즉시 원가율/공헌이익 계산
- **변화량 표시**: delta 형식으로 변화량 표시

### 위험 메뉴 분석
- **필터 옵션**: 4가지 필터 제공
- **위험 사유**: 자동 판단 (원가율, 공헌이익, 판매가/원가 비율)

---

## 🚀 배포 준비

모든 수정이 완료되었습니다. 다음 단계:
1. ✅ 앱 재시작
2. ✅ "메뉴 수익 구조 설계실" 메뉴 클릭 → 새 페이지 진입 확인
3. ✅ "원가 분석" 메뉴 클릭 → 기존 페이지 진입 확인
4. ✅ 메뉴 수익 구조 설계실의 모든 기능 정상 동작 확인

---

## 📊 작업 요약

| 항목 | 상태 | 비고 |
|------|------|------|
| 새 페이지 생성 | ✅ 완료 | menu_profit_design_lab.py |
| 사이드바 라우팅 변경 | ✅ 완료 | app.py |
| cost_overview 복원 | ✅ 완료 | 원가 분석 전용 |
| 공통 프레임 적용 | ✅ 완료 | 4층 구조 |
| 위험 메뉴 분석 | ✅ 완료 | 필터 4가지 |
| 가격/마진 시뮬레이터 | ✅ 완료 | 실시간 계산 |
| 메뉴 역할 태그 | ✅ 완료 | session_state 저장 |

---

## ✅ 최종 확인

- [x] 새 페이지 생성 완료
- [x] 사이드바 라우팅 변경 완료
- [x] cost_overview 복원 완료
- [x] 공통 프레임 적용 완료
- [x] 설계 도구 구현 완료
- [ ] 앱 실행 및 동작 확인 (사용자 확인 필요)

**참고**: 
- 메뉴 수익 구조 설계실은 가격·마진 중심의 설계 도구입니다.
- 원가 분석은 원가율 중심의 분석 도구입니다.
- 두 페이지는 서로 다른 목적으로 사용됩니다.
