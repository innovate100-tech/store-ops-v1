# 분석 카테고리 업그레이드 기획안

**작성 일자**: 2026-01-24  
**목적**: 분석 허브 도입, 세부분석 구조 정리, 꼭 필요한 분석만 유지

---

## 📋 개요

- **입력 허브**: 입력이 본질 → 허브에서 **입력 링크 보여주기**가 메인.
- **분석 허브**: **분석 자료 보는 것**이 본질 → 허브에 **핵심 자료**가 있어야 함. 링크는 부가.

분석 카테고리를 입력처럼 **분석 허브 + 세부분석선택(expander)** 구조로 바꾸고,  
허브 상단에는 **핵심 지표/요약**을 노출한다.

---

## 1. 분석 허브 vs 입력 허브

| 구분 | 입력 허브 | 분석 허브 |
|------|-----------|-----------|
| **본질** | 입력 자체 | 분석 자료 보기 |
| **메인** | 입력 링크(버튼) 노출 | **핵심 자료(숫자·차트·요약)** 노출 |
| **부가** | 오늘 해야 할 일, 섹션별 링크 | 세부분석 페이지로 가는 링크(expander) |

---

## 2. 분석 허브에 넣을 「핵심 자료」

분석의 본질이 **자료 보기**이므로, 허브 최상단·메인 영역에는 **꼭 필요한 지표만** 요약한다.

### 2.1 ZONE A: 한눈에 보는 핵심 지표 (메인)

**목적**: 로그인 후 분석 허브만 봐도 “이번 달 매출·비용·성적표·원가·재고”가 바로 보이게.

| # | 영역 | 허브 노출 내용 | 데이터 소스 |
|---|------|----------------|-------------|
| 1 | **매출** | 이번 달 누적 매출, 목표 대비 %, 전월 대비 | `sales` / `daily_close`, `targets` |
| 2 | **비용·손익** | 손익분기점 대비 매출, 고정비/변동비 요약 | `expense_structure`, `targets` |
| 3 | **실제정산** | 이번 달 목표 vs 실제 요약(매출·비용·순이익), 등급 | `actual_settlement`, `targets`, `expense_structure` |
| 4 | **원가** | 고원가율 메뉴 수, 평균 원가율 | `menu_master` + `recipes` + `ingredients` |
| 5 | **재고** | 품절 위험 N개, 발주 추천 요약 | `inventory`, 재고 분석 로직 |
| 6 | **재료 사용** | 기간 내 TOP 사용 재료 3~5개 or 사용량 요약 | `daily_sales_items` × `recipes` |

**UI 형태 (예시)**  
- 카드 2×3 또는 3×2 그리드  
- 각 카드: 제목 + 핵심 숫자 1~2개 + “자세히 →” 등 상세 페이지 이동 버튼  
- 데이터 없으면: “—”, “입력 후 표시” 등 안내 문구

### 2.2 ZONE B: 세부분석선택 (expander)

**목적**: 상세 분석이 필요할 때만 펼쳐서 **세부분석 페이지**로 이동.

- **기본**: 접힘(`expanded=False`)
- **내용**: 세부분석 페이지 링크 버튼만 배치 (입력 허브의 “세부입력선택”과 동일 패턴)

---

## 3. 꼭 필요한 분석만 정리

### 3.1 핵심 분석 (6개) — 유지

| # | 항목 | 페이지 | 용도 |
|---|------|--------|------|
| 1 | **매출 분석** | 매출 관리 | 매출 트렌드, 목표 vs 실적 |
| 2 | **비용 분석** | 비용 분석 (신규) | 목표 비용구조, 손익분기점, 고정비/변동비 |
| 3 | **실제정산 분석** | 실제정산 분석 (신규) | 목표 vs 실제, 월간 성적표, 수익성 |
| 4 | **원가 분석** | 원가 파악 | 메뉴별 원가/원가율 |
| 5 | **재고 분석** | 재고 분석 | 발주 추천, 재고 현황 |
| 6 | **재료 사용량** | 재료 사용량 집계 | 기간별 사용량, ABC |

이 6개가 **세부분석선택** expander에 들어갈 **꼭 필요한** 항목이다.

### 3.2 부가 분석 (선택) — expander 하단 또는 별도 구분

| # | 항목 | 페이지 | 비고 |
|---|------|--------|------|
| 7 | **매출 하락 원인 찾기** | 매출 하락 원인 찾기 | 진단/원클릭 플로우 |
| 8 | **검진 결과 요약** | 검진 결과 요약 | QSC 점검 성격 |
| 9 | **검진 히스토리** | 검진 히스토리 | QSC 점검 성격 |

- “꼭 필요”보다는 **진단·점검** 성격.
- expander 하단에 두거나, “진단·점검” 등으로 구분해 넣을 수 있다.

### 3.3 제외·통합

- **발주 관리**: 없어짐. 재고 분석으로 통합됨.
- **판매·메뉴 분석**: 매출/원가와 역할이 겹칠 수 있음.  
  - 유지 시: 세부분석에 “판매·메뉴 분석” 포함.  
  - 통합 시: 매출 분석·원가 분석에 흡수 후 메뉴별 판매/원가 탭 등으로 처리.

**기획안 기준**: 당분간 **판매·메뉴 분석**도 세부분석에 유지한다. (기존 “판매 관리” 활용)

---

## 4. 분석 카테고리 구조 (사이드바)

### 4.1 입력 카테고리와 동일 패턴

```
📊 분석
├── [분석 허브]          ← 항상 노출 (클릭 시 분석 허브 페이지)
└── 세부분석선택 (expander, 기본 접힘)
    ├── 매출 분석        → 매출 관리
    ├── 비용 분석        → 비용 분석 (신규)
    ├── 실제정산 분석    → 실제정산 분석 (신규)
    ├── 원가 분석        → 원가 파악
    ├── 재고 분석        → 재고 분석
    ├── 재료 사용량      → 재료 사용량 집계
    ├── 판매·메뉴 분석   → 판매 관리 (유지)
    ├── 매출 하락 원인 찾기 → 매출 하락 원인 찾기 (부가)
    ├── 검진 결과 요약   → 검진 결과 요약 (부가)
    └── 검진 히스토리    → 검진 히스토리 (부가)
```

- **분석 허브**: `page_key` 예) `"분석 허브"`  
- **세부분석**: 기존 `page_key` 유지 (매출 관리, 비용 분석, 실제정산 분석, 원가 파악, 재고 분석, 재료 사용량 집계, 판매 관리, 매출 하락 원인 찾기, 검진 결과 요약, 검진 히스토리).

### 4.2 “꼭 필요”만 쓰는 최소 구성 (옵션)

부가를 빼고 **핵심 6개 + 판매·메뉴**만 두는 경우:

```
세부분석선택 (expander)
├── 매출 분석
├── 비용 분석
├── 실제정산 분석
├── 원가 분석
├── 재고 분석
├── 재료 사용량
└── 판매·메뉴 분석
```

- 매출 하락 원인 찾기, 검진 결과/히스토리는 **분석 허브 ZONE B**에 작은 링크로 두거나, 별도 “진단·점검” 구역으로 분리할 수 있다.

---

## 5. 신규 페이지 (2개)

### 5.1 비용 분석 페이지

- **이름**: 비용 분석  
- **파일**: `ui_pages/analysis/cost_analysis.py` (신규)  
- **역할**: 목표 비용구조 입력 데이터 기반 비용 분석  
- **기능 예시**:
  - 목표매출 달성 시 비용구조 분석
  - 월간 집계, 고정비/변동비 비율
  - 매출 수준별 비용·영업이익 시뮬레이션
  - 손익분기점 시각화
- **위치**: 🟣 분석 카테고리 → 세부분석선택

### 5.2 실제정산 분석 페이지

- **이름**: 실제정산 분석 (또는 “월간 성적표 분석”)  
- **파일**: `ui_pages/analysis/settlement_analysis.py` (신규)  
- **역할**: 실제정산 입력 데이터 기반 성과 분석  
- **기능 예시**:
  - 목표 vs 실제 비교
  - 월간 성적표 상세, 월별 트렌드
  - 카테고리별 비용·수익성 분석, 차트
- **위치**: 🟣 분석 카테고리 → 세부분석선택

---

## 6. 분석 허브 페이지 스펙

### 6.1 라우팅

- **페이지 키**: `"분석 허브"`  
- **URL/라우팅**: 기존 패턴 유지 (예: `current_page == "분석 허브"` → `render_analysis_hub()`).

### 6.2 레이아웃

1. **상단**: 헤더  
   - `"📊 분석 허브"`  
   - 문구 예: “분석은 가게 숫자를 해석하는 일입니다. 핵심만 먼저 보세요.”

2. **ZONE A: 핵심 자료 (메인)**  
   - 6개 카드: 매출, 비용·손익, 실제정산, 원가, 재고, 재료 사용  
   - 각 카드:  
     - 제목  
     - 핵심 숫자 1~2개 (또는 “—”)  
     - “자세히 보기” 버튼 → 해당 세부분석 페이지  
   - 2×3 또는 3×2 그리드 (반응형 가능하면 좋음).

3. **ZONE B: 세부분석선택 (expander)**  
   - `expanded=False`  
   - 버튼 목록: 매출 분석, 비용 분석, 실제정산 분석, 원가 분석, 재고 분석, 재료 사용량, 판매·메뉴 분석, (선택) 매출 하락 원인 찾기, 검진 결과 요약, 검진 히스토리  
   - 클릭 시 `current_page` 변경 후 해당 페이지 렌더.

### 6.3 데이터 로딩

- **공통**: `store_id` 필수.  
- **매출**: `load_monthly_sales_total`, `targets` 등 기존 함수 활용.  
- **비용·손익**: `expense_structure`, `get_fixed_costs`, `get_variable_cost_ratio`, `calculate_break_even_sales` 등.  
- **실제정산**: `load_actual_settlement_items`, `targets`, `sales` 등.  
- **원가**: 메뉴별 원가/원가율 계산 (기존 `cost_overview` / `analytics` 로직 재사용).  
- **재고**: 재고 분석 페이지에서 쓰는 로직(품절 위험, 발주 추천) 요약용으로 공통화해 호출.  
- **재료 사용**: 기간별 사용량 TOP N (재료 사용량 집계 로직 재사용).

- **에러/결측**: 데이터 없을 때 “—”, “입력 후 표시” 등으로 안전 처리.

---

## 7. app.py 변경 요약

### 7.1 메뉴 구조

- **분석** 카테고리:
  - **항상 노출**: `("분석 허브", "분석 허브")`
  - **세부분석선택** (expander):
    - `("매출 분석", "매출 관리")`
    - `("비용 분석", "비용 분석")` ← 신규
    - `("실제정산 분석", "실제정산 분석")` ← 신규
    - `("원가 분석", "원가 파악")`
    - `("재고 분석", "재고 분석")`
    - `("재료 사용량", "재료 사용량 집계")`
    - `("판매·메뉴 분석", "판매 관리")`
    - `("매출 하락 원인 찾기", "매출 하락 원인 찾기")`
    - `("검진 결과 요약", "검진 결과 요약")`
    - `("검진 히스토리", "검진 히스토리")`

- 기존 “📊 분석” 하위 **일렬 나열** 제거, **분석 허브 + expander** 구조로 통일.

### 7.2 라우팅 추가

- `page == "분석 허브"` → `render_analysis_hub()`  
- `page == "비용 분석"` → `render_cost_analysis()` (`cost_analysis.py`)  
- `page == "실제정산 분석"` → `render_settlement_analysis()` (`settlement_analysis.py`)  

- **발주 관리** 참조 있으면 제거 (이미 재고 분석으로 대체됨).

### 7.3 입력 카테고리 참고

- `category_name == "✍ 입력"` 일 때:
  - 입력 허브 버튼 노출
  - `"✍ 입력 (빠른 입력)"` → **세부입력선택** expander  
- `category_name == "📊 분석"` 일 때:
  - 분석 허브 버튼 노출
  - `"📊 분석 (세부분석)"` 또는 동일 패턴 → **세부분석선택** expander  

동일한 렌더 로직을 “분석”에 적용하면 된다.

---

## 8. 구현 순서 제안

| 단계 | 작업 | 비고 |
|------|------|------|
| 1 | **비용 분석 페이지** (`cost_analysis.py`) | 목표 비용구조 기반 분석 |
| 2 | **실제정산 분석 페이지** (`settlement_analysis.py`) | 목표 vs 실제, 성적표 |
| 3 | **분석 허브** (`analysis_hub.py`) | ZONE A 핵심 자료 + ZONE B 세부분석 expander |
| 4 | **app.py** | 분석 카테고리 구조 변경, 분석 허브 + 비용/실제정산 분석 라우팅 |
| 5 | **공통 데이터 로더** | 허브용 경량 KPI (선택: `analysis_hub_data.py` 등) |

---

## 9. 정리

- **분석 허브**: “자료 보기”가 본질 → **핵심 지표(6개 카드)** 를 메인에 두고, 세부는 **세부분석선택** expander로.
- **분석 카테고리**: 입력처럼 **허브 1개 + expander** 구조로 통일.
- **꼭 필요한 분석**: 매출, 비용, 실제정산, 원가, 재고, 재료 사용량 (＋ 판매·메뉴). 매출 하락 원인 찾기·검진은 부가.
- **신규 페이지**: 비용 분석, 실제정산 분석 2개 추가.

---

## 10. 구현 완료 요약

| 항목 | 파일 | 비고 |
|------|------|------|
| **비용 분석** | `ui_pages/analysis/cost_analysis.py` | 목표 비용구조 기반, 손익분기·고정비/변동비·5개 카테고리 현황 |
| **실제정산 분석** | `ui_pages/analysis/settlement_analysis.py` | 목표 vs 실제, 월간 성적표 요약 |
| **분석 허브** | `ui_pages/analysis/analysis_hub.py` | ZONE A: 6개 핵심 지표 카드, ZONE B: 세부분석선택 expander |
| **app.py** | 분석 카테고리 | 분석 허브 항상 노출 + 세부분석선택 expander, 라우팅 추가 |

- **분석 카테고리**: 입력과 동일하게 **허브 1개 + expander** 구조 적용.
- **세부분석**: 매출·비용·실제정산·원가·재고·재료 사용량·판매·메뉴·매출 하락 원인 찾기·검진 결과/히스토리.

---

**작성일**: 2026-01-24  
**참고**: `입력_분석_설계_분리_필요_항목_정리.md`, `입력_시스템_개선_기획안.md`, `ui_pages/input/input_hub.py`
