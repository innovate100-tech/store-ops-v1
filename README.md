# 매장 운영 시스템 v1

매장 운영을 돕는 간단한 운영 시스템입니다. Python + Streamlit으로 구현되었습니다.

## 📋 주요 기능

### v1.0 기본 기능
1. **매출 관리**: 날짜별 매출 입력 및 조회, 날짜별 매출 추이 차트
2. **방문자 관리**: 네이버 스마트플레이스 방문자수 입력 및 조회
3. **메뉴 관리**: 메뉴 마스터 등록 및 조회
4. **통합 대시보드**: 매출과 방문자 데이터 통합 조회 및 상관관계 분석

### v1.1 추가 기능 (재료/레시피/원가)
5. **재료 관리**: 재료 마스터 등록 및 조회 (재료명, 단위, 단가)
6. **레시피 관리**: 메뉴-재료 매핑 관리 (1인분 사용량 입력)
7. **원가 분석**: 메뉴별 원가/원가율 자동 계산 및 분석
   - 메뉴별 원가 = 레시피 사용량 × 재료 단가 합계
   - 원가율 = 원가 / 판매가 × 100
   - 원가율 높은 순 정렬 및 경고 표시 (35% 이상)

### v1.2 추가 기능 (판매/재료사용량/발주)
8. **판매 관리**: 일일 판매 입력 및 집계
   - 날짜별 메뉴 판매수량 입력
   - 날짜별/메뉴별 판매량 집계
9. **재료 사용량 자동 계산**: 판매 데이터 기반 재료 소비량 분석
   - 일일 판매량 × 레시피 사용량 = 재료 사용량
   - 날짜별 재료별 총 사용량 집계
   - 사용량 TOP 10 재료 순위 표시
10. **발주 관리**: 재고 관리 및 발주 추천
    - 재료별 현재고/안전재고 입력
    - 발주 필요량 자동 계산
    - 예상소요량 = 최근 7일 평균 사용량 × 3일 (조정 가능)
    - 발주 리스트 CSV 다운로드 기능

### v1.3 추가 기능 (리포트)
11. **주간 리포트 PDF 생성**: 기간별 운영 리포트 자동 생성
    - 기간 선택 (시작일/종료일)
    - 포함 내용:
      - 총매출 및 일평균 매출
      - 방문자수 총합 및 일평균
      - 매출 vs 방문자 추세 차트
      - 메뉴별 판매 TOP 10
      - 재료 사용량 TOP 10
      - 발주 추천 TOP 10
    - reports/ 폴더에 PDF 파일 저장
    - 앱에서 PDF 다운로드 가능

## 🛠️ 기술 스택

- Python 3.11+
- Streamlit (웹 UI)
- pandas (데이터 처리)
- matplotlib (차트)
- reportlab (PDF 생성) (v1.3)

## 📦 설치 방법

### 1. Python 설치 확인

터미널(또는 PowerShell)에서 다음 명령어로 Python 버전을 확인합니다:

```bash
python --version
```

Python 3.11 이상이 설치되어 있어야 합니다. 없다면 [Python 공식 사이트](https://www.python.org/downloads/)에서 다운로드하세요.

### 2. 프로젝트 폴더로 이동

```bash
cd store_ops_v1
```

### 3. 가상환경 생성 (선택사항, 권장)

```bash
# 가상환경 생성
python -m venv venv

# 가상환경 활성화
# Windows:
venv\Scripts\activate
# Mac/Linux:
source venv/bin/activate
```

### 4. 필요한 패키지 설치

```bash
pip install -r requirements.txt
```

## 🚀 실행 방법

프로젝트 폴더에서 다음 명령어를 실행합니다:

```bash
streamlit run app.py
```

브라우저가 자동으로 열리며, `http://localhost:8501`에서 앱을 확인할 수 있습니다.

## 📁 프로젝트 구조

```
store_ops_v1/
├── app.py                 # 메인 Streamlit 앱
├── requirements.txt       # 필요한 패키지 목록
├── README.md             # 이 파일
├── data/                 # CSV 데이터 저장 폴더 (자동 생성)
│   ├── sales.csv         # 매출 데이터
│   ├── naver_visitors.csv # 방문자 데이터
│   ├── menu_master.csv   # 메뉴 마스터 데이터
│   ├── ingredient_master.csv # 재료 마스터 데이터 (v1.1)
│   ├── recipes.csv       # 레시피 데이터 (v1.1)
│   ├── daily_sales_items.csv # 일일 판매 내역 (v1.2)
│   └── inventory.csv     # 재고 정보 (v1.2)
├── reports/              # PDF 리포트 저장 폴더 (자동 생성, v1.3)
└── src/                  # 소스 코드 모듈
    ├── storage.py        # CSV 저장/로드 함수
    ├── analytics.py      # 분석 함수 (상관계수, 원가 계산 등)
    ├── ui.py             # UI 컴포넌트
    └── reporting.py      # 리포트 생성 모듈 (v1.3)
```

## 💡 사용 방법

### 매출 입력
1. 사이드바에서 "매출 관리" 선택
2. 날짜, 매장명, 총매출 입력
3. "저장" 버튼 클릭
4. 저장된 매출 내역과 차트가 자동으로 표시됩니다

### 방문자 입력
1. 사이드바에서 "방문자 관리" 선택
2. 날짜, 방문자수 입력
3. "저장" 버튼 클릭

### 메뉴 등록
1. 사이드바에서 "메뉴 관리" 선택
2. 메뉴명, 판매가 입력
3. "저장" 버튼 클릭

### 재료 등록 (v1.1)
1. 사이드바에서 "재료 관리" 선택
2. 재료명, 단위(g/ml/ea 등), 단가(원/단위) 입력
3. "저장" 버튼 클릭

### 레시피 등록 (v1.1)
1. 사이드바에서 "레시피 관리" 선택
2. 메뉴 선택 (메뉴 마스터에서)
3. 재료 선택 (재료 마스터에서)
4. 1인분 사용량 입력 (단위는 재료 단위에 맞춰)
5. "저장" 버튼 클릭
6. 메뉴별 레시피 필터링 기능 제공

### 원가 분석 (v1.1)
1. 사이드바에서 "원가 분석" 선택
2. 메뉴별 원가/원가율이 자동으로 계산되어 표시됩니다
3. 원가율이 높은 순으로 정렬되며, 35% 이상인 메뉴는 경고 표시됩니다
4. 통계 정보 (평균/최고/최저 원가율) 확인 가능

### 일일 판매 입력 (v1.2)
1. 사이드바에서 "판매 관리" 선택
2. 날짜, 메뉴, 판매수량 입력
3. "저장" 버튼 클릭
4. 날짜별/메뉴별 판매량 집계 확인
5. 재료 사용량 자동 계산 결과 확인

### 재고 관리 및 발주 추천 (v1.2)
1. 사이드바에서 "발주 관리" 선택
2. 재료별 현재고, 안전재고 입력 및 저장
3. 발주 추천 파라미터 설정 (평균 사용량 계산 기간, 예측일수)
4. 발주 추천 리스트 확인
5. 발주 리스트 CSV 다운로드

### 주간 리포트 생성 (v1.3)
1. 사이드바에서 "주간 리포트" 선택
2. 리포트 기간 설정 (시작일, 종료일)
3. "리포트 생성" 버튼 클릭
4. 생성된 PDF 다운로드
5. 생성된 리포트 목록에서 이전 리포트 다운로드 가능

### 통합 대시보드
1. 사이드바에서 "통합 대시보드" 선택
2. 매출과 방문자 데이터가 통합되어 표시됩니다
3. 매출-방문자 상관계수가 자동으로 계산됩니다

## 📝 데이터 저장

모든 데이터는 `data/` 폴더의 CSV 파일로 저장됩니다:
- `sales.csv`: 매출 데이터
- `naver_visitors.csv`: 방문자 데이터
- `menu_master.csv`: 메뉴 마스터 데이터
- `ingredient_master.csv`: 재료 마스터 데이터 (v1.1)
- `recipes.csv`: 레시피 데이터 (v1.1)
- `daily_sales_items.csv`: 일일 판매 내역 (v1.2)
- `inventory.csv`: 재고 정보 (v1.2)

파일이 없으면 자동으로 생성됩니다.

### 원가 계산 로직 (v1.1)
1. 레시피의 각 재료 사용량 × 재료 단가 = 재료비
2. 메뉴별 모든 재료비 합계 = 메뉴 원가
3. 메뉴 원가 / 판매가 × 100 = 원가율(%)
4. 원가율이 35% 이상이면 경고 표시

### 재료 사용량 계산 로직 (v1.2)
1. 일일 판매량 × 레시피 1인분 사용량 = 재료 사용량
2. 날짜별, 재료별로 총 사용량 집계
3. 최근 사용량 기준 TOP 10 재료 순위 제공

### 발주 추천 로직 (v1.2)
1. 최근 N일(기본 7일) 평균 일일 사용량 계산
2. 예상소요량 = 최근 평균 사용량 × 예측일수(기본 3일)
3. 발주 필요량 = max(0, 안전재고 + 예상소요량 - 현재고)
4. 예상 금액 = 발주 필요량 × 재료 단가
5. 발주 필요량이 0보다 큰 재료만 추천 리스트에 표시

### 주간 리포트 생성 로직 (v1.3)
1. 선택한 기간의 데이터를 수집
2. 매출 및 방문자 통계 계산
3. 매출 vs 방문자 추세 차트 생성
4. 메뉴별 판매량 집계 및 TOP 10 추출
5. 재료 사용량 집계 및 TOP 10 추출
6. 발주 추천 계산 및 TOP 10 추출
7. PDF 문서 생성 (reportlab 사용)
8. reports/ 폴더에 저장

## 🔧 문제 해결

### 한글 폰트가 깨지는 경우
Windows에서는 기본적으로 "Malgun Gothic" 폰트를 사용합니다. 
만약 차트에서 한글이 깨진다면, `src/ui.py`의 폰트 설정을 수정하세요.

### 패키지 설치 오류
```bash
pip install --upgrade pip
pip install -r requirements.txt
```

### Streamlit 실행 오류
포트가 이미 사용 중인 경우:
```bash
streamlit run app.py --server.port 8502
```

## ✨ v1.4 개선 사항 (최신)

### 데이터 관리 기능 강화
1. **데이터 수정/삭제 기능**: 메뉴, 재료, 매출, 방문자 데이터 수정 및 삭제 가능
2. **중복 데이터 방지**: 메뉴명, 재료명 중복 등록 자동 방지
3. **참조 무결성 체크**: 삭제 시 레시피, 판매 내역 등 관련 데이터 사용 여부 확인
4. **매출 저장 로직 개선**: 날짜+매장 기준으로 중복 처리 (같은 날짜 여러 매장 지원)

### 안정성 개선
5. **로깅 시스템**: 모든 작업이 `logs/` 폴더에 일별 로그 파일로 기록
6. **데이터 백업 기능**: 사이드바에서 원클릭으로 전체 데이터 백업 생성 (`backups/` 폴더)
7. **원가율 계산 정확도 개선**: 실제 판매 비중을 반영한 가중 평균 원가율 계산

### 사용성 개선
8. **UI에 수정/삭제 버튼 추가**: 각 관리 페이지에서 직관적으로 데이터 수정/삭제 가능

## 🔮 향후 확장 계획

- 데이터베이스 연동 (SQLite, PostgreSQL 등)
- 매장 다중 관리
- 더 다양한 통계 및 분석 기능
- 사용자 인증 및 권한 관리
- 레시피 버전 관리
- 재료 가격 변동 이력 관리
- 원가 자동 업데이트 알림
- 발주 이력 관리
- 재고 알림 기능

## 📄 라이선스

이 프로젝트는 개인 사용 목적으로 제작되었습니다.
