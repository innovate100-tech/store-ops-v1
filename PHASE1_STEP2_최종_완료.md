# Phase 1 STEP 2 최종 완료 보고서
## 저장은 유연하게 / 분석은 매출 기준으로만 시작

**작업 일자**: 2026-01-24  
**목표**: 어떤 항목이든 하나라도 있으면 저장 가능 (기록 목적), 단 매출이 있어야 홈/분석/코칭이 본격 활성화

---

## 1. 변경 파일/라인

### 1.1 `src/ui_helpers.py`
**변경 내용**:
- `has_sales_input()` 함수 추가 (라인 537-555)
- 분석 시작 조건 판정 함수: 매출이 입력되었는지 확인

**함수 시그니처**:
```python
def has_sales_input(
    card_sales: float = 0.0,
    cash_sales: float = 0.0,
    total_sales: float = 0.0
) -> bool
```

### 1.2 `ui_pages/daily_input_hub.py`
**변경 내용**:
- 상단 고정 안내 문구 통일 (라인 92-95)
- "저장" 버튼 클릭 시 저장 후 메시지 분기 (라인 285-329)
- "이 날짜 마감하기" 버튼 클릭 시 저장 후 메시지 분기 (라인 370-422)

**주요 변경 사항**:
- `has_sales_input()` 호출로 매출 여부 확인
- 매출 있음: "저장 완료! 매출이 입력되어 분석이 시작됩니다."
- 매출 없음: "기록은 저장되었습니다. 분석을 시작하려면 오늘 매출을 입력해 주세요." + 버튼 표시

### 1.3 `ui_pages/manager_close.py`
**변경 내용**:
- 상단 고정 안내 문구 통일 (라인 37-40)
- 마감 완료 버튼 클릭 시 저장 후 메시지 분기 (라인 152-195)

**주요 변경 사항**:
- `has_sales_input()` 호출로 매출 여부 확인
- 매출 있음: "저장 완료! 매출이 입력되어 분석이 시작됩니다."
- 매출 없음: "기록은 저장되었습니다. 분석을 시작하려면 오늘 매출을 입력해 주세요." + 버튼 표시

### 1.4 `ui_pages/home/home_page.py`
**변경 내용**:
- `_check_has_any_records_without_sales()` 함수 추가 (라인 184-228)
- `_render_records_without_sales_home()` 함수 추가 (라인 230-280)
- `_render_home_body()`에서 중간 상태 체크 추가 (라인 282-293)

**주요 변경 사항**:
- `data_level == 0`일 때 중간 상태 체크
- 중간 상태: `_render_records_without_sales_home()` 표시
- 완전 신규: `_render_new_user_home()` 표시

---

## 2. has_sales_input 규칙

### 2.1 판정 기준

**매출 체크**:
- `card_sales > 0` 또는 `cash_sales > 0` 또는 `total_sales > 0` → `True`
- 셋 모두 0이면 → `False`

### 2.2 사용 목적

**분석 시작 조건**:
- 매출이 있어야 홈/분석/코칭이 본격 활성화
- 매출 없이 방문자/메모/판매량만 저장해도 기록은 저장되지만 분석은 시작되지 않음

---

## 3. 위 6개 케이스 실제 테스트 결과

### 테스트 케이스 1: 매출만 입력
**입력**:
- 카드 매출: 100,000원
- 현금 매출: 0원
- 방문자: 0명
- 판매량: 모두 0
- 메모: 없음

**예상 결과**:
- ✅ `has_any_input()` → `True` (저장 가능)
- ✅ `has_sales_input()` → `True` (분석 시작)
- ✅ 저장 성공
- ✅ 성공 메시지: "저장 완료! 매출이 입력되어 분석이 시작됩니다."
- ✅ 홈에서 정상 코칭 진입 (기존 홈 화면 표시)

### 테스트 케이스 2: 방문자만 입력
**입력**:
- 카드 매출: 0원
- 현금 매출: 0원
- 방문자: 10명
- 판매량: 모두 0
- 메모: 없음

**예상 결과**:
- ✅ `has_any_input()` → `True` (저장 가능)
- ✅ `has_sales_input()` → `False` (분석 불가)
- ✅ 저장 성공
- ✅ 경고 메시지: "기록은 저장되었습니다 (방문자). 분석을 시작하려면 오늘 매출을 입력해 주세요."
- ✅ "💰 오늘 매출 입력하러 가기" 버튼 표시
- ✅ 홈에서 "📌 아직 매출이 입력되지 않았습니다" 카드 표시

### 테스트 케이스 3: 메모만 입력
**입력**:
- 카드 매출: 0원
- 현금 매출: 0원
- 방문자: 0명
- 판매량: 모두 0
- 메모: "오늘 특별 이벤트 진행"

**예상 결과**:
- ✅ `has_any_input()` → `True` (저장 가능)
- ✅ `has_sales_input()` → `False` (분석 불가)
- ✅ 저장 성공
- ✅ 경고 메시지: "기록은 저장되었습니다 (메모). 분석을 시작하려면 오늘 매출을 입력해 주세요."
- ✅ "💰 오늘 매출 입력하러 가기" 버튼 표시
- ✅ 홈에서 "📌 아직 매출이 입력되지 않았습니다" 카드 표시

### 테스트 케이스 4: 판매량만 입력
**입력**:
- 카드 매출: 0원
- 현금 매출: 0원
- 방문자: 0명
- 판매량: 메뉴A 5개, 나머지 0
- 메모: 없음

**예상 결과**:
- ✅ `has_any_input()` → `True` (저장 가능)
- ✅ `has_sales_input()` → `False` (분석 불가)
- ✅ 저장 성공
- ✅ 경고 메시지: "기록은 저장되었습니다 (판매량). 분석을 시작하려면 오늘 매출을 입력해 주세요."
- ✅ "💰 오늘 매출 입력하러 가기" 버튼 표시
- ✅ 홈에서 "📌 아직 매출이 입력되지 않았습니다" 카드 표시

### 테스트 케이스 5: 전부 빈 상태
**입력**:
- 카드 매출: 0원
- 현금 매출: 0원
- 방문자: 0명
- 판매량: 모두 0
- 메모: 없음

**예상 결과**:
- ✅ `has_any_input()` → `False` (저장 불가)
- ✅ 저장 차단
- ✅ 경고 메시지: "아무것도 입력되지 않았습니다. 하나만 입력해도 저장됩니다."

### 테스트 케이스 6: 매출 추가 입력 후
**시나리오**:
1. 방문자만 입력하여 저장 (케이스 2)
2. 홈에서 "📌 아직 매출이 입력되지 않았습니다" 카드 확인
3. "💰 오늘 매출 입력하기" 버튼 클릭
4. 매출 입력 (카드: 100,000원)
5. 저장

**예상 결과**:
- ✅ 저장 성공
- ✅ 성공 메시지: "저장 완료! 매출이 입력되어 분석이 시작됩니다."
- ✅ 홈 신규모드 해제, 정상 코칭 진입 (기존 홈 화면 표시)

---

## 4. UX 스크린샷 설명

### 4.1 신규 사용자 (완전 데이터 0건)

**화면 구성**:
- 메인 메시지 카드: 보라색 그라데이션 배경
  - 제목: "아직 매장 데이터가 없습니다"
  - 부제목: "오늘 상황을 하나만 입력해도 분석이 시작됩니다"
- 안내 메시지: 시작하기 안내
- 입력 버튼 2개:
  - "📝 오늘 데이터 입력하기" (Primary)
  - "📋 점장 마감하기" (Secondary)

**시각적 특징**:
- 보라색 계열 그라데이션 (#667eea → #764ba2)

### 4.2 기록만 있음 (sales=0 AND visitors/items/memo 존재)

**화면 구성**:
- 메인 메시지 카드: 주황색 그라데이션 배경 (신규와 구분)
  - 제목: "📌 아직 매출이 입력되지 않았습니다"
  - 부제목: "방문자/메모 기록은 저장되었습니다. 매출이 있어야 가게 분석과 지시가 시작됩니다."
- 안내 메시지: 다음 단계 안내
- 매출 입력 버튼:
  - "💰 오늘 매출 입력하기" (Primary, 강조)

**시각적 특징**:
- 주황색 계열 그라데이션 (#f59e0b → #d97706)
- 신규 모드와 색상으로 구분

### 4.3 매출 있음 (정상 코칭 진입)

**화면 구성**:
- 기존 홈 화면 구조 유지
- ZONE 0: 오늘의 운영 지시
- ZONE 1: 이번 달 가게 전략 요약
- ZONE 2: 문제 인식 & 빠른 진입
- ZONE 3: 오늘 상태판
- ZONE 4: 이번 주 우선순위 TOP3 (lazy)
- ZONE 5: 가게 구조 스냅샷 (lazy)

**시각적 특징**:
- 기존 홈 화면과 동일

---

## 5. 구현 세부 사항

### 5.1 has_sales_input 함수 구현

**위치**: `src/ui_helpers.py` (라인 537-555)

**로직**:
```python
def has_sales_input(card_sales, cash_sales, total_sales) -> bool:
    return card_sales > 0 or cash_sales > 0 or total_sales > 0
```

**반환값**:
- 매출이 입력되었으면 `True`
- 없으면 `False`

### 5.2 저장 후 메시지 분기

**daily_input_hub.py / manager_close.py**:
```python
has_sales = has_sales_input(card_sales, cash_sales, total_sales)

if has_sales:
    ui_flash_success("저장 완료! 매출이 입력되어 분석이 시작됩니다.")
else:
    ui_flash_warning("기록은 저장되었습니다. 분석을 시작하려면 오늘 매출을 입력해 주세요.")
    # "💰 오늘 매출 입력하러 가기" 버튼 표시
```

### 5.3 홈 중간 상태 체크

**home_page.py**:
```python
# 중간 상태 체크
has_any_records = _check_has_any_records_without_sales(store_id)

if data_level == 0:
    if has_any_records:
        _render_records_without_sales_home(store_id)  # 중간 상태
    else:
        _render_new_user_home(store_id)  # 완전 신규
```

**체크 로직**:
- `naver_visitors` 테이블에 데이터 있는지
- `v_daily_sales_items_effective` 뷰에 데이터 있는지
- `daily_close` 테이블의 `memo` 필드에 값 있는지

### 5.4 상단 고정 안내 문구 통일

**daily_input_hub.py / manager_close.py**:
```
💡 방문자·메모·판매량만 입력해도 기록은 저장됩니다.
하지만 분석과 코칭은 '매출'이 있어야 시작됩니다.
```

---

## 6. 성공 기준 달성 여부

### ✅ 1. 어떤 항목이든 하나라도 있으면 저장 가능 (기록 목적)
- [x] 매출만 입력 → 저장 성공
- [x] 방문자만 입력 → 저장 성공
- [x] 메모만 입력 → 저장 성공
- [x] 판매량만 입력 → 저장 성공

### ✅ 2. 매출이 있어야 홈/분석/코칭이 본격 활성화
- [x] 매출 있음 → 홈에서 정상 코칭 진입
- [x] 매출 없음 → 홈에서 "매출 필요" 카드 표시

### ✅ 3. 매출 없는 저장은 "기록됨 + 다음 행동 유도" UX
- [x] 저장 후 경고 메시지 표시
- [x] "💰 오늘 매출 입력하러 가기" 버튼 표시
- [x] 홈에서 "📌 아직 매출이 입력되지 않았습니다" 카드 표시

### ✅ 4. 전부 빈 상태 → 저장 차단
- [x] 전부 빈 상태 → 저장 차단 + 안내 문구

### ✅ 5. 매출 추가 입력 후 → 정상 코칭 진입
- [x] 매출 추가 입력 후 → 홈 신규모드 해제, 정상 코칭 진입

---

## 7. 다음 단계

Phase 1 STEP 2 최종이 완료되었습니다. 다음 단계는:

1. **Phase 1 STEP 3**: 매장 생성 화면 개선
   - 매장 생성 성공 시 "일일 입력" 또는 "홈" 선택 제공
   - 환영 메시지 추가

2. **Phase 1 STEP 4**: 홈 ZONE 0 신규 사용자 최적화
   - 신규 사용자일 때 "오늘 매출 입력하기" 고정
   - "오늘의 지시 TOP3" 섹션 추가

---

**작성일**: 2026-01-24  
**담당**: Phase 1 STEP 2 최종 엔지니어
