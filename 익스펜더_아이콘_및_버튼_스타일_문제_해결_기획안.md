# 익스펜더 아이콘 및 버튼 스타일 문제 해결 기획안

## 1. 문제 정의

### 1.1 현상
- **문제 A**: 익스펜더 오른쪽 끝에 "ke" 같은 영어 텍스트가 표시됨
- **문제 B**: 익스펜더 내부 버튼들의 테두리가 작아짐 (거의 보이지 않음)

### 1.2 영향 범위
- 모든 페이지의 `st.expander` 컴포넌트
- 사이드바의 "상세 선택" expander
- 메인 콘텐츠의 모든 expander

## 2. 원인 분석

### 2.1 문제 A 원인 분석 (아이콘 텍스트 표시)

#### 가설 1: Material Icons 폰트 미적용
- **증거**: `[data-testid="stIconMaterial"]` 요소에 `keyboard_arrow_right` 같은 텍스트가 그대로 표시됨
- **원인 가능성**:
  1. Material Icons 폰트가 로드되지 않음
  2. CSS 우선순위 문제로 폰트가 적용되지 않음
  3. `overflow: hidden`으로 인해 텍스트가 잘려서 "ke"만 보임
  4. `width: 24px` 제한으로 긴 텍스트가 잘림

#### 가설 2: CSS 선택자 문제
- 현재 CSS가 `[data-testid="stIconMaterial"]`를 타겟팅하지만
- Streamlit의 실제 DOM 구조와 다를 수 있음
- Emotion CSS 클래스가 동적으로 생성되어 선택자가 맞지 않을 수 있음

#### 가설 3: 폰트 로딩 타이밍 문제
- JavaScript가 실행되기 전에 DOM이 렌더링됨
- Material Icons 폰트가 로드되기 전에 텍스트가 표시됨

### 2.2 문제 B 원인 분석 (버튼 테두리 작아짐)

#### 가설 1: CSS 우선순위 문제
- `theme_manager.py`에서 버튼 스타일을 정의했지만
- Expander 내부 버튼에 대한 특정 스타일이 없음
- 전역 스타일이 expander 내부까지 적용되지 않음

#### 가설 2: Expander 내부 스타일 오버라이드
- Streamlit의 expander가 내부 요소에 자체 스타일을 적용
- 우리의 CSS가 덮어씌워지지 않음

#### 가설 3: 선택자 특이성(Specificity) 부족
- Expander 내부 버튼을 타겟팅하는 선택자가 충분히 구체적이지 않음

## 3. 해결 방안

### 3.1 문제 A 해결 방안

#### 방안 A-1: Material Icons 폰트 강제 로드 및 적용
1. **폰트 로드 보장**
   - `<head>`에 Material Icons 폰트 링크를 최우선으로 추가
   - `preload` 또는 `preconnect` 사용

2. **CSS 우선순위 강화**
   - `[data-testid="stIconMaterial"]`에 대해 더 구체적인 선택자 사용
   - `!important` 사용 (이미 사용 중이지만 더 강화)

3. **텍스트 → 아이콘 변환**
   - JavaScript로 "keyboard_arrow_right" 같은 텍스트를 찾아서
   - Material Icons 폰트가 적용된 상태로 유지

#### 방안 A-2: 아이콘 요소 숨기기 및 대체
1. 원본 아이콘 요소를 `display: none`으로 숨김
2. CSS `::after` 또는 `::before`로 아이콘 생성
3. 또는 JavaScript로 아이콘 요소를 완전히 교체

#### 방안 A-3: Streamlit 구조 정확히 파악
1. 브라우저 개발자 도구로 실제 DOM 구조 확인
2. 정확한 선택자 사용
3. Emotion CSS 클래스 패턴 파악

### 3.2 문제 B 해결 방안

#### 방안 B-1: Expander 내부 버튼 스타일 명시적 정의
```css
[data-testid="stExpander"] .stButton > button,
[data-testid="stExpander"] button {
    border: 2px solid var(--ps-border) !important;
    border-radius: 8px !important;
    /* 기타 스타일 */
}
```

#### 방안 B-2: CSS 변수 활용
- `theme_manager.py`의 CSS 변수를 expander 내부 버튼에도 적용
- 일관된 스타일 유지

#### 방안 B-3: 선택자 특이성 강화
- 더 구체적인 선택자 사용
- `[data-testid="stExpander"]` + 내부 구조 정확히 타겟팅

## 4. 실행 계획

### Phase 1: 정확한 원인 파악
1. 브라우저 개발자 도구로 실제 DOM 구조 확인
2. 문제가 있는 요소의 정확한 선택자 파악
3. CSS 적용 상태 확인 (Computed styles)

### Phase 2: Material Icons 문제 해결
1. 폰트 로드 보장 (preload 추가)
2. CSS 선택자 정확화
3. JavaScript로 동적 수정 (필요시)

### Phase 3: 버튼 스타일 문제 해결
1. Expander 내부 버튼 선택자 정확화
2. 테두리 스타일 명시적 정의
3. CSS 변수 일관성 유지

### Phase 4: 테스트 및 검증
1. 모든 페이지에서 expander 확인
2. 다양한 expander 상태 (열림/닫힘) 테스트
3. 버튼 스타일 일관성 확인

## 5. 우선순위

1. **최우선**: 문제 A 해결 (아이콘 텍스트 표시)
   - 사용자 경험에 직접적 영향
   - 모든 페이지에서 발생

2. **중요**: 문제 B 해결 (버튼 테두리)
   - 가독성 및 사용성 향상
   - 일관된 디자인 유지

## 6. 예상 부작용 및 대응

### 부작용 1: 다른 아이콘에 영향
- **대응**: 선택자를 더 구체적으로 제한

### 부작용 2: 성능 저하
- **대응**: JavaScript 최적화, CSS 우선 활용

### 부작용 3: Streamlit 업데이트 시 호환성
- **대응**: 표준 선택자 사용, 테스트 강화

## 7. 체크리스트

- [ ] 브라우저 개발자 도구로 실제 DOM 구조 확인
- [ ] Material Icons 폰트 로드 상태 확인
- [ ] CSS 선택자 정확성 검증
- [ ] Expander 내부 버튼 선택자 확인
- [ ] 모든 페이지에서 테스트
- [ ] 다양한 브라우저에서 테스트
