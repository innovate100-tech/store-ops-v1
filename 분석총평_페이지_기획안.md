# 분석총평 페이지 기획안

**작성 일자**: 2026-01-24  
**목적**: "매출 하락 원인 찾기" 페이지를 **분석총평**으로 이름 변경 후, **기존 내용 전부 제거**하고,  
**분석 카테고리 세부 페이지들의 고도화된 자료**를 **복합·고도화 분석**하여 **최종 분석자료 + 해석**을 제공하는 페이지로 재기획

---

## 1. 이름 변경 및 제거 대상

### 1.1 이름 변경

| 기존 | 변경 후 |
|------|---------|
| 매출 하락 원인 찾기 | **분석총평** |

- **앱 내**: 페이지/라우트 `page_key` → **"분석총평"**  
- 사이드바·분석허브·전략카드·홈·가게설계센터·evidence_builder 등 모든 노출처 → **"분석총평"**으로 통일

### 1.2 제거 대상

- **매출 하락 원인 찾기** 페이지의 **기존 내용 전부** 제거  
  - 3단 플로우: "언제부터 떨어졌나? → 무엇이 떨어졌나? → 어디를 고치나?"  
  - `_analyze_when_dropped`, `_analyze_what_dropped`, `_suggest_fixes` 등 관련 로직  
  - `sales_drop_oneclick.py` / `sales_drop_investigation.py` 기반 UI·데이터·플로우  
- **기존 페이지**는 **삭제**하거나 **deprecated** 처리 후, **분석총평** 전용 모듈로 교체

---

## 2. 분석총평의 역할

### 2.1 정체성

- **단일 요약 페이지**: 분석 카테고리 **세부 페이지들의 결과**를 **한 번 더 복합·고도화**하여,  
  **최종 분석자료**와 **해석(인사이트)**을 한곳에 모아 보여주는 페이지
- **입력**: 각 세부 분석 페이지가 산출하는 **고도화된 지표·표·차트·인사이트** (또는 이를 재생성하는 **동일 데이터·함수**)
- **출력**: **복합 분석 결과** + **통합 해석** + **우선순위 액션** + **세부 페이지로의 링크**

### 2.2 세부 분석 페이지 정리 (입력 소스)

| 페이지 | page_key | 고도화된 핵심 산출물 (요약) |
|--------|----------|-----------------------------|
| 매출 분석 | 매출 관리 | 손익분기·목표 달성 일수, 일자별 손익표, 요일별 패턴, 트렌드, 시뮬레이션, 민감도, 자동 진단·액션 |
| 비용 분석 | 비용 분석 | 5대 비용 상세, 비용 구조, 목표 vs 실제, 매출수준별 시뮬레이션, 재료 사용량 연계, 최적화 시뮬레이션 |
| 실제정산 분석 | 실제정산 분석 | 목표 vs 실제 성적표, 5대 비용 실제 구성, 월별 트렌드, 인사이트·액션 |
| 원가 분석 | 원가 파악 | 메뉴별 원가/원가율, ABC 분석, 원가 기여도·공헌이익, 원가 최적화 시뮬레이션 |
| 재고 분석 | 재고 분석 | 재고가치·회전율, 품절/과다, 안전재고 vs 현재고, 예측·시뮬레이션, 최적화 액션 |
| 재료 사용량 | 재료 사용량 집계 | 사용량 트렌드, 메뉴별 기여도, 재료 효율성, 예측·재고 연계, 액션 |
| 판매·메뉴 분석 | 판매 관리 | 메뉴 트렌드, 포트폴리오, 수익성·가격 시뮬레이션, 계절성, 액션 |
| QSC 결과분석 | 체크결과 | 9축 점수, Top3 리스크·권장 액션, 아니요·애매해요 질문, 체크 히스토리 |

---

## 3. 복합·고도화 분석 체계

### 3.1 원칙

- **재계산 권장**: 분석총평 전용 **헬퍼/서비스**에서, 세부 페이지와 **동일한 데이터·함수**를 사용해 **동일 지표**를 다시 계산  
  → 세부 페이지 UI 변경에 덜 의존하고, **총평 전용 가공**만 추가
- **통합 해석**: 매출·비용·실제정산·원가·재고·재료·메뉴·QSC **도메인 간 관계**를 반영한 **한 줄~몇 줄 해석** 도출
- **우선순위**: **리스크·기회** 크기와 **실행 용이성**을 고려해 **액션 우선순위** 제시

### 3.2 복합 분석 축 (도메인 간 연결)

| 연결 | 설명 | 예시 해석 |
|------|------|-----------|
| **매출 ↔ 비용** | 손익분기·목표 달성 vs 5대 비용 구조 | "고정비 비중이 높아 손익분기점이 높습니다. 매출 회복이 우선입니다." |
| **매출 ↔ 실제정산** | 목표 vs 실제 매출·비용·순이익 | "실제정산 기준 순이익이 목표 대비 -15%입니다. 인건비·재료비 초과가 원인입니다." |
| **비용 ↔ 실제정산** | 목표 비용 vs 실제 비용 (5대 비용) | "재료비가 목표 대비 +3%p 초과했습니다. 원가·재료 사용량을 확인하세요." |
| **원가 ↔ 재료 사용량 ↔ 재고** | 원가율·사용량·재고 효율 | "원가율 상위 메뉴의 주력 재료 사용량이 급증했습니다. 재고 리스크와 원가 압박이 동시에 있습니다." |
| **판매·메뉴 ↔ 원가** | 메뉴별 매출 기여 vs 원가·공헌이익 | "공헌이익 1위 메뉴의 원가율이 올라 수익성이 악화되고 있습니다." |
| **QSC ↔ 매출·메뉴** | 9축·리스크 vs 매출 트렌드·메뉴 성과 | "마케팅(M) 축이 낮고, 메뉴 신규 유입이 부족합니다. 마케팅 액션과 메뉴 기획을 함께 보세요." |

---

## 4. 분석총평 페이지 구조 (ZONE)

### 4.1 ZONE A: 총평 헤더 + 한눈에 요약

- **헤더**: "분석총평" 타이틀, **이번 달(또는 선택 기간)** 기준  
- **한눈에 요약** (카드 4~6개):
  - **매출·손익**: 당월 매출, 손익분기 대비, 목표 대비, 평균 일별 영업이익 (매출 분석)
  - **비용·실제정산**: 5대 비용 목표 vs 실제 요약, 순이익 차이 (비용·실제정산 분석)
  - **원가·재고·재료**: 원가율 위험 메뉴 수, 품절 위험 재고 수, 사용량 급증 재료 수 (원가·재고·재료)
  - **메뉴·QSC**: 판매 메뉴 포트폴리오 균형도, QSC Top 리스크 1개 (메뉴·체크결과)
- **통합 해석 1~3줄**: 위 요약을 묶은 **총평 문장** (예: "매출은 손익분기 이상이나 목표 미달. 비용은 재료비 초과가 두드러지며, 재고·원가에서 압박이 있습니다.")

### 4.2 ZONE B: 도메인별 핵심 지표 + 해석

- **도메인별** (매출 / 비용 / 실제정산 / 원가 / 재고 / 재료 / 메뉴 / QSC) **탭 또는 아코디언**
- 각 도메인:
  - **핵심 지표 3~5개**: 해당 세부 페이지 고도화 자료에서 추린 **대표 지표** (숫자·등급)
  - **해석 1~3줄**: 해당 도메인만의 **인사이트** (세부 페이지와 동일 or 총평용 요약)
  - **자세히 보기**: 해당 **세부 페이지**(page_key)로 이동하는 버튼

### 4.3 ZONE C: 복합 인사이트 (도메인 간)

- **복합 분석 축** (섹션 3.2) 기반 **복합 인사이트** 3~5개
- 각 항목: **주제** (예: "매출–비용 구조") + **해석 1~3줄** + **(선택) 관련 세부 페이지 링크**
- **데이터 부족** 시 해당 연결은 "데이터 부족" 등으로 표시하고 생략 가능

### 4.4 ZONE D: 우선순위 액션 + 링크

- **우선순위 액션** 5~10개:  
  매출·비용·실제정산·원가·재고·재료·메뉴·QSC 각 세부 페이지의 **액션 아이템**을 모아  
  **중복 제거** 후 **우선순위**(리스크·영향도·실행 용이성)로 정렬
- 각 액션: **설명 1줄** + **실행 페이지**(page_key) **바로가기**  
  (예: "재료비 목표 대비 초과 → 비용 분석", "품절 위험 재고 발주 검토 → 재고 분석")

### 4.5 ZONE E: 요약 자료 내보내기 (선택)

- **총평 요약** (ZONE A+B+C+D 핵심만) **텍스트** or **간단 표** 형태로 **다운로드**  
  (예: PDF, TXT, CSV 중 앱에서 지원하는 형식)

---

## 5. 데이터·함수

### 5.1 데이터 소스

- 세부 분석 페이지와 **동일**:  
  `load_monthly_sales_total`, `load_best_available_daily_sales`, `get_fixed_costs`, `get_variable_cost_ratio`,  
  `calculate_break_even_sales`, `load_expense_structure`, `load_actual_settlement_items`,  
  `load_csv` (targets, 메뉴·레시피·재료·재고 등), `get_health_diagnosis` 등  
- **추가**: 세부 페이지에서 쓰는 **집계·진단 함수** (예: 매출 분석의 `_diagnose`, 비용 분석의 5대 비용 집계, 재고 분석의 품절/과다 카운트 등)를 **공용**으로 두거나 **총평 전용 래퍼**로 호출  
- **참고**: `매출 관리`(매출 분석)와 `판매 관리`(판매·메뉴 분석)는 **서로 다른 페이지**이며, 각각 `ui_pages/analysis/sales_analysis.py`, `ui_pages/sales_analysis.py`에서 렌더링됨. 총평에서는 **둘 다** 요약 반영

### 5.2 총평 전용 함수 (예시)

| 함수 | 역할 |
|------|------|
| `_summary_sales(store_id, year, month)` | 매출·손익분기·목표 대비 등 요약 지표 |
| `_summary_costs(store_id, year, month)` | 5대 비용 목표 vs 실제 요약 |
| `_summary_settlement(store_id, year, month)` | 실제정산 목표 vs 실제 요약 |
| `_summary_cost_overview(store_id, ...)` | 원가 위험 메뉴 수, ABC 요약 |
| `_summary_inventory(store_id)` | 재고가치, 품절/과다 수 |
| `_summary_usage(store_id, ...)` | 재료 사용량 트렌드·급증 요약 |
| `_summary_menu(store_id, ...)` | 메뉴 포트폴리오·수익성 요약 |
| `_summary_qsc(store_id)` | QSC Top 리스크·액션 요약 |
| `_composite_insights(...)` | 도메인 간 복합 인사이트 생성 |
| `_prioritized_actions(...)` | 액션 통합·우선순위 정렬 |

---

## 6. UI/UX 요약

- **페이지 제목**: "분석총평"
- **기간**: 기본 **이번 달** (연·월 선택 가능하도록 확장 여지)
- **구성**: ZONE A(총평 요약) → B(도메인별 지표·해석) → C(복합 인사이트) → D(우선순위 액션) → E(내보내기, 선택)
- **네비게이션**: 각 ZONE에서 **세부 페이지**로 이동하는 **자세히 보기** / **실행하기** 등 CTA 유지
- **Empty**: 데이터 전반 부족 시 "입력된 데이터가 부족합니다. 매출·비용·실제정산 등을 입력한 뒤 다시 확인해주세요." + **입력 페이지** 링크

---

## 7. 제거·변경 대상

### 7.1 제거

- **매출 하락 원인 찾기** 페이지 **전체 UI·플로우** 및 **전용 로직**  
  (`_analyze_when_dropped`, `_analyze_what_dropped`, `_suggest_fixes` 등)

### 7.2 변경

- **라우팅**: `page == "매출 하락 원인 찾기"` → `page == "분석총평"`  
- **렌더링**: 기존 `render_sales_drop_oneclick` / `render_sales_drop_investigation` 호출 제거 → **`render_analysis_summary`** (또는 동일 역할 함수) 호출
- **분석허브·사이드바·전략카드·홈·가게설계센터·evidence_builder·strategy_engine·roadmap·action_plan_engine** 등  
  **"매출 하락 원인 찾기"** 링크/버튼/카드 → **"분석총평"**으로 통일
- **sales_analysis** (판매 메뉴 분석) 등에 있는 **"매출 하락 원인 찾기"** 버튼 → **"분석총평"**으로 변경 (또는 기획에 따라 제거)

---

## 8. 구현 순서 제안

| 단계 | 작업 |
|------|------|
| 1 | `분석총평` 페이지 모듈 생성, `render_analysis_summary` 골격 구현 |
| 2 | ZONE A: 총평 헤더 + 한눈에 요약 카드 + 통합 해석 1~3줄 |
| 3 | ZONE B: 도메인별 핵심 지표·해석·자세히 보기 (매출→비용→실제정산→원가→재고→재료→메뉴→QSC) |
| 4 | ZONE C: 복합 인사이트 (도메인 간) 3~5개 |
| 5 | ZONE D: 우선순위 액션 통합·정렬 + 세부 페이지 링크 |
| 6 | ZONE E: 요약 내보내기 (선택) |
| 7 | 라우팅·메뉴·CTA: "매출 하락 원인 찾기" → "분석총평" 전면 교체 |
| 8 | 기존 매출 하락 원인 찾기 전용 코드 제거 또는 deprecated 처리 |

---

## 9. 기대 효과

- **한 페이지**에서 **전체 분석 결과**의 **총평**과 **해석**을 확인 가능  
- **도메인 간 연결** (매출–비용, 실제정산–원가, 재고–재료 등)을 반영한 **복합 인사이트** 제공  
- **우선순위 액션**으로 **실행 포인트** 명확화, 세부 분석 페이지로 **직접 이동** 가능  
- **매출 하락**에 한정하지 않고 **전반적인 경영 상황**을 요약·해석하는 **통합 뷰** 역할

---

## 10. 정리

- **이름**: 매출 하락 원인 찾기 → **분석총평**  
- **내용**: 기존 3단 플로우 **전부 제거** → **세부 분석 고도화 자료** 기반 **복합·고도화 분석** + **최종 자료·해석** 페이지로 **재기획**  
- **구조**: ZONE A(총평 요약) ~ E(내보내기), 도메인별 지표·복합 인사이트·우선순위 액션·세부 페이지 링크  
- **라우팅·메뉴**: **분석총평** 단일 진입점으로 정리

---

**작성일**: 2026-01-24  
**참고**: `ui_pages/analysis/`, `ui_pages/diagnostics/sales_drop_oneclick.py`, `app.py` 라우팅·메뉴,  
매출·비용·실제정산·원가·재고·재료·판매메뉴·체크결과 고도화 기획안
