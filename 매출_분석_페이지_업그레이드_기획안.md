# 매출 분석 페이지 업그레이드 기획안

**작성 일자**: 2026-01-24  
**목적**: 매출 분석 페이지를 분석 허브 패턴에 맞춰 재구성 및 기능 강화

---

## 📋 개요

현재 매출 분석 페이지(`sales_management.py`)는 다양한 기능이 있으나, 구조가 복잡하고 분석 허브의 패턴과 일관성이 부족합니다.  
**비용 분석**, **실제정산 분석** 페이지의 구조를 참고하여 **명확한 ZONE 구분**과 **핵심 지표 우선 노출** 방식으로 재구성합니다.

---

## 1. 현재 상태 분석

### 1.1 현재 매출 분석 페이지 구성

| 섹션 | 내용 | 비고 |
|------|------|------|
| 상단 CTA | 매출 하락 원인 찾기 버튼 | 유지 |
| 매출 새로고침 | 캐시 무효화 버튼 | 유지 |
| 목표 vs 실제 | 목표 매출, 현재 누적, 달성률 | 개선 필요 |
| 일별 매출 추이 | 라인 차트 | 개선 필요 |
| 주간 집계 | 주별 매출 요약 | 개선 필요 |
| 월간 집계 | 월별 매출 요약 | 개선 필요 |
| 방문자 분석 | 방문자 수, 상관관계 | 유지 |
| 예상 매출 | 예측 및 목표 달성 가능성 | 개선 필요 |

### 1.2 개선 포인트

- **구조**: 섹션 구분이 불명확, 정보 밀도 높음
- **우선순위**: 핵심 지표가 여러 섹션에 분산
- **일관성**: 다른 분석 페이지(비용, 실제정산)와 구조 차이
- **시각화**: 차트가 많아 핵심 파악 어려움

---

## 2. 업그레이드 목표

### 2.1 구조 개선

- **ZONE 기반 명확한 구분**: 핵심 지표 → 목표 vs 실제 → 트렌드 → 상세 분석
- **핵심 지표 우선 노출**: 상단에 가장 중요한 숫자 4~6개 카드로 표시
- **다른 분석 페이지와 일관성**: 비용 분석, 실제정산 분석과 동일한 패턴

### 2.2 기능 강화

- **목표 vs 실제 비교 강화**: 달성률, 차이, 등급 표시
- **트렌드 분석 고도화**: 일별, 주간, 월간 통합 뷰
- **예측 기능 개선**: 목표 달성 가능성, 필요 일평균 강조
- **인사이트 제공**: 자동 분석 및 개선 제안

---

## 3. 새로운 페이지 구조

### 3.1 ZONE A: 핵심 지표 (상단)

**목적**: 로그인 후 매출 분석 페이지만 봐도 "이번 달 핵심 숫자"가 바로 보이게.

| # | 지표 | 설명 | 데이터 소스 |
|---|------|------|-------------|
| 1 | **이번 달 누적 매출** | 현재까지 누적 매출 | `load_monthly_sales_total` |
| 2 | **목표 대비 달성률** | 목표 매출 대비 % | `targets.csv`, `monthly_sales` |
| 3 | **일평균 매출** | 이번 달 일평균 | `monthly_sales / 현재일` |
| 4 | **필요 일평균** | 목표 달성 위해 필요한 일평균 | `(목표 - 현재) / 남은일수` |
| 5 | **예상 월 매출** | 현재 추세 기반 예상 | 기존 `forecast_sales` 로직 |
| 6 | **전월 대비** | 전월 대비 증감률 | 전월 `monthly_sales` |

**UI 형태**:
- 3×2 또는 2×3 그리드
- 각 카드: `st.metric` 또는 커스텀 카드 (비용 분석 스타일)
- 색상 코딩: 달성률 100% 이상 → 초록, 80% 이상 → 노랑, 미만 → 빨강

### 3.2 ZONE B: 목표 vs 실제 상세

**목적**: 목표와 실제를 명확히 비교하고, 차이와 원인을 파악.

#### B-1: 목표 vs 실제 요약 카드
- 목표 매출 vs 실제 매출 (차이 금액, %)
- 목표 달성률 (진행 바, 등급)
- 남은 기간, 남은 목표 금액

#### B-2: 일별 매출 vs 목표 추이
- 라인 차트: 일별 실제 매출 + 목표 일평균 라인
- 목표 달성 일수 vs 미달성 일수
- 최고 매출일, 최저 매출일 표시

#### B-3: 주간 집계 비교
- 주별 매출 vs 주별 목표
- 주간 달성률 랭킹 (1주차, 2주차, ...)
- 주간 평균 vs 목표 주평균

### 3.3 ZONE C: 트렌드 분석

**목적**: 시간 흐름에 따른 매출 패턴 파악.

#### C-1: 일별 매출 추이 (이번 달)
- 라인 차트: 일별 총매출
- 평일/주말 구분 (색상 다르게)
- 평균선 표시

#### C-2: 주간 트렌드 (최근 4주)
- 주별 매출 비교 (바 차트)
- 주간 증감률
- 주간 평균 매출

#### C-3: 월간 트렌드 (최근 6개월)
- 월별 매출 비교 (바 차트)
- 월간 증감률
- 월간 평균 매출

### 3.4 ZONE D: 상세 분석

**목적**: 세부 분석 및 인사이트 제공.

#### D-1: 방문자 분석
- 방문자 수 vs 매출 상관관계
- 객단가 (매출 / 방문자)
- 방문자당 매출 추이

#### D-2: 결제 수단 분석
- 카드 vs 현금 비율
- 결제 수단별 매출 추이
- 결제 수단별 평균 거래액

#### D-3: 예측 및 목표 달성 가능성
- 현재 추세 기반 예상 월 매출
- 목표 달성 가능성 (%)
- 필요 일평균 매출
- 목표 달성을 위한 액션 아이템

#### D-4: 인사이트 (자동 분석)
- 매출 하락 요일/시간대
- 목표 달성 난이도 평가
- 개선 제안 (예: "주말 매출이 목표 대비 낮습니다")

---

## 4. UI/UX 개선

### 4.1 페이지 헤더

```
📊 매출 분석
```

**설명 문구**:
> "매출은 가게의 생명줄입니다. 목표를 달성하기 위해 매일 확인하세요."

### 4.2 기간 선택

- **기본**: 현재 월 (이번 달)
- **선택 가능**: 연도/월 선택 (비용 분석, 실제정산 분석과 동일)
- **위치**: 상단, ZONE A 바로 아래

### 4.3 섹션 구분

- `render_section_header()` 사용 (다른 분석 페이지와 일관성)
- `render_section_divider()` 사용
- 각 ZONE 명확히 구분

### 4.4 차트 개선

- **일별 추이**: Streamlit `line_chart` 또는 `st.plotly_chart` (인터랙티브)
- **주간/월간**: `bar_chart` 또는 `st.plotly_chart`
- **목표 vs 실제**: 이중 축 차트 (실제 매출 + 목표 라인)

### 4.5 액션 버튼

- **매출 하락 원인 찾기**: 상단 CTA 유지 (분석 허브에서도 접근 가능)
- **매출 새로고침**: 상단 우측 작은 버튼
- **목표 설정**: 목표가 없을 때 "목표 매출구조 입력으로 이동" 버튼

---

## 5. 데이터 로딩 및 계산

### 5.1 필수 데이터

| 데이터 | 소스 | 용도 |
|--------|------|------|
| 일별 매출 | `load_best_available_daily_sales()` | 일별 추이, 누적 계산 |
| 목표 매출 | `targets.csv` | 목표 vs 실제 비교 |
| 방문자 수 | `naver_visitors.csv` | 방문자 분석 |
| 전월 매출 | `load_monthly_sales_total()` (전월) | 전월 대비 |

### 5.2 계산 로직

- **일평균 매출**: `누적 매출 / 현재일`
- **필요 일평균**: `(목표 매출 - 누적 매출) / 남은일수`
- **예상 월 매출**: 기존 `forecast_sales` 로직 재사용
- **목표 달성률**: `(누적 매출 / 목표 매출) * 100`
- **전월 대비**: `((이번 달 - 전월) / 전월) * 100`

### 5.3 에러 처리

- 데이터 없을 때: "—", "입력 후 표시" 등 안전 처리
- 목표 미설정: "목표 매출구조 입력으로 이동" 안내
- 매출 데이터 없음: "일일 마감 입력" 안내

---

## 6. 구현 스펙

### 6.1 파일 구조

```
ui_pages/analysis/sales_analysis.py  (신규 또는 기존 sales_management.py 리팩토링)
```

### 6.2 함수 구조

```python
def render_sales_analysis():
    """매출 분석 페이지 렌더링"""
    # 헤더
    # 기간 선택
    # ZONE A: 핵심 지표
    # ZONE B: 목표 vs 실제
    # ZONE C: 트렌드 분석
    # ZONE D: 상세 분석

def _render_key_metrics(year, month, store_id):
    """ZONE A: 핵심 지표 카드"""
    
def _render_target_vs_actual(year, month, store_id):
    """ZONE B: 목표 vs 실제"""
    
def _render_trends(year, month, store_id):
    """ZONE C: 트렌드 분석"""
    
def _render_detailed_analysis(year, month, store_id):
    """ZONE D: 상세 분석"""
```

### 6.3 app.py 라우팅

- 기존: `page == "매출 관리"` → `render_sales_management()`
- 변경: `page == "매출 관리"` → `render_sales_analysis()` (또는 기존 함수 리팩토링)

---

## 7. 구현 순서

| 단계 | 작업 | 비고 |
|------|------|------|
| 1 | **ZONE A: 핵심 지표** | 6개 메트릭 카드 구현 |
| 2 | **ZONE B: 목표 vs 실제** | 목표 vs 실제 비교, 일별 추이 차트 |
| 3 | **ZONE C: 트렌드 분석** | 일별/주간/월간 트렌드 차트 |
| 4 | **ZONE D: 상세 분석** | 방문자, 결제수단, 예측, 인사이트 |
| 5 | **UI/UX 개선** | 섹션 헤더, 구분선, 액션 버튼 |
| 6 | **에러 처리** | 데이터 없을 때 안전 처리 |

---

## 8. 기대 효과

### 8.1 사용자 경험

- **핵심 파악 속도 향상**: 상단 6개 카드로 즉시 파악
- **목표 달성 의식 강화**: 목표 vs 실제 비교가 명확
- **트렌드 파악 용이**: 일별/주간/월간 통합 뷰

### 8.2 일관성

- **다른 분석 페이지와 구조 통일**: 비용 분석, 실제정산 분석과 동일 패턴
- **분석 허브와 연계**: 분석 허브의 "매출" 카드와 일관된 정보 제공

### 8.3 유지보수

- **명확한 ZONE 구분**: 코드 구조가 명확해 유지보수 용이
- **재사용 가능한 함수**: 각 ZONE을 독립 함수로 분리

---

## 9. 참고 사항

### 9.1 기존 기능 유지

- 매출 하락 원인 찾기 버튼 (상단 CTA)
- 매출 새로고침 기능
- 방문자 분석 (상관관계)
- 예상 매출 계산

### 9.2 제거/통합 고려

- 중복되는 차트 통합
- 불필요한 섹션 제거
- 정보 밀도 조정

### 9.3 확장 가능성

- **알림 기능**: 목표 달성률이 낮을 때 경고
- **자동 리포트**: 주간/월간 리포트 자동 생성
- **비교 분석**: 동일 업종 평균과 비교

---

## 10. 정리

### 핵심 원칙

1. **핵심 지표 우선**: 상단에 가장 중요한 숫자 6개
2. **명확한 구조**: ZONE A → B → C → D 순서
3. **일관성**: 다른 분석 페이지와 동일 패턴
4. **실용성**: 목표 달성에 도움이 되는 정보 중심

### 다음 단계

1. 기획안 검토 및 승인
2. ZONE A부터 순차 구현
3. 각 ZONE별 테스트
4. 전체 통합 테스트
5. 사용자 피드백 반영

---

**작성일**: 2026-01-24  
**참고**: 
- `분석_카테고리_업그레이드_기획안.md`
- `ui_pages/analysis/cost_analysis.py`
- `ui_pages/analysis/settlement_analysis.py`
- `ui_pages/sales_management.py` (현재 구현)
