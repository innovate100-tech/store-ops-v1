# 재고 분석 페이지 기획안

**작업 일자**: 2026-01-24  
**목적**: 발주 페이지 삭제 및 재고 분석 페이지로 대체

---

## 🎯 배경 및 목적

### 현재 발주 페이지의 문제점
1. ❌ **발주 자동화 연동 불가**: 실제 발주 시스템과 연동되지 않음
2. ❌ **입고 확인 연동 불가**: 입고 확인 기능이 실제 시스템과 연동되지 않음
3. ❌ **실제 사용 불가**: 사장님이 실제로 발주를 관리할 수 있는 기능이 없음
4. ❌ **복잡한 구조**: 여러 탭으로 나뉘어 있지만 대부분 "재기획 중" 상태

### 개선 방향
- **발주 페이지 완전 삭제**
- **재고 분석 페이지 신설**: 안전재고와 현재고 차이를 한눈에 파악
- **발주 필요량 자동 계산**: 얼마나 발주해야 하는지 명확히 표시
- **분석 카테고리에 배치**: "재고 분석" 또는 "발주 분석"으로 이름 변경

---

## 📋 재고 분석 페이지 기획안

### 페이지 위치
- **카테고리**: 분석 (Analysis)
- **페이지명**: "재고 분석" 또는 "발주 분석"
- **아이콘**: 📊 또는 🛒

### 핵심 목적
1. **재고 현황 한눈에 파악**: 안전재고 vs 현재고 비교
2. **발주 필요량 자동 계산**: 얼마나 발주해야 하는지 명확히 표시
3. **우선순위 표시**: 긴급도에 따른 발주 우선순위
4. **예상 비용 계산**: 발주 시 예상 비용 표시

---

## 🚀 페이지 구조: 4-Zone 구조

### **ZONE A: 대시보드 & 핵심 지표**
**목적**: 전체 재고 현황을 한눈에 파악

#### 구성 요소
1. **핵심 지표 카드 (4열)**
   - 발주 필요 재료 수 (현재고 < 안전재고)
   - 긴급 발주 필요 수 (현재고 < 안전재고 × 0.5)
   - 주의 재고 수 (안전재고 × 0.5 ≤ 현재고 < 안전재고)
   - 정상 재고 수 (현재고 ≥ 안전재고)

2. **예상 발주 비용**
   - 총 예상 발주 비용 (발주 필요 재료의 예상 금액 합계)
   - 평균 재고 회전율 (최근 7일 기준)

3. **스마트 알림**
   - 긴급 발주 필요 재료가 있으면 경고 표시
   - 발주 필요 재료가 많으면 안내 표시

---

### **ZONE B: 발주 필요량 분석 (핵심)**
**목적**: 발주가 필요한 재료와 발주량을 명확히 표시

#### 테이블 구조
**컬럼 구성**:
1. **재료명** (읽기 전용)
2. **재료 분류** (읽기 전용, 뱃지)
3. **단위** (읽기 전용, 기본 단위 / 발주 단위)
4. **현재고** (발주 단위로 표시)
5. **안전재고** (발주 단위로 표시)
6. **부족량** (안전재고 - 현재고, 발주 단위)
7. **예상소요량** (최근 7일 평균 × 예측일수, 발주 단위)
8. **발주 필요량** (부족량 + 예상소요량, 발주 단위)
9. **예상 금액** (발주 필요량 × 단가)
10. **우선순위** (긴급/높음/보통/낮음, 색상 뱃지)
11. **상태** (긴급/주의/정상, 색상 뱃지)

#### 필터 & 정렬
- **필터 옵션**:
  - 재료 분류 필터
  - 우선순위 필터 (긴급/높음/보통/낮음)
  - 상태 필터 (긴급/주의/정상)
  - 검색 (재료명)
- **정렬 옵션**:
  - 발주 필요량 (내림차순, 기본)
  - 예상 금액 (내림차순)
  - 우선순위 (긴급 → 낮음)
  - 재료명 (오름차순)

#### 계산 로직
1. **부족량 계산**:
   - `부족량 = max(0, 안전재고 - 현재고)`
   - 발주 단위로 표시

2. **예상소요량 계산**:
   - `예상소요량 = 최근 7일 평균 사용량 × 예측일수 (3일)`
   - 사용량 데이터가 없으면 0

3. **발주 필요량 계산**:
   - `발주 필요량 = 부족량 + 예상소요량`
   - 발주 단위로 표시

4. **우선순위 계산**:
   - **긴급**: 현재고 < 안전재고 × 0.5
   - **높음**: 안전재고 × 0.5 ≤ 현재고 < 안전재고 × 0.8
   - **보통**: 안전재고 × 0.8 ≤ 현재고 < 안전재고
   - **낮음**: 현재고 ≥ 안전재고 (예상소요량만 고려)

---

### **ZONE C: 재고 현황 분석**
**목적**: 재고 상태를 시각적으로 분석

#### 구성 요소
1. **재고 상태 분포 차트**
   - 파이 차트: 정상/주의/부족 비율
   - 바 차트: 재료별 현재고 vs 안전재고 비교

2. **재고 회전율 분석**
   - 최근 7일 평균 사용량 TOP 10
   - 재고 회전율이 높은 재료 (사용량 / 현재고)

3. **과다재고 경고**
   - 현재고 > 안전재고 × 2인 재료
   - 재고 회전율이 낮은 재료

---

### **ZONE D: 발주 내보내기 & 액션**
**목적**: 발주 정보를 외부로 내보내기

#### 구성 요소
1. **CSV 내보내기**
   - 발주 필요 재료 목록을 CSV로 다운로드
   - 컬럼: 재료명, 발주단위, 발주필요량, 예상금액, 우선순위

2. **발주 리스트 생성**
   - 선택한 재료만 발주 리스트로 생성
   - 체크박스로 선택 가능

3. **연계 페이지**
   - 📦 재고 입력으로 이동 (재고 정보 수정)
   - 🧺 사용 재료 입력으로 이동 (재료 정보 수정)

---

## 🎨 UI/UX 디자인

### 색상 체계
- **긴급** (빨간색): #EF4444
- **높음** (주황색): #F97316
- **보통** (노란색): #F59E0B
- **낮음** (초록색): #22C55E
- **정상** (초록색): #22C55E
- **주의** (노란색): #F59E0B
- **부족** (빨간색): #EF4444

### 레이아웃
```
┌─────────────────────────────────────────┐
│ ZONE A: 대시보드 & 핵심 지표            │
│ [지표 카드 4개] [예상 발주 비용] [알림] │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│ 필터 & 검색 (고정)                      │
│ [분류] [우선순위] [상태] [검색] [정렬]  │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│ ZONE B: 발주 필요량 분석 (핵심)         │
│ ┌─────────────────────────────────────┐ │
│ │ 재료명│분류│단위│현재고│안전│부족│...│ │
│ │ ...  │... │...│ ... │ ...│...│...│ │
│ └─────────────────────────────────────┘ │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│ ZONE C: 재고 현황 분석                  │
│ [차트 2개] [회전율 TOP 10] [과다재고]   │
└─────────────────────────────────────────┘
┌─────────────────────────────────────────┐
│ ZONE D: 발주 내보내기 & 액션            │
│ [CSV 다운로드] [발주 리스트] [연계 페이지]│
└─────────────────────────────────────────┘
```

---

## 🔄 데이터 흐름

### 1. 데이터 로드
1. 재료 마스터 로드 (재료명, 단위, 단가, 발주단위, 변환비율)
2. 재고 정보 로드 (재료명, 현재고, 안전재고)
3. 레시피 로드 (재료 사용량 계산용)
4. 일일 판매량 로드 (재료 사용량 계산용)

### 2. 발주 필요량 계산
1. `calculate_order_recommendation()` 함수 사용
2. 부족량, 예상소요량, 발주 필요량 계산
3. 우선순위 계산
4. 예상 금액 계산

### 3. 시각화
1. 재고 상태 분포 차트 생성
2. 재고 회전율 분석
3. 과다재고 경고 표시

---

## 📊 주요 기능 상세

### 1. 발주 필요량 계산
- **부족량**: `max(0, 안전재고 - 현재고)`
- **예상소요량**: `최근 7일 평균 사용량 × 3일`
- **발주 필요량**: `부족량 + 예상소요량`
- **예상 금액**: `발주 필요량 × 단가`

### 2. 우선순위 계산
- **긴급**: 현재고 < 안전재고 × 0.5
- **높음**: 안전재고 × 0.5 ≤ 현재고 < 안전재고 × 0.8
- **보통**: 안전재고 × 0.8 ≤ 현재고 < 안전재고
- **낮음**: 현재고 ≥ 안전재고

### 3. 재고 회전율 계산
- **재고 회전율**: `최근 7일 평균 사용량 / 현재고`
- 회전율이 높을수록 재고가 빠르게 소진됨

### 4. 과다재고 경고
- **과다재고 기준**: 현재고 > 안전재고 × 2
- **낮은 회전율**: 재고 회전율 < 0.1 (10일 이상 소진 예상)

---

## 🔧 구현 상세

### 사용할 함수
- `calculate_order_recommendation()`: 발주 추천 계산 (이미 구현됨)
- `calculate_ingredient_usage()`: 재료 사용량 계산 (이미 구현됨)

### 데이터 구조
```python
# 발주 필요량 분석 결과
order_analysis_df = pd.DataFrame({
    '재료명': ingredient_names,
    '재료분류': categories,
    '단위': units,
    '발주단위': order_units,
    '현재고': current_stocks,  # 발주 단위
    '안전재고': safety_stocks,  # 발주 단위
    '부족량': shortage_amounts,  # 발주 단위
    '예상소요량': expected_usage,  # 발주 단위
    '발주필요량': order_amounts,  # 발주 단위
    '예상금액': expected_costs,
    '우선순위': priorities,
    '상태': statuses
})
```

---

## 🚀 구현 체크리스트

### ZONE A: 대시보드 & 핵심 지표
- [ ] 핵심 지표 카드 (4개)
- [ ] 예상 발주 비용 표시
- [ ] 스마트 알림

### ZONE B: 발주 필요량 분석
- [ ] 필터 & 검색
- [ ] 정렬 기능
- [ ] 발주 필요량 테이블
- [ ] 우선순위 뱃지
- [ ] 상태 뱃지

### ZONE C: 재고 현황 분석
- [ ] 재고 상태 분포 차트
- [ ] 재고 회전율 분석
- [ ] 과다재고 경고

### ZONE D: 발주 내보내기 & 액션
- [ ] CSV 내보내기
- [ ] 발주 리스트 생성
- [ ] 연계 페이지 링크

---

## 📝 발주 페이지 삭제 계획

### 삭제할 파일
- `ui_pages/order_management.py` (발주 관리 페이지)
- `src/order_ui.py` (발주 UI 컴포넌트, 일부는 재고 분석에 재사용 가능)
- `src/order_service.py` (발주 서비스 로직, 일부는 재고 분석에 재사용 가능)

### 유지할 함수
- `calculate_order_recommendation()`: 재고 분석 페이지에서 사용
- `calculate_ingredient_usage()`: 재고 분석 페이지에서 사용

### app.py 수정
- 발주 관리 페이지 라우팅 제거
- 재고 분석 페이지 라우팅 추가
- 사이드바 메뉴에서 "발주 관리" 제거, "재고 분석" 추가

### 사이드바 메뉴 변경
- **변경 전**: "🛒 발주 관리" (운영 카테고리)
- **변경 후**: "📊 재고 분석" (분석 카테고리)

---

## 🎯 사용자 시나리오

### 시나리오 1: 발주 필요량 확인
1. 사용자가 "재고 분석" 페이지 접속
2. ZONE A에서 발주 필요 재료 수 확인
3. ZONE B에서 발주 필요 재료 목록 확인
4. 우선순위별로 정렬하여 발주 계획 수립
5. CSV로 내보내기하여 발주 업체에 전달

### 시나리오 2: 긴급 발주 확인
1. 사용자가 "재고 분석" 페이지 접속
2. ZONE A에서 긴급 발주 필요 수 확인
3. 필터에서 "긴급" 선택
4. 긴급 발주 필요 재료만 확인
5. 즉시 발주 조치

### 시나리오 3: 재고 현황 분석
1. 사용자가 "재고 분석" 페이지 접속
2. ZONE C에서 재고 상태 분포 확인
3. 재고 회전율 TOP 10 확인
4. 과다재고 경고 확인
5. 재고 최적화 계획 수립

---

## 🚀 향후 개선 사항

### Phase 2 (권장)
- [ ] 발주 이력 추적 (과거 발주 기록)
- [ ] 발주 패턴 분석 (발주 빈도, 시기)
- [ ] 공급업체별 가격 비교 (향후 공급업체 기능 추가 시)

### Phase 3 (선택)
- [ ] 발주 알림 설정 (특정 재고 수준 도달 시 알림)
- [ ] 발주 최적화 (배송비 최적화, 최소 주문량 고려)
- [ ] 모바일 최적화

---

## 📝 주의사항

1. **발주 페이지 완전 삭제**
   - 발주 관리 페이지는 완전히 삭제
   - 발주 자동화/입고 확인 기능은 제거

2. **재고 분석 페이지는 정보 제공만**
   - 실제 발주를 처리하지 않음
   - 발주 필요량을 계산하고 표시만 함
   - CSV 내보내기로 발주 업체에 전달

3. **기존 함수 재사용**
   - `calculate_order_recommendation()` 재사용
   - `calculate_ingredient_usage()` 재사용
   - 발주 관련 DB 저장 함수는 사용하지 않음

---

**작성일**: 2026-01-24  
**담당**: 재고 분석 페이지 기획
